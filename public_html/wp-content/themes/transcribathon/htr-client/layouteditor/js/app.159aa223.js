(function(t){function e(e){for(var i,s,a=e[0],c=e[1],l=e[2],d=0,p=[];d<a.length;d++)s=a[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&p.push(r[s][0]),r[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(p.length)p.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],i=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(i=!1)}i&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},r={app:0},o=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var u=c;o.push([1,"chunk-vendors"]),n()})({0:function(t,e){},1:function(t,e,n){t.exports=n("56d7")},10:function(t,e){},11:function(t,e){},12:function(t,e){},13:function(t,e){},14:function(t,e){},15:function(t,e){},16:function(t,e){},17:function(t,e){},18:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"100vw",height:"100vh"}},[n("LayoutEditor",{attrs:{pageXml:t.pageXml,tileSource:t.tileSource,structureTypes:[{name:"paragraph",color:"#1CE6FF",default:"true"},{name:"heading",color:"#FF34FF",default:"true"},{name:"caption",color:"#008941",default:"true"},{name:"header",color:"#006FA6",default:"true"},{name:"footer",color:"#A30059",default:"true"},{name:"page-number",color:"#FFFF00",default:"true"},{name:"drop-capital",color:"#00846F",default:"true"},{name:"credit",color:"#FFDBE5",default:"true"},{name:"floating",color:"#7A4900",default:"true"},{name:"signature-mark",color:"#0000A6",default:"true"},{name:"catch-word",color:"#63FFAC",default:"true"},{name:"marginalia",color:"#B79762",default:"true"},{name:"footnote",color:"#004D43",default:"true"},{name:"footnote-continued",color:"#8FB0FF",default:"true"},{name:"endnote",color:"#997D87",default:"true"},{name:"TOC-entry",color:"#5A0007",default:"true"}]},on:{publishXml:t.save}})],1)},o=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"is-relative",style:{"min-width":t.windowWidth+"px",width:t.windowWidth+"px"},attrs:{id:"box"}},[n("div",{ref:"osd",staticClass:"is-relative has-background-dark",attrs:{id:"osd"}}),n("div",{attrs:{id:"navigator-overlay"}},[n("div",{staticStyle:{"margin-top":"2px"}},[n("b-tooltip",{attrs:{position:"is-left",label:t.$t("Increase zoom level")}},[n("b-button",{on:{click:t.zoomIn}},[n("b-icon",{staticClass:"button-icon",attrs:{icon:"plus-box-outline"}})],1)],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-left",label:t.$t("Decrease zoom level")}},[n("b-button",{on:{click:t.zoomOut}},[n("b-icon",{staticClass:"button-icon",attrs:{icon:"minus-box-outline"}})],1)],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-left",label:t.$t("Center")}},[n("b-button",{on:{click:t.setHome}},[n("b-icon",{staticClass:"button-icon",attrs:{icon:"image-filter-center-focus"}})],1)],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-left",label:t.$t("Fit to width")}},[n("b-button",{on:{click:t.fitToWidth}},[n("b-icon",{staticClass:"button-icon",attrs:{icon:"arrow-left-right"}})],1)],1)],1)]),n("div",{attrs:{id:"editor-overlay"}},[n("div",{staticStyle:{"margin-bottom":"20px"}},[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Save")}},[n("b-button",{staticClass:"editor-button",staticStyle:{"background-color":"#48c774"},attrs:{"icon-left":"content-save"},on:{click:t.save}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Selection Mode")}},[n("b-button",{staticClass:"editor-button",style:t.getButtonStyle(t.Editor.BUTTON.POINTER),attrs:{id:"pointer"},on:{click:function(e){return t.buttonClick(t.Editor.BUTTON.POINTER)}}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Add Line")}},[n("b-button",{staticClass:"editor-button",style:t.getButtonStyle(t.Editor.BUTTON.ADD_BASELINES),attrs:{id:"add-textline"},on:{click:function(e){return t.buttonClick(t.Editor.BUTTON.ADD_BASELINES)}}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Add Region")}},[n("b-button",{staticClass:"editor-button",style:t.getButtonStyle(t.Editor.BUTTON.ADD_REGIONS),attrs:{id:"add-textregion"},on:{click:function(e){return t.buttonClick(t.Editor.BUTTON.ADD_REGIONS)}}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Add Table")}},[n("b-button",{staticClass:"editor-button",style:t.getButtonStyle(t.Editor.BUTTON.ADD_TABLES),attrs:{id:"add-table"},on:{click:function(e){return t.buttonClick(t.Editor.BUTTON.ADD_TABLES)}}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Undo")}},[n("b-button",{staticClass:"editor-button",attrs:{"icon-left":"undo",id:"undo-button"},on:{click:function(e){return t.buttonClick(t.Editor.BUTTON.UNDO)}}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Redo")}},[n("b-button",{staticClass:"editor-button",attrs:{"icon-left":"redo",id:"redo-button"},on:{click:function(e){return t.buttonClick(t.Editor.BUTTON.REDO)}}})],1)],1),n("div",{staticStyle:{"margin-top":"20px"}},[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("References")}},[n("b-dropdown",{attrs:{position:"is-top-right"},scopedSlots:t._u([{key:"trigger",fn:function(t){return[n("b-button",{staticClass:"editor-button",attrs:{"icon-left":"message-outline",id:"shortcut-button"}})]}}])},[n("b-dropdown-item",{attrs:{custom:!0}},[n("div",{staticClass:"description"},[n("span",{style:{"margin-bottom":"10px"}},[t._v(t._s(t.$t("References")+":"))]),n("ul",t._l(t.instructions,(function(e){return n("li",{key:e.string},[n("span",{domProps:{innerHTML:t._s(e.string)}})])})),0)])])],1)],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Settings")}},[n("b-button",{staticClass:"editor-button",attrs:{"icon-left":"cogs",id:"settings-button"},on:{click:t.openSettingsModal}})],1)],1),n("div",[n("b-tooltip",{attrs:{position:"is-bottom",label:t.$t("Layout"),id:"tree-dropdown"}},[n("b-dropdown",{attrs:{position:"is-bottom-right","can-close":!1},on:{"active-change":function(e){t.treeOpen=e}},scopedSlots:t._u([{key:"trigger",fn:function(e){return[n("b-button",{staticClass:"editor-button",attrs:{"icon-left":"format-list-bulleted-square",id:"layout-button"},on:{click:t.fetchLayout}})]}}])},[n("b-dropdown-item",{attrs:{custom:!0}},[n("LayoutTree",{ref:"layoutTree",attrs:{initData:t.layout,settings:t.settings,isOpen:t.treeOpen}})],1)],1)],1)],1)])])},a=[],c=n("5530"),l=n("4f96"),u=n("3835"),d=n("2909"),p=(n("dca8"),n("99af"),n("d81d"),n("4de4"),n("7db0"),n("caad"),n("a434"),n("2532"),n("a630"),n("3ca3"),n("d3b7"),n("6062"),n("ddb0"),n("c740"),n("4e82"),n("b0c0"),n("07ac"),n("fb6a"),n("cb29"),n("4fad"),n("2ef0")),h=n.n(p),f=function(){var t;function e(){var t=new v;return t}return{instance:function(){return t||(t=e()),t}}}();function v(){this.actionStack=[{}],this.actionIndex=0,this.setEdited=function(){}}var g=Object.freeze({ADD_POINT:1,REMOVE_POINT:2,MOVE_POINT:3,MOVE_SHAPE:4,MULTI_ACTION:11,REMOVE_SHAPE:12,ADD_SHAPE:13,ADD_TABLE_COLUM:14,REMOVE_TABLE_COLUM:15,ADD_TABLE_ROW:16,REMOVE_TABLE_ROW:17,ADD_CELL:18,REMOVE_CELL:19,CHANGE_CELL_SPAN:20,CHANGE_PARENT:21,MOVE_SHAPE_WITH_VECTOR:22,SET_STRUCTUR_TYPE:23,CHANGE_READING_ORDER:24,POSITION_MOVE:25,ADD_RELATION:26,REMOVE_RELATION:27,UPDATE_RELATION_IDS:28}),m=Object.freeze({ADD:1,REMOVE:2,CLEAR:3});v.prototype.getActionType=function(t){if(null!=t&&!h.a.isEmpty(t))return Object.entries(g).find((function(e){var n=Object(u["a"])(e,2),i=(n[0],n[1]);return i===t.type}))[0];warn("Action is invalid!")},v.prototype.getSelectionType=function(t){if(null!=t)return Object.entries(m).find((function(e){var n=Object(u["a"])(e,2),i=(n[0],n[1]);return i===t.type}))[0];warn("Selection is invalid!")},v.prototype.logAction=function(t){var e=this,n=function t(n){var i=Object(c["a"])({},n);return log(i),i.type=e.getActionType(i),"actions"in i&&(i.actions=i.actions.map((function(e){return t(e)}))),i};protocolLog("%caction performed: %o","color: yellow",n(t))},v.prototype.redo=function(){if(this.actionIndex<this.actionStack.length-1){this.actionIndex++;var t=this.actionStack[this.actionIndex];1===this.actionIndex&&this.setEdited(!0),this.doAction(t)}},v.prototype.undo=function(){if(this.actionIndex>0){var t=this.actionStack[this.actionIndex];this.actionIndex--,0===this.actionIndex&&this.setEdited(!1);var e=this.reverse(t);this.doAction(e)}},v.prototype.doAction=function(t){this.logAction(t),this.editor.performAction(t),this.editor.vueFunctions.performAction(t)},v.prototype.addAction=function(t){this.actionIndex+1<this.actionStack.length&&(this.actionStack=this.actionStack.slice(0,this.actionIndex+1)),this.actionStack.push(t),this.actionIndex=this.actionStack.length-1,1===this.actionIndex&&this.setEdited(!0)},v.prototype.select=function(t){protocolLog("%cselection performed: ".concat(this.getSelectionType(t)," %o"),"color: orange",t),this.editor.performSelection(t),this.editor.vueFunctions.performSelection(t)},v.prototype.reverse=function(t){var e=this;switch(t.type){case g.ADD_SHAPE:return{type:g.REMOVE_SHAPE,index:t.index,shape:t.shape,parent_id:t.parent_id};case g.REMOVE_SHAPE:return{type:g.ADD_SHAPE,index:t.index,shape:t.shape,parent_id:t.parent_id};case g.ADD_POINT:return{type:g.REMOVE_POINT,shape_id:t.shape_id,point_id:t.point_id,point_index:t.point_index};case g.REMOVE_POINT:return{type:g.ADD_POINT,shape_id:t.shape_id,point_id:t.point_id,point_index:t.point_index};case g.MOVE_POINT:return{type:g.MOVE_POINT,shape_id:t.shape_id,point_id:t.point_id,old_coords:t.new_coords,new_coords:t.old_coords};case g.MOVE_SHAPE:return{type:g.MOVE_SHAPE,shape_id:t.shape_id,old_coords:t.new_coords,new_coords:t.old_coords};case g.MULTI_ACTION:return{type:g.MULTI_ACTION,shape_id:t.shape_id,actions:t.actions.map((function(t){return e.reverse(t)})).reverse()};case g.ADD_TABLE_COLUM:return{type:g.REMOVE_TABLE_COLUM,shape_id:t.shape_id,col_index:t.col_index};case g.REMOVE_TABLE_COLUM:return{type:g.ADD_TABLE_COLUM,shape_id:t.shape_id,col_index:t.col_index};case g.ADD_TABLE_ROW:return{type:g.REMOVE_TABLE_ROW,shape_id:t.shape_id,row_index:t.row_index};case g.REMOVE_TABLE_ROW:return{type:g.ADD_TABLE_ROW,shape_id:t.shape_id,row_index:t.row_index};case g.ADD_CELL:return{type:g.REMOVE_CELL,shape_id:t.shape_id,table:t.table,cell:t.cell,row:t.row,col:t.col};case g.REMOVE_CELL:return{type:g.ADD_CELL,shape_id:t.shape_id,table:t.table,cell:t.cell,row:t.row,col:t.col};case g.CHANGE_CELL_SPAN:return{type:g.CHANGE_CELL_SPAN,shape_id:t.shape_id,cell_id:t.cell_id,old_row_span:t.new_row_span,old_col_span:t.new_col_span,new_row_span:t.old_row_span,new_col_span:t.old_col_span};case g.CHANGE_PARENT:return{type:g.CHANGE_PARENT,shape_count:t.shape_count,old_parent_id:t.new_parent_id,new_parent_id:t.old_parent_id,old_index:t.new_index,new_index:t.old_index};case g.MOVE_SHAPE_WITH_VECTOR:return{type:g.MOVE_SHAPE_WITH_VECTOR,shape_id:t.shape_id,vector:{x:-1*t.vector.x,y:-1*t.vector.y}};case g.SET_STRUCTUR_TYPE:return{type:g.SET_STRUCTUR_TYPE,shape_id:t.shape_id,old_type:t.new_type,new_type:t.old_type};case g.CHANGE_READING_ORDER:return{type:g.CHANGE_READING_ORDER,shape_id:t.shape_id,old_index:t.new_index,new_index:t.old_index};case g.POSITION_MOVE:return{type:g.POSITION_MOVE,shape_id:t.shape_id,distance:-t.distance};case g.ADD_RELATION:return{type:g.REMOVE_RELATION,relation:t.relation};case g.REMOVE_RELATION:return{type:g.ADD_RELATION,relation:t.relation}}},v.prototype.reset=function(t,e){this.editor=e,this.setEdited=t,this.setEdited(!1),this.actionStack=[{}],this.actionIndex=0};var y=function(){var t;function e(){var t=new T;return t}return{instance:function(){return t||(t=e()),t}}}();function T(){this.idCounter=100,this.ids=[]}T.prototype.get=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.requestId(t)},T.prototype.extendId=function(t){this.idCounter++;var e="".concat(t,"_").concat(this.idCounter);return this.ids.includes(e)?this.extendId(t):(this.ids.push(e),e)},T.prototype.requestId=function(t){if(!this.ids.includes(t))return this.ids.push(t),t;var e=this.extendId(t);return e};var b=n("ade3"),x=(n("25f0"),n("5a01")),S=n("f9b2"),E=n.n(S),O={showStructureTypes:!1,showReadingOrder:!1,showRelations:!0,showRegions:!0,showBaselines:!0,showWords:!1,structureTypeSize:15,splitLineAngle:0,reeShowTextOnly:!1,treeExpand:!1,circleSize:4},C=function(){var t;function e(){var t=new A;return t}return{instance:function(){return t||(t=e()),t}}}();function A(){this.settings=Object(c["a"])({},O),this.structureTypes=[],this.eventHandlers={update:[]}}A.prototype.set=function(t){null!=t&&(this.settings=Object(c["a"])(Object(c["a"])({},this.settings),t),protocolLog("%csetting changed: %o","color: purple",t),this.emit("update",this.settings))},A.prototype.reset=function(t){null!=this.settings[t]&&(this.settings[t]=O[t])},A.prototype.get=function(t){if(null!=t)return this.settings[t]},A.prototype.getAll=function(){return Object(c["a"])({},this.settings)},A.prototype.on=function(t,e){this.eventHandlers[t].push(e)},A.prototype.emit=function(t,e){this.eventHandlers[t].map((function(t){return t(e)}))};var w=function(){var t;function e(){var t=new _;return t}return{instance:function(){return t||(t=e()),t}}}();function _(){this.scaleFactor=null,this.idHandler=y.instance(),this.settings=C.instance()}_.prototype.init=function(t,e){this.scaleFactor=t,this.circleRadius=4,this.largeCircleRadius=6,this.vertexRadius=1,this.wordBackground="rgba(255,165,0,0.2)",this.wordLineColor="rgb(255,165,0)",this.baselineColor="blue",this.tableColor="orange",this.regionColor="green",this.defaultVertexColor="white",this.selectedVertexColor="yellow",this.deleteColor="red"},_.prototype.getRelationBubble=function(t,e){var n=t.map((function(t){var e=t.left,n=t.top;return[e,n]})),i=Object(x["m"])(Object(x["i"])(n),1.5),r=i.map((function(t){var e=Object(u["a"])(t,2),n=e[0],i=e[1];return{x:n,y:i}}));r.push(r[0]);var o=this.settings.get("structureTypeSize"),s=this.getTopLeft(r.map((function(t){var e=t.x,n=t.y;return{left:e,top:n}}))),a=s.left+Math.sqrt(o)*this.scaleFactor,c=s.top+Math.sqrt(o)*this.scaleFactor;return[new fabric.Polyline(r,{strokeWidth:1,originX:"center",originY:"center",stroke:"white",fill:"transparent",selectable:!1,evented:!1}),new fabric.Text(e,{originX:"left",originY:"top",fontSize:o,fill:"black",backgroundColor:"rgba(255,255,255,0.8)",evented:!1,left:a,top:c})]},_.prototype.getWordCircle=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.idHandler.requestId("c"),i=this.settings.get("circleSize");return new fabric.Circle({radius:i,fill:this.defaultVertexColor,strokeWidth:this.vertexRadius,stroke:this.baselineColor,left:t,top:e,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,id:n,defaultRadius:i,defaultColor:this.defaultVertexColor,selectedColor:this.baselineColor})},_.prototype.getWordPolyLine=function(t,e){return t.push(t[0]),new fabric.Polyline(t,{strokeWidth:1,originX:"center",originY:"center",stroke:this.wordLineColor,selectable:!1,evented:!1,id:e,color:this.wordBackground})},_.prototype.getBaselineCircle=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.idHandler.requestId("c"),i=this.settings.get("circleSize");return new fabric.Circle({radius:i,fill:this.defaultVertexColor,strokeWidth:this.vertexRadius,stroke:this.baselineColor,left:t,top:e,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,id:n,defaultRadius:i,defaultColor:this.defaultVertexColor,selectedColor:this.baselineColor})},_.prototype.getPolygon=function(t,e){var n=this.getPolyline(t);n.reverse(),n=t.concat(n);var i=n.map((function(t){return{x:t[0],y:t[1]}}));return{polygon:new fabric.Polyline(i,{strokeWidth:0,originX:"center",originY:"center",stroke:this.baselineColor,fill:this.baselineColor,opacity:.2,selectable:!1,evented:!1,id:e,defaultColor:this.baselineColor,deleteColor:this.deleteColor}),polyCoords:n}},_.prototype.getLineElements=function(t,e){var n=this,i={},r=[],o=t.map((function(t){return{x:t[0],y:t[1]}}));return i=new fabric.Polyline(o,{strokeWidth:1,stroke:"blue",fill:"transparent",selectable:!1,evented:!1,id:e}),t.length>0&&t.reduce((function(t,i){var o=[t,i],s=Object(x["a"])(o),a=Object(x["d"])(o),c=n.getArrow(a[0],a[1],s,e);return r.push(c),i})),{line:i,arrows:r}},_.prototype.getPolyline=function(t){if(t.length<=1)return[];var e=[],n=[],i=30*this.scaleFactor,r=function(t,e){var n=t-e;return n<0&&(n=360+n),n},o=function(t,e){var o=i;if(e<135){var s=Math.pow(-(e/135-1),1);o+=o*s}if(e>225){var a=Math.pow(-(225/e-1),.5);o+=o*a}e/=2;var c=Object(x["a"])(t),l=r(c,e),u=t[0],d=Object(x["g"])(u,l,o);n.push(d)},s=function(t){var e=Object(x["a"])(t),o=r(e,90),s=t[0],a=Object(x["g"])(s,o,i);n.push(a)},a=function(t){var e=Object(x["a"])(t),o=r(e,90),s=t[1],a=Object(x["g"])(s,o,i);n.push(a)};return t.reduce((function(t,n){return e.push([t,n]),n})),s(e[0]),e.reduce((function(t,e){var n=r(r(Object(x["a"])(e),Object(x["a"])(t)),180);return o(e,n),e})),a(e[e.length-1]),n},_.prototype.getRegionCircle=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.idHandler.requestId("c"),i=this.settings.get("circleSize");return new fabric.Circle({radius:i,fill:this.defaultVertexColor,strokeWidth:this.vertexRadius,stroke:this.regionColor,left:t,top:e,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,id:n,defaultRadius:i,defaultColor:this.defaultVertexColor,selectedColor:this.regionColor})},_.prototype.getRegionBackground=function(t,e){t.push(t[0]);var n=new fabric.Polyline(t,{strokeWidth:0,fill:"green",opacity:.2,selectable:!1,evented:!1,id:e,defaultColor:this.regionColor,deleteColor:this.deleteColor});return n},_.prototype.getRegionLine=function(t,e){t.push(t[0]);var n=new fabric.Polyline(t,{strokeWidth:1,stroke:"green",fill:"transparent",opacity:1,selectable:!1,evented:!1,id:e});return n},_.prototype.getRunningCircle=function(t,e){var n=this.settings.get("circleSize");return new fabric.Circle({radius:n,fill:"blue",strokeWidth:.6,stroke:"black",opacity:.2,left:t,top:e,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,hoverCursor:"pointer",moveCursor:"grabbing"})},_.prototype.getTableCircle=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.idHandler.requestId("c"),i=this.settings.get("circleSize");return new fabric.Circle({radius:i,fill:this.defaultVertexColor,strokeWidth:this.vertexRadius,stroke:this.tableColor,left:t,top:e,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,id:n,padding:5,defaultRadius:i,defaultColor:this.defaultVertexColor,selectedColor:this.baselineColor})},_.prototype.getHoverLine=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.idHandler.requestId("hl"),n=arguments.length>2?arguments[2]:void 0;return new fabric.Polyline(t.map((function(t){return{x:t.left,y:t.top}})),{id:e,strokeWidth:3,originX:"center",originY:"center",stroke:"black",padding:20,fill:"transparent",opacity:.6,hasControls:!1,hasBorders:!1,lockMovementX:!n,lockMovementY:n,evented:!0,hoverCursor:n?"col-resize":"row-resize",vertices:t})},_.prototype.getCellBackground=function(t,e,n){return new fabric.Polyline(t,{strokeWidth:0,fill:e,opacity:n,selectable:!1,evented:!1})},_.prototype.getCellFrame=function(t){return t.push(t[0]),new fabric.Polyline(t,{strokeWidth:1.5,opacity:.8,stroke:"orange",fill:"transparent",selectable:!1,evented:!1})},_.prototype.getStructureText=function(t,e,n){var i,r=e.map((function(t){var e=t.left,n=t.top;return[e,n]})),o=null===(i=this.settings.structureTypes.find((function(e){return e.name===t})))||void 0===i?void 0:i.color;if(2===r.length){var s=[r[0][0]+.1,r[0][1]+.1];r.push(s)}var a=this.getTopLeft(e),c=this.settings.get("structureTypeSize"),l=a.left+Math.sqrt(c)*this.scaleFactor,u=a.top+Math.sqrt(c)*this.scaleFactor;if(null!=t)return new fabric.Text(t,{originX:"left",originY:"top",fontSize:c,fill:o,backgroundColor:"rgba(255,255,255,0.8)",evented:!1,left:l,top:u})},_.prototype.getROText=function(t,e,n){var i=e.map((function(t){var e=t.left,n=t.top;return[e,n]}));if(2===i.length){var r=[i[0][0]+.1,i[0][1]+.1];i.push(r)}var o=this.getTopLeft(e),s=this.settings.get("structureTypeSize"),a=o.left-Math.sqrt(s)*this.scaleFactor,c=o.top+Math.sqrt(s)*this.scaleFactor;if(null!=t){var l=parseInt(t)+1;return new fabric.Text(l.toString(),{originX:"right",originY:"top",fontSize:s,fill:"black",backgroundColor:"white",evented:!1,left:a,top:c})}},_.prototype.getTopLeft=function(t){return t.reduce((function(t,e){return Math.abs(t.left)+Math.abs(t.top)>Math.abs(e.left)+Math.abs(e.top)?e:t}))},_.prototype.getArrow=function(t,e,n,i){var r,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"black",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.4;return new fabric.Triangle((r={width:o,height:o,left:t,top:e,angle:n+90,fill:s,strokeWidth:.6,stroke:"black",originX:"center",originY:"center",opacity:a},Object(b["a"])(r,"strokeWidth",.8),Object(b["a"])(r,"selectable",!1),Object(b["a"])(r,"evented",!1),Object(b["a"])(r,"id",i),r))},_.prototype.getSplitLine=function(t,e,n){return new fabric.Line([e.x-t,e.y,e.x+t,e.y],{strokeWidth:1,fill:"blue",stroke:"blue",selectable:!1,evented:!1,originX:"center",originY:"center",angle:n})},_.prototype.getNewAssignLine=function(t,e){var n=Object(u["a"])(t,2),i=n[0],r=n[1],o=Object(u["a"])(e,2),s=o[0],a=o[1];return new fabric.Line([i,r,s,a],{strokeWidth:1,fill:"black",stroke:"black",selectable:!1,evented:!1,startPos:[i,r]})},_.prototype.getNewAssignCircle=function(t,e){return new fabric.Circle({radius:this.circleRadius,fill:"black",strokeWidth:this.vertexRadius,stroke:"black",left:t,top:e,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,evented:!1})},_.prototype.getPreviewLine=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3;return new fabric.Line(t,{originX:"center",originY:"center",strokeWidth:1,fill:"blue",stroke:"blue",opacity:e,selectable:!1,evented:!1})},_.prototype.getPreviewRect=function(t,e,n,i){var r=Math.abs(t-n),o=Math.abs(e-i),s=Object(x["d"])([[t,e],[n,i]]);return new fabric.Rect({left:s[0],top:s[1],originX:"center",originY:"center",width:r,height:o,strokeWidth:1,stroke:"black",fill:"green",opacity:.3,selectable:!1,evented:!1})},_.prototype.getSelectionRect=function(t,e){var n=new fabric.Rect({left:t,top:e,originX:"center",originY:"center",width:0,height:0,strokeWidth:2,stroke:"black",fill:"transparent",opacity:.5,selectable:!1,evented:!1,initX:t,initY:e,updated:!1});return n.update=function(t,e){n.updated=!0;var i=Math.abs(n.initX-t),r=Math.abs(n.initY-e),o=Object(x["d"])([[n.initX,n.initY],[t,e]]);n.set({width:i,height:r,left:o[0],top:o[1]})},n.getArea=function(){var t=n.width/2,e=n.height/2;return[[n.left-t,n.top-e],[n.left-t,n.top+e],[n.left+t,n.top+e],[n.left+t,n.top-e]]},n},_.prototype.getInvalidTableBackground=function(t){return new fabric.Polyline(t,{strokeWidth:0,fill:"red",opacity:.2,selectable:!1,evented:!1})},_.prototype.getInvalidTableFrame=function(t){return new fabric.Polyline([].concat(Object(d["a"])(t),[t[0]]),{strokeWidth:1,opacity:.6,stroke:"black",fill:"transparent",selectable:!1,evented:!1})},_.prototype.getInvalidTableSign=function(t){var e=t.map((function(t){var e=t.x,n=t.y;return[e,n]})),n=Object(x["l"])(e);return new fabric.Text("Invalid Table",{originX:"center",originY:"center",fontSize:50*this.scaleFactor,fill:"yellow",evented:!1,left:n[0],top:n[1]})},_.prototype.clone=function(t){var e;return t.clone((function(t){e=t})),e},_.prototype.getGroupData=function(t){var e=function t(e,n,i){var r=e.getObjects().filter((function(t){return"circle"===t.type})),o=e.getObjects().filter((function(t){return"group"===t.type}));return{vertices:r.map((function(t){return{left:n+(e.width/2+t.left)*e.scaleX,top:i+(e.height/2+t.top)*e.scaleY}})),groups:o.map((function(r){return t(r,n+(e.width/2+r.left)*e.scaleX,i+(e.height/2+r.top)*e.scaleY)}))}};return e(t,t.left,t.top)},_.prototype.getDock=function(t,e,n){var i=Object(u["a"])(t,2),r=i[0],o=i[1],s=this.settings.get("circleSize");return new fabric.Circle({radius:2*s,fill:"transparent",strokeWidth:this.vertexRadius,stroke:"baseline"===n?"blue":"region"===n?"green":"table"===n?"yellow":"orange",left:r,top:o,originX:"center",originY:"center",hasControls:!1,hasBorders:!1,selectable:!1,id:e,defaultRadius:2*s})},_.prototype.getRelationArrow=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",i=[t,e],r=Object(x["a"])(i),o=Object(x["b"])(i)(.9),s=this.getArrow(o[0],o[1],r,-1,20,n,1),a=new fabric.Line([].concat(Object(d["a"])(t),Object(d["a"])(o)),{strokeWidth:1,stroke:n,selectable:!1,evented:!1}),c=new fabric.Group([s,a],{selectable:!1,evented:!1});return c};n("0481"),n("2af1");var R=n("cd4e");function L(t,e,n){if(n>=t.length){var i=n-t.length+1;while(i--)t.push(void 0)}t.splice(n,0,t.splice(e,1)[0])}function I(t,e,n){var i;i=n||10;var r=null,o=t.find((function(t){var n=!1,o=V(t.coords[0],[e.x,e.y]),s=V(t.coords[1],[e.x,e.y]);if(o>i&&s>i&&(n=!0),Object(x["e"])([e.x,e.y],t.polygon)&&n){var a=Object(x["b"])(t.coords),c=o+s,l=o/c;return r=a(l),!0}return!1}));return{line:o,point:r}}function P(t){var e=function(t){return t[0][0]!=t[1][0]||t[0][1]!=t[1][1]};if(t.length<2)return[];var n=new E.a,i=[];t.reduce((function(t,r){var o=[[t.left,t.top],[r.left,r.top]];if(e(o)){var s=n.data(o).margin(10)[0];i.push({coords:o,polygon:s,parentIds:[t.id,r.id]})}return r}));var r=[[t[t.length-1].left,t[t.length-1].top],[t[0].left,t[0].top]];if(e(r)){var o=n.data(r).margin(10)[0];i.push({coords:r,polygon:o,parentIds:[t[t.length-1].id,t[0].id]})}return i}function k(t,e){var n=t.vertices.map((function(t){return{id:t.id,x:t.left,y:t.top}})),i=[],r=Object(R["a"])(e[0][0],e[0][1],e[1][0],e[1][1]);return t.geometricLines.map((function(t){var e=R["a"].apply(void 0,Object(d["a"])(t.coords.flat())),o=e.intersect(r).map((function(t){var e=t.x,n=t.y;return{x:e,y:n,id:y.instance().requestId("ls")}}))[0];if(o){var s=t.parentIds[1],a=!1,c=[];n=n.filter((function(t){return t.id===s&&(a=!0),a||c.push(t),a})),n=[o].concat(n),c=c.concat([o]),i.push({vertices:c})}})),i.push({vertices:n}),i}function D(t,e){var n=t.vertices.map((function(t){return[t.left,t.top]})),i=Object(x["l"])(n);return Math.sign((e[1][0]-e[0][0])*(i[1]-e[0][1])-(e[1][1]-e[0][1])*(i[0]-e[0][0]))}function M(t,e){var n=[];return n.push({x:t.x,y:t.y}),t.x>e.x&&t.y>e.y||t.x<e.x&&t.y<e.y?n.push({x:e.x,y:t.y}):n.push({x:t.x,y:e.y}),n.push({x:e.x,y:e.y}),t.x>e.x&&t.y>e.y||t.x<e.x&&t.y<e.y?n.push({x:t.x,y:e.y}):n.push({x:e.x,y:t.y}),n}function N(t){var e=function(t){return t.reduce((function(e,n,i){return[].concat(Object(d["a"])(e),Object(d["a"])(new Array(t.length-1-i).fill(0).map((function(e,n){return[t[i],t[i+1+n]]}))))}),[])},n=t.map((function(t){return{line:t,first:t.vertices[0],last:t.vertices[t.vertices.length-1]}})),i=e(n),r=i.reduce((function(t,e){var n=V(e[0].last.top,e[0].last.left,e[1].first.top,e[1].first.left),i=V(e[1].last.top,e[1].last.left,e[0].first.top,e[0].first.left),r=n<i?n:i,o=n<i?[e[0],e[1]]:[e[1],e[0]];return r<t.dist?{pair:o,dist:r}:t}),{dist:1/0}),o=r.pair.map((function(t){return t.line}));return o}function V(t,e,n,i){var r=t,o=e,s=n,a=i;n||i||(r=t[0],o=t[1],s=e[0],a=e[1]);var c=r-s,l=o-a;return Math.sqrt(c*c+l*l)}function j(t,e,n){var i=[t[0]+n/2,t[1]],r=Object(x["f"])(i,e,t),o=Object(x["f"])(r,180,t);return[o,r]}function B(t){this.attributes={},this.elements={},this.text="",this.canvas=t,this.state=B.STATE.EDIT,this.selected=!1,this.showStructure=!1,this.vertices=[],this.prevLines=[],this.deletedPoints=[],this.actionHandler=f.instance(),this.myFabric=w.instance(),this.settings=C.instance(),this.geometricLines=[],this.hoveredVertex=null,this.preview=!0,this.runningVertex=null,this.lastMousePosition={x:0,y:0}}B.STATE=Object.freeze({FIRST_DRAW:1,GROUP_SELECTION:2,ADD_VERTEX:3,REMOVE_VERTEX:4,EDIT:5,DISPLAY_RO:6,RESIZE:7,LARGE_GROUP_SELECTION:8}),B.M_ACTIONS=Object.freeze({V_DIV:1,H_DIV:2,REMOVE_DIV:3}),B.TYPE=Object.freeze({REGION:"region",TABLE:"table",BASELINE:"baseline",CELL:"cell",WORD:"word,",SHAPE:"shape"}),B.prototype.performAction=function(t){if(this.state===B.STATE.GROUP_SELECTION&&this.setState(B.STATE.EDIT),t)switch(t.type){case g.ADD_POINT:var e;this.deletedPoints=this.deletedPoints.filter((function(n){return n.id!==t.point_id||(e=n,!1)})),this.addPoint(e,t.point_index);break;case g.REMOVE_POINT:this.removePoint(t.point_id);break;case g.MOVE_POINT:this.movePoint(t.point_id,t.new_coords);break;case g.MOVE_SHAPE:this.moveAllPoints(t.new_coords);break;case g.MOVE_SHAPE_WITH_VECTOR:this.moveAllPointsWithVector(t.vector);break;case g.ADD_TABLE_COLUM:this.cellMatrix.createColumn(t.col_index);break;case g.REMOVE_TABLE_COLUM:this.cellMatrix.deleteColumn(t.col_index);break;case g.ADD_TABLE_ROW:this.cellMatrix.createRow(t.row_index);break;case g.REMOVE_TABLE_ROW:this.cellMatrix.deleteRow(t.row_index);break;case g.ADD_CELL:this.cellMatrix.setCell(t.cell,t.row,t.col);break;case g.REMOVE_CELL:this.cellMatrix.removeCellById(t.cell.id);break;case g.CHANGE_CELL_SPAN:var n=this.cellMatrix.getCellById(t.cell_id);n.rowSpan=t.new_row_span,n.colSpan=t.new_col_span,this.update();break;case g.SET_STRUCTUR_TYPE:this.setStructureType(t.new_type)}},B.prototype.getReadingOrder=function(){var t;return null===(t=this.attributes.custom)||void 0===t?void 0:t.readingOrder},B.prototype.getStructureType=function(){var t;return null===(t=this.attributes.custom)||void 0===t?void 0:t.structureType},B.prototype.setReadingOrder=function(t){"custom"in this.attributes||(this.attributes.custom={}),this.attributes.custom.readingOrder=t},B.prototype.setStructureType=function(t){if("none"===t){if(!("custom"in this.attributes))return;var e=this.attributes.custom;if(!("structureType"in e))return;delete e.structureType,Object(p["isEmpty"])(e)&&delete this.attributes.custom}"custom"in this.attributes||(this.attributes.custom={}),this.attributes.custom.structureType=t},B.prototype.getType=function(){return B.TYPE.SHAPE},B.prototype.movePoint=function(t,e){var n=this.vertices.find((function(e){return e.id===t}));n&&(n.set({left:e.left,top:e.top}),n.setCoords(),this.update())},B.prototype.moveAllPoints=function(t){this.vertices.map((function(e,n){e.set({left:t[n].left,top:t[n].top}),e.setCoords()})),this.update()},B.prototype.moveAllPointsWithVector=function(t){var e=t.x,n=t.y;this.vertices.map((function(t){t.set({left:t.left+e,top:t.top+n}),t.setCoords()})),this.update()},B.prototype.addPoint=function(t,e){this.canvas.add(t),this.vertices.splice(e,0,t),this.vertices.length>1&&this.update()},B.prototype.addMultiplePoints=function(t){var e;(e=this.canvas).add.apply(e,Object(d["a"])(t)),this.vertices=this.vertices.concat(t),this.vertices.length>1&&this.update()},B.prototype.removePoint=function(t){var e;this.vertices=this.vertices.filter((function(n){return n.id!==t||(e=n,!1)})),this.deletedPoints.push(e),e||(console.log("the point id "+t+" could not be found"),console.log(this.vertices.map((function(t){return t.id}))),console.log(this.deletedPoints.map((function(t){return t.id})))),e.set("radius",e.defaultRadius),this.canvas.remove(e),this.update(),this.canvas.discardActiveObject()},B.prototype.getVertexIndex=function(t){var e=this.vertices.findIndex((function(e){return e.id===t}));return e},B.prototype.getVertexById=function(t){var e=this.vertices.find((function(e){return e.id===t}));return e},B.prototype.showDock=function(t){null==this.dock&&(this.dock=this.myFabric.getDock(this.getMidPoint(),this.id,t),this.canvas.add(this.dock))},B.prototype.removeDock=function(){null!=this.dock&&(this.canvas.remove(this.dock),this.dock=null)},B.prototype.getMidPoint=function(){var t=this.vertices.map((function(t){var e=t.left,n=t.top;return[e,n]}));return Object(x["l"])(t)},B.prototype.handleClickEvent=function(t){},B.prototype.handleDBLClickEvent=function(t,e){},B.prototype.handleMouseMoveEvent=function(t){},B.prototype.handleMouseOut=function(t){},B.prototype.mouseDownBefore=function(){},B.prototype.handleMouseUpEvent=function(t){},B.prototype.mouseUp=function(){},B.prototype.update=function(){},B.prototype.select=function(){},B.prototype.unSelect=function(){},B.prototype.setState=function(){},B.prototype.showStructureType=function(t){},B.prototype.settingsUpdate=function(){},B.prototype.isVisible=function(){switch(this.getType()){case B.TYPE.REGION:return this.settings.get("showRegions");case B.TYPE.TABLE:return this.settings.get("showRegions");case B.TYPE.CELL:return this.settings.get("showRegions");case B.TYPE.BASELINE:return this.settings.get("showBaselines");case B.TYPE.WORD:return this.settings.get("showWords")}},B.prototype.superUpdate=function(){this.updateVertexSize(),this.updateStructureText(),this.updateReadingOrderText()},B.prototype.updateVisibility=function(){this.isVisible()||this.removeFromCanvas()},B.prototype.updateVertices=function(){var t,e;this.selected?this.canvas.contains(this.vertices[0])||(t=this.canvas).add.apply(t,Object(d["a"])(this.vertices)):(e=this.canvas).remove.apply(e,Object(d["a"])(this.vertices))},B.prototype.updateGeometricLines=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{chop:!1},e=t.chop;this.geometricLines=e?P(this.vertices).slice(0,-1):P(this.vertices)},B.prototype.updateVertexSize=function(){var t=this.settings.get("circleSize");this.vertices.map((function(e){e.radius!=t&&e.set({radius:t,defaultRadius:t})}))},B.prototype.updateStructureText=function(){var t=this.settings.get("showStructureTypes");this.canvas.remove(this.structureText),t&&(this.structureText=this.myFabric.getStructureText(this.getStructureType(),this.vertices),null!=this.structureText&&this.canvas.add(this.structureText))},B.prototype.updateReadingOrderText=function(){var t=this.settings.get("showReadingOrder");this.canvas.remove(this.readingOrderText),t&&(this.readingOrderText=this.myFabric.getROText(this.getReadingOrder(),this.vertices),null!=this.readingOrderText&&this.canvas.add(this.readingOrderText))};var H=B;function U(t,e){var n=this;H.call(this,t),this.id=y.instance().requestId("w"),this.selected=!1,this.polyLine=null,this.vertices=[],e&&(this.attributes=e.attributes,this.elements=e.elements,this.id=y.instance().requestId(e.attributes.id),this.text=e.elements.text,this.polyLine=this.myFabric.getWordPolyLine(this.elements.coords,this.id),this.canvas.add(this.polyLine),this.elements.coords.map((function(t){var e=t.x,i=t.y;n.vertices.push(n.myFabric.getWordCircle(e,i,n.id))})),this.update())}U.prototype=Object.create(H.prototype),U.prototype.constructor=U,U.prototype.getBlueprint=function(t,e,n){return this.attributes.id=this.id,this.setReadingOrder(t),{attributes:this.attributes,elements:this.elements}},U.prototype.getType=function(){return H.TYPE.WORD},U.prototype.select=function(){this.selected=!0,this.update()},U.prototype.unSelect=function(){this.selected=!1,this.update()},U.prototype.getGroup=function(){var t=this.myFabric.clone(this.polyLine).set({fill:this.polyLine.color});return new fabric.Group([t],{id:this.id,hasControls:!0,cornerStyle:"circle",padding:0,cornerSize:8,cornerColor:"transparent",transparentCorners:!0,cornerStrokeColor:"blue",lockSkewingX:!0,lockSkewingY:!0}).setControlsVisibility({mtr:!1})},U.prototype.moveAllPoints=function(t){t.x,t.y},U.prototype.removeFromCanvas=function(){this.canvas.remove(this.polyLine),this.canvas.remove(this.structureText),this.canvas.remove(this.readingOrderText)},U.prototype.getArea=function(){return this.vertices.map((function(t){return[t.left,t.top]}))},U.prototype.update=function(){this.isVisible()?(this.updateVertexSize(),this.updateStructureText(),this.updateReadingOrderText(),this.selected?this.polyLine.set({fill:this.polyLine.color}):this.polyLine.set({fill:"transparent"}),this.canvas.sendToBack(this.polyLine)):this.removeFromCanvas()};var F=U;function W(t,e){var n=this;H.call(this,t),this.id=y.instance().requestId("l"),this.activeVertex=null,this.tempCoords=null,this.line={},this.arrows=[],this.group=null,this.prevLine=null,this.lastAddedVertex={},this.alive=!0,this.modified=!0,this.insertionPosition=null,this.polygon=null,this.previewCircle={},this.polyCoords=[],this.words=[],e&&(this.modified=!1,this.attributes=e.attributes,this.elements=e.elements,this.id=y.instance().requestId(e.attributes.id),this.text=e.elements.text,this.words=e.elements.words.map((function(e){return new F(t,e)})),e.elements.baselineCoords.map((function(t){var e=n.getVertex(t.x,t.y);n.addPoint(e,n.vertices.length)})),this.update())}W.prototype=Object.create(H.prototype),W.prototype.constructor=W,W.prototype.getBlueprint=function(t,e,n){var i=this;return this.modified&&(this.elements.polyCoords=this.getPolygonCoords()),this.attributes.id=this.id,this.setReadingOrder(t),this.elements.baselineCoords=this.vertices.map((function(t){return{x:t.left,y:t.top}})),this.elements.words=this.words.map((function(t,e){return t.getBlueprint(e,i.attributes.id,n)})),this.elements.text=this.text,{attributes:this.attributes,elements:this.elements}},W.prototype.getType=function(){return H.TYPE.BASELINE},W.prototype.getLayout=function(){return{type:"Baseline",text:this.text,id:this.id,structureType:this.getStructureType()}},W.prototype.getVertex=function(t,e,n){var i=this,r=this.myFabric.getBaselineCircle(t,e,n),o=this;return this.lastAddedVertex=r,r.select=function(){i.activeVertex&&i.activeVertex.set("fill",r.defaultColor),i.activeVertex=r,i.activeVertex.set("fill",r.selectedColor),i.canvas.requestRenderAll()},r.unSelect=function(){i.activeVertex&&(i.activeVertex.set("fill",r.defaultColor),i.activeVertex=null),i.canvas.requestRenderAll()},r.on("mousedown",(function(t){if(o.tempCoords={left:this.left,top:this.top},this.select(),o.state===H.STATE.REMOVE_VERTEX&&o.vertices.length>2){var e=o.vertices.findIndex((function(e){return e.id===t.target.id}));o.removePoint(t.target.id),o.modified=!0,o.actionHandler.addAction({type:g.REMOVE_POINT,shape_id:o.id,point_id:t.target.id,point_index:e})}})),r.on("moving",(function(t){o.update({geometricLines:!1})})),r.on("mousedblclick",(function(t){})),r.on("mouseup",(function(t){!o.tempCoords||o.state==H.STATE.GROUP_SELECTION||o.tempCoords.left==this.left&&o.tempCoords.top==this.top||(o.update(),o.modified=!0,o.actionHandler.addAction({type:g.MOVE_POINT,shape_id:o.id,point_id:this.id,old_coords:o.tempCoords,new_coords:{left:this.left,top:this.top}}),o.tempCoords=null)})),r},W.prototype.setState=function(t){this.activeVertex&&this.activeVertex.unSelect(),(this.prevLine||this.previewCircle)&&(this.canvas.remove(this.prevLine,this.previewCircle),this.prevLine=null,this.previewCircle=null),this.state===H.STATE.REMOVE_VERTEX&&t!=H.STATE.REMOVE_VERTEX&&this.vertices.map((function(t){t.set({hoverCursor:"default"})})),t===H.STATE.ADD_VERTEX&&this.previewVertex(this.lastMousePosition.x,this.lastMousePosition.y),t===H.STATE.REMOVE_VERTEX&&this.vertices.map((function(t){t.set({hoverCursor:"pointer"})})),t===H.STATE.EDIT&&this.state!=H.STATE.EDIT&&(this.canvas.discardActiveObject(),this.canvas.requestRenderAll()),log(t),this.state=t},W.prototype.handleClickEvent=function(t){this.state===H.STATE.ADD_VERTEX&&this.insertionPosition&&this.insertVertex(this.insertionPosition.x,this.insertionPosition.y),this.state,H.STATE.GROUP_SELECTION,this.state,H.STATE.EDIT},W.prototype.handleMouseUpEvent=function(t){if(this.state===H.STATE.FIRST_DRAW){var e=this.getVertex(t.x,t.y);this.addPoint(e,this.vertices.length)}},W.prototype.handleDBLClickEvent=function(t,e){this.state,H.STATE.FIRST_DRAW,this.state===H.STATE.ADD_VERTEX&&(this.removeLastAddedVertex(),this.state=H.STATE.EDIT,e(Lt.BUTTON.POINTER))},W.prototype.handleMouseMoveEvent=function(t){if(this.state===H.STATE.ADD_VERTEX){var e=this.canvas.getPointer(t.e);this.previewVertex(e.x,e.y)}else if(this.state===H.STATE.FIRST_DRAW){var n=this.canvas.getPointer(t.e);this.previewFirstDraw(n.x,n.y)}else(this.prevLine||this.previewCircle)&&(this.canvas.remove(this.prevLine,this.previewCircle),this.prevLine=null,this.previewCircle=null);if(this.state===H.STATE.EDIT&&this.preview){var i=this.canvas.getPointer(t.e),r=2;this.canvas.remove(this.runningVertex);var o=I(this.geometricLines,i),s=o.line,a=o.point;if(a&&s){this.runningVertex=this.myFabric.getRunningCircle(a[0],a[1]);var c=this;this.runningVertex.on("mousedown",(function(t){c.preview=!1})),this.runningVertex.on("moving",(function(t){var e,n,i=c.getVertexById(s.parentIds[0]),o=c.getVertexById(s.parentIds[1]),a=V(i.left,i.top,o.left,o.top),l=V(this.left,this.top,i.left,i.top)+V(this.left,this.top,o.left,o.top),u=(l-a)/r+.2;(e=c.canvas).remove.apply(e,Object(d["a"])(c.prevLines)),c.prevLines=[c.myFabric.getPreviewLine([this.left,this.top,i.left,i.top],u),c.myFabric.getPreviewLine([this.left,this.top,o.left,o.top],u)],this.set("opacity",u),(n=c.canvas).add.apply(n,Object(d["a"])(c.prevLines))})),this.runningVertex.on("mouseup",(function(t){var e,n=c.getVertexById(s.parentIds[0]),i=c.getVertexById(s.parentIds[1]),o=V(n.left,n.top,i.left,i.top),a=V(this.left,this.top,n.left,n.top)+V(this.left,this.top,i.left,i.top);if(a-o>r){c.canvas.remove(this);var l=c.getVertex(this.left,this.top);c.modified=!0,c.actionHandler.addAction({type:g.ADD_POINT,shape_id:c.id,point_id:l.id,point_index:c.getVertexIndex(s.parentIds[1])}),c.addPoint(l,c.getVertexIndex(s.parentIds[1])),c.canvas.setActiveObject(l),l.fire("mouseover"),l.select()}c.preview=!0,(e=c.canvas).remove.apply(e,Object(d["a"])(c.prevLines)),c.canvas.remove(this)})),this.canvas.add(this.runningVertex),this.runningVertex.sendToBack(),this.canvas.requestRenderAll()}}},W.prototype.handleMouseOut=function(t){},W.prototype.addWord=function(t,e){this.words.splice(e,0,t)},W.prototype.select=function(){var t,e;this.selected=!0,this.canvas.remove(this.polygon),(t=this.canvas).remove.apply(t,Object(d["a"])(this.vertices)),(e=this.canvas).add.apply(e,Object(d["a"])(this.vertices)),this.update()},W.prototype.unSelect=function(){var t,e;this.selected=!1,this.setState(H.STATE.EDIT),(t=this.canvas).remove.apply(t,Object(d["a"])(this.arrows)),(e=this.canvas).remove.apply(e,Object(d["a"])(this.vertices)),this.canvas.remove(this.prevLine,this.previewCircle,this.runningVertex),this.prevLine=null,this.previewCircle=null,this.polygon.set("opacity",.2),this.line.set("opacity",.5)},W.prototype.removeLastAddedVertex=function(){var t=this.vertices.indexOf(this.lastAddedVertex);t>-1&&(this.vertices.splice(t,1),this.canvas.remove(this.lastAddedVertex),this.update())},W.prototype.insertVertex=function(t,e){var n=this.getVertex(t,e);this.modified=!0,this.actionHandler.addAction({type:g.ADD_POINT,shape_id:this.id,point_id:n.id,point_index:this.insertionPosition.index}),this.addPoint(n,this.insertionPosition.index)},W.prototype.previewVertex=function(t,e){this.canvas.remove(this.prevLine);var n,i,r=this.vertices[0],o=this.vertices[this.vertices.length-1];V(r.left,r.top,t,e)<V(o.left,o.top,t,e)?(n=r,i=0):(n=o,i=this.vertices.length),this.prevLine=this.myFabric.getPreviewLine([t,e,n.left,n.top]),this.insertionPosition={x:t,y:e,index:i},this.canvas.add(this.prevLine)},W.prototype.previewFirstDraw=function(t,e){var n=this.vertices[this.vertices.length-1];null!=n&&(this.canvas.remove(this.prevLine),this.prevLine=this.myFabric.getPreviewLine([t,e,n.left,n.top]),this.canvas.add(this.prevLine))},W.prototype.getCenter=function(){var t=this.vertices.map((function(t){var e=t.left,n=t.top;return[e,n]}));return Object(x["l"])(t)},W.prototype.getGroup=function(){var t=this,e=this.vertices.map((function(e){return t.myFabric.clone(e).set("opacity",.5)})),n=this.arrows.map((function(e){return t.myFabric.clone(e).set("opacity",.5)})),i=this.myFabric.clone(this.polygon),r=this.myFabric.clone(this.line).set("opacity",.5),o=e.concat(n).concat(i).concat(r);return new fabric.Group(o,{id:this.id,hasControls:!0,cornerStyle:"circle",padding:0,cornerSize:8,cornerColor:"transparent",transparentCorners:!0,cornerStrokeColor:"blue",lockSkewingX:!0,lockSkewingY:!0}).setControlsVisibility({mtr:!1})},W.prototype.showRed=function(){this.polygon.fill===this.polygon.defaultColor&&(this.polygon.set("fill",this.polygon.deleteColor),this.canvas.requestRenderAll())},W.prototype.showNormal=function(){this.polygon.fill===this.polygon.deleteColor&&(this.polygon.set("fill",this.polygon.defaultColor),this.canvas.requestRenderAll())},W.prototype.update=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{bounds:!0,geometricLines:!0},n=e.bounds,i=void 0===n||n,r=e.geometricLines,o=void 0===r||r;this.isVisible()?(this.updateVertexSize(),this.updateStructureText(),this.updateReadingOrderText(),this.updateVertices(),i&&(this.updateLineAndArrows(),this.updatePolygon()),o&&this.updateGeometricLines({chop:!0}),this.state===H.STATE.FIRST_DRAW&&(this.canvas.remove(this.polygon),(t=this.canvas).add.apply(t,Object(d["a"])(this.vertices)))):this.removeFromCanvas()},W.prototype.updateLineAndArrows=function(){var t;this.canvas.remove(this.line),(t=this.canvas).remove.apply(t,Object(d["a"])(this.arrows));var e,n=this.vertices.map((function(t){return[t.left,t.top]})),i=this.myFabric.getLineElements(n,this.id),r=i.line,o=i.arrows;(this.line=r,this.arrows=o,this.selected)?(e=this.canvas).add.apply(e,Object(d["a"])(this.arrows)):this.line.set("opacity",.5);this.canvas.add(this.line),this.canvas.sendToBack(this.line)},W.prototype.updatePolygon=function(){this.canvas.remove(this.polygon);var t=this.vertices.map((function(t){return[t.left,t.top]})),e=this.myFabric.getPolygon(t,this.id),n=e.polygon,i=e.polyCoords;this.polygon=n,this.polyCoords=i,this.selected?this.polygon.set("opacity",.3):this.polygon.set("opacity",.2),this.canvas.add(this.polygon),this.canvas.sendToBack(this.polygon)},W.prototype.getPolygonCoords=function(){return this.polyCoords.map((function(t){return{x:t[0],y:t[1]}}))},W.prototype.getArea=function(){return this.polyCoords},W.prototype.removeFromCanvas=function(){var t,e;(t=this.canvas).remove.apply(t,Object(d["a"])(this.vertices)),this.canvas.remove(this.line),(e=this.canvas).remove.apply(e,Object(d["a"])(this.arrows)),this.canvas.remove(this.polygon),this.canvas.remove(this.prevLine),this.canvas.remove(this.runningVertex),this.canvas.remove(this.structureText),this.canvas.remove(this.readingOrderText),this.canvas.discardActiveObject()},W.prototype.removeChildsFromCanvas=function(){this.words.map((function(t){t.unSelect(),t.removeFromCanvas()}))};var q=W;function $(t,e){var n=this;H.call(this,t),this.id=y.instance().requestId("r"),this.baselines=[],this.line={},this.background={},this.group={},this.pointerOnLine=!1,this.invisibleVertex=null,this.tempCoords={},this.initCoord=null,e&&(this.attributes=e.attributes,this.elements=e.elements,this.id=y.instance().requestId(e.attributes.id),this.text=e.elements.text,this.baselines=e.elements.textLines.map((function(t){return new q(n.canvas,t)})),e.elements.coords.map((function(t){var e=n.getVertex(t.x,t.y);n.addPoint(e,n.vertices.length)})),this.update())}$.prototype=Object.create(H.prototype),$.prototype.constructor=$,$.prototype.getBlueprint=function(t,e){var n=this;return this.attributes&&this.elements||(this.elements={coords:{},textLines:[],text:""}),this.attributes.id=this.id,this.setReadingOrder(t),this.elements.coords=this.vertices.map((function(t){return{x:t.left,y:t.top}})),this.elements.textLines=this.baselines.map((function(t,i){return t.getBlueprint(i,n.attributes.id,e)})),this.elements.text=this.text,{type:"text",attributes:this.attributes,elements:this.elements}},$.prototype.getType=function(){return H.TYPE.REGION},$.prototype.getLayout=function(){return{type:"Region",id:this.id,children:this.baselines.map((function(t){return t.getLayout()})),structureType:this.getStructureType()}},$.prototype.setState=function(t){this.activeVertex&&this.activeVertex.unSelect(),this.state=t},$.prototype.adjustToBaseline=function(t){var e=this,n=t.map((function(t){return[t.x,t.y]})),i=Object(x["h"])(n),r=[{x:i[0][0],y:i[0][1]},{x:i[1][0],y:i[0][1]},{x:i[1][0],y:i[1][1]},{x:i[0][0],y:i[1][1]}];r.map((function(t){var n=e.getVertex(t.x,t.y);e.addPoint(n,e.vertices.length)}))},$.prototype.removeFromCanvas=function(){var t;(t=this.canvas).remove.apply(t,Object(d["a"])(this.vertices)),this.canvas.remove(this.background),this.canvas.remove(this.line),this.canvas.remove(this.previewRect),this.canvas.remove(this.runningVertex),this.canvas.remove(this.structureText),this.canvas.remove(this.readingOrderText),this.canvas.discardActiveObject()},$.prototype.removeChildsFromCanvas=function(){this.baselines.map((function(t){t.unSelect(),t.removeFromCanvas(),t.removeChildsFromCanvas()}))},$.prototype.mark=function(){this.background.set("opacity",.1),this.canvas.contains(this.background)||this.canvas.add(this.background)},$.prototype.unMark=function(){this.background.set("opacity",.2),this.canvas.remove(this.background)},$.prototype.select=function(){this.selected=!0,this.update()},$.prototype.unSelect=function(){var t;this.selected=!1,(t=this.canvas).remove.apply(t,Object(d["a"])(this.vertices)),this.canvas.remove(this.background),this.canvas.remove(this.previewRect,this.runningVertex)},$.prototype.getGroup=function(){var t=this,e=this.vertices.map((function(e){return t.myFabric.clone(e).set({radius:0})})),n=this.myFabric.clone(this.background),i=e.concat(n);return new fabric.Group(i,{id:this.id,hasControls:!0,subTargetCheck:!0,cornerStyle:"circle",padding:0,cornerSize:8,cornerColor:"transparent",transparentCorners:!0,cornerStrokeColor:"green",lockSkewingX:!0,lockSkewingY:!0}).setControlsVisibility({mtr:!1})},$.prototype.getLargeGroup=function(){},$.prototype.addBaseline=function(t,e){null==e&&(e=this.expectedIndex(t)),this.baselines.splice(e,0,t)},$.prototype.removeBaseline=function(t){this.baselines=this.baselines.filter((function(e){return e.id!=t}))},$.prototype.expectedIndex=function(t){var e=t.vertices[0].top,n=this.baselines.map((function(t){return t.vertices[0].top})).sort((function(t,e){return t-e})),i=n.findIndex((function(t){return t>e}));return-1===i?n.length:i},$.prototype.getBaselines=function(){return Object(d["a"])(this.baselines)},$.prototype.showRed=function(){this.background.fill===this.background.defaultColor&&(this.background.set("fill",this.background.deleteColor),this.canvas.add(this.background))},$.prototype.showNormal=function(){this.background.fill===this.background.deleteColor&&(this.background.set("fill",this.background.defaultColor),this.canvas.remove(this.background))},$.prototype.update=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{bounds:!0,geometricLines:!0},e=t.bounds,n=void 0===e||e,i=t.geometricLines,r=void 0===i||i;this.isVisible()?(this.updateVertexSize(),this.updateStructureText(),this.updateReadingOrderText(),this.updateVertices(),n&&(this.updateLine(),this.updateBackground()),r&&this.updateGeometricLines()):this.removeFromCanvas()},$.prototype.updateLine=function(){this.canvas.remove(this.line);var t=this.vertices.map((function(t){return{x:t.left,y:t.top}}));this.line=this.myFabric.getRegionLine(t,this.id),this.canvas.add(this.line),this.canvas.sendToBack(this.line)},$.prototype.updateBackground=function(){this.canvas.remove(this.background);var t=this.vertices.map((function(t){return{x:t.left,y:t.top}}));this.background=this.myFabric.getRegionBackground(t,this.id),this.selected&&(this.canvas.add(this.background),this.canvas.sendToBack(this.background))},$.prototype.getArea=function(){return this.vertices.map((function(t){return[t.left,t.top]}))},$.prototype.getCoords=function(){return this.vertices.map((function(t){return{x:t.left,y:t.top}}))},$.prototype.showPreviewRect=function(t,e){this.canvas.remove(this.previewRect),this.previewRect=this.myFabric.getPreviewRect(this.initCoord.x,this.initCoord.y,t,e),this.canvas.add(this.previewRect)},$.prototype.handleDBLClickEvent=function(t,e){},$.prototype.handleMouseMoveEvent=function(t){if(this.state===H.STATE.FIRST_DRAW){if(this.initCoord){var e=this.canvas.getPointer(t.e);this.showPreviewRect(e.x,e.y)}}else if(this.state===H.STATE.EDIT){if(this.preview){var n=this.canvas.getPointer(t.e),i=2;this.canvas.remove(this.runningVertex);var r=I(this.geometricLines,n),o=r.line,s=r.point;if(s&&o){this.runningVertex=this.myFabric.getRunningCircle(s[0],s[1]);var a=this;this.runningVertex.on("mousedown",(function(t){a.preview=!1})),this.runningVertex.on("moving",(function(t){var e,n,r=a.getVertexById(o.parentIds[0]),s=a.getVertexById(o.parentIds[1]),c=V(r.left,r.top,s.left,s.top),l=V(this.left,this.top,r.left,r.top)+V(this.left,this.top,s.left,s.top),u=(l-c)/i+.2;(e=a.canvas).remove.apply(e,Object(d["a"])(a.prevLines)),a.prevLines=[a.myFabric.getPreviewLine([this.left,this.top,r.left,r.top],u).set("stroke","green"),a.myFabric.getPreviewLine([this.left,this.top,s.left,s.top],u).set("stroke","green")],this.set("opacity",u),(n=a.canvas).add.apply(n,Object(d["a"])(a.prevLines))})),this.runningVertex.on("mouseup",(function(t){var e,n=a.getVertexById(o.parentIds[0]),r=a.getVertexById(o.parentIds[1]),s=V(n.left,n.top,r.left,r.top),c=V(this.left,this.top,n.left,n.top)+V(this.left,this.top,r.left,r.top);if(c-s>i){a.canvas.remove(this);var l=a.getVertex(this.left,this.top);a.actionHandler.addAction({type:g.ADD_POINT,shape_id:a.id,point_id:l.id,point_index:a.getVertexIndex(o.parentIds[1])}),a.addPoint(l,a.getVertexIndex(o.parentIds[1])),a.canvas.setActiveObject(l),l.fire("mouseover"),l.select()}a.preview=!0,(e=a.canvas).remove.apply(e,Object(d["a"])(a.prevLines)),a.canvas.remove(this)})),this.canvas.add(this.runningVertex),this.runningVertex.set("fill","green"),this.runningVertex.sendToBack(),this.canvas.requestRenderAll()}}}else(this.previewRect||this.runningVertex)&&(this.canvas.remove(this.previewRect,this.runningVertex),this.previewRect=null,this.runningVertex=null)},$.prototype.handleMouseOut=function(t){},$.prototype.getVertex=function(t,e,n){var i=this.myFabric.getRegionCircle(t,e,n);this.lastAddedVertex=i;var r=this;return i.select=function(){r.activeVertex&&r.activeVertex.set("fill",this.defaultColor),r.activeVertex=this,r.activeVertex.set("fill",this.selectedColor)},i.unSelect=function(){r.activeVertex&&(r.activeVertex.set("fill",this.defaultColor),r.activeVertex=null)},i.on("mousedown",(function(t){if(r.tempCoords={left:this.left,top:this.top},this.select(),r.state===H.STATE.REMOVE_VERTEX&&r.vertices.length>3){var e=r.vertices.findIndex((function(e){return e.id===t.target.id}));r.removePoint(t.target.id),r.actionHandler.addAction({type:g.REMOVE_POINT,shape_id:r.id,point_id:t.target.id,point_index:e})}})),i.on("moving",(function(t){r.update({geometricLines:!1})})),i.on("mouseup",(function(t){!r.tempCoords||r.state==H.STATE.GROUP_SELECTION||r.tempCoords.left==this.left&&r.tempCoords.top==this.top||(r.update(),r.actionHandler.addAction({type:g.MOVE_POINT,shape_id:r.id,point_id:this.id,old_coords:r.tempCoords,new_coords:{left:this.left,top:this.top}}),r.tempCoords=null)})),i},$.prototype.moveVertexById=function(t,e){var n=this.vertices.find((function(e){return e.id===t}));n.set({left:e[0],top:e[1]}),n.setCoords(),this.canvas.requestRenderAll()};var G=$,z=function(){var t;function e(){var t=new Y;return t}return{instance:function(){return t||(t=e()),t}}}();function Y(){this.open=null}function X(t,e){var n=this;if(H.call(this,t),this.id=y.instance().requestId("c"),this.canvas=t,this.myFabric=w.instance(),this.row=null,this.col=null,this.rowSpan=1,this.colSpan=1,this.spanVertices=null,this.vertices=[],this.invisibleVertices=[],this.baselines=[],this.selected=!1,this.tableSelected=!1,this.type=X.TYPE.REGULAR,e){this.attributes=e.attributes;var i=e.attributes,r=i.row,o=i.col,s=i.rowSpan,a=i.colSpan;this.row=parseInt(r),this.col=parseInt(o),this.rowSpan=s?parseInt(s):1,this.colSpan=a?parseInt(a):1,this.elements=e.elements,this.id=y.instance().requestId(e.attributes.id),this.baselines=e.elements.textLines.map((function(t){return new q(n.canvas,t)}))}}Y.prototype.setOpenFn=function(t){this.open=t},Y.prototype.open=function(t,e){this.openFn(t,e)},X.prototype=Object.create(H.prototype),X.prototype.constructor=X,X.TYPE=Object.freeze({REGULAR:0,PARENT:1,CHILD:2}),X.prototype.getBlueprint=function(t,e,n){var i=this;return this.attributes.id=this.id,this.attributes.row=this.row,this.attributes.col=this.col,this.attributes.rowSpan=this.rowSpan,this.attributes.colSpan=this.colSpan,this.isSpanParent()?this.elements.coords=this.spanVertices.map((function(t){return{x:t.left,y:t.top}})):this.elements.coords=this.vertices.map((function(t){return{x:t.left,y:t.top}})),this.elements.textLines=this.baselines.map((function(t,e){return t.getBlueprint(e,i.attributes.id,n)})),this.elements.cornerPoints=this.getCornerPointsIndices(),{attributes:this.attributes,elements:this.elements}},X.prototype.getType=function(){return H.TYPE.CELL},X.prototype.getLayout=function(){return{type:"Cell",id:this.id,children:this.baselines.map((function(t){return t.getLayout()})),structureType:this.getStructureType()}},X.prototype.select=function(){var t,e=this.isSpanParent()?this.spanVertices:this.vertices;this.selected||(this.selected=!0,this.baselines.map((function(t){t.polygon.set("fill","purple")})),(t=this.canvas).add.apply(t,Object(d["a"])(e)),this.updateBackground(e))},X.prototype.unSelect=function(){var t;if(this.selected){var e=this.isSpanParent()?this.spanVertices:this.vertices;this.selected=!1,this.baselines.map((function(t){t.polygon.set("fill","blue")})),(t=this.canvas).remove.apply(t,Object(d["a"])(e)),this.updateBackground(e),this.tableSelected||this.showFrameOnly()}},X.prototype.handleMouseMoveEvent=function(t){},X.prototype.updateFrame=function(t){this.canvas.remove(this.frame),this.frame=this.myFabric.getCellFrame(t.map((function(t){var e=t.left,n=t.top;return{x:e,y:n}}))),this.canvas.add(this.frame),this.canvas.sendToBack(this.frame)},X.prototype.updateBackground=function(t,e){this.canvas.remove(this.background),this.background=this.myFabric.getCellBackground(t.map((function(t){var e=t.left,n=t.top;return{x:e,y:n}})),this.getColor(),e||this.getOpacity()),this.canvas.add(this.background),this.canvas.sendToBack(this.background)},X.prototype.isSpanParent=function(){return this.type===X.TYPE.PARENT},X.prototype.isSpanChild=function(){return this.type===X.TYPE.CHILD},X.prototype.getCornerPointsIndices=function(){return[0,this.rowSpan,this.rowSpan+this.colSpan,2*this.rowSpan+this.colSpan]},X.prototype.getColor=function(){return this.selected?"green":this.isSpanParent()?"purple":(this.row+this.col)%2===0?"yellow":"orange"},X.prototype.getOpacity=function(){return this.selected?.3:.1},X.prototype.mark=function(){var t=this.isSpanParent()?this.spanVertices:this.vertices;this.updateBackground(t,.1)},X.prototype.unMark=function(){this.showFrameOnly()},X.prototype.update=function(){if(this.isVisible()){if(this.updateVertexSize(),this.updateStructureText(),this.updateGeometricLines(),!this.isSpanChild()){var t,e,n=this.isSpanParent()?this.spanVertices:this.vertices;if(this.updateFrame(n),this.updateBackground(n),this.selected)(t=this.canvas).remove.apply(t,Object(d["a"])(n)),(e=this.canvas).add.apply(e,Object(d["a"])(n));this.tableSelected||this.showFrameOnly()}}else this.removeFromCanvas()},X.prototype.setType=function(t){this.type=t},X.prototype.addBaseline=function(t,e){if(null==e){var n=t.vertices[0].top,i=this.baselines.map((function(t){return t.vertices[0].top})).sort((function(t,e){return t-e})),r=i.findIndex((function(t){return t>n}));return r=-1===r?i.length:r,void this.baselines.splice(r,0,t)}this.baselines.splice(e,0,t)},X.prototype.removeBaseline=function(t){this.baselines=this.baselines.filter((function(e){return e.id!=t}))},X.prototype.expectedIndex=function(t){var e=t.vertices[0].top,n=this.baselines.map((function(t){return t.vertices[0].top})).sort((function(t,e){return t-e})),i=n.findIndex((function(t){return t>e}));return-1===i?n.length:i},X.prototype.removeFromCanvas=function(){var t;this.canvas.remove(this.background),this.canvas.remove(this.frame),(t=this.canvas).remove.apply(t,Object(d["a"])(this.vertices)),this.canvas.remove(this.structureText),this.canvas.remove(this.readingOrderText)},X.prototype.showFrameOnly=function(){var t,e=this.isSpanParent()?this.spanVertices:this.vertices;this.canvas.remove(this.background),(t=this.canvas).remove.apply(t,Object(d["a"])(e)),this.isSpanChild()?this.canvas.remove(this.frame):this.canvas.contains(this.frame)||this.canvas.add(this.frame)},X.prototype.getArea=function(){var t=this.isSpanParent()?this.spanVertices:this.isSpanChild()?[]:this.vertices;return t.map((function(t){return[t.left,t.top]}))},X.prototype.getCellPolygon=function(){return this.vertices.map((function(t){return[t.left,t.top]}))},X.prototype.setVertices=function(t){this.vertices=Object(d["a"])(t)},X.prototype.setSpanVertices=function(t){this.spanVertices=Object(d["a"])(t)},X.prototype.getLeftVertices=function(){var t=Object(u["a"])(this.vertices,2),e=t[0],n=t[1];return[e,n]},X.prototype.getBottomVertices=function(){var t=Object(u["a"])(this.vertices,3),e=t[1],n=t[2];return[e,n]},X.prototype.getRightVertices=function(){var t=Object(u["a"])(this.vertices,4),e=t[2],n=t[3];return[n,e]},X.prototype.getTopVertices=function(){var t=Object(u["a"])(this.vertices,4),e=t[0],n=t[3];return[e,n]};var J=X;function Z(t,e){this.matrix=Object(d["a"])(Array(t)).map((function(t){return Array(e).fill(null)})),this.deletedCells=[]}Z.ROWSPAN=Object.freeze({span:!0,rowspan:!0}),Z.COLSPAN=Object.freeze({span:!0,colspan:!0}),Z.SPAN_PACK=Object.freeze({pack:!0}),Z.prototype.log=function(){this.matrix.map((function(t,e){return t.map((function(t){if(!t)return"null";if(!t.id)return JSON.stringify(t);var e=t.vertices.reduce((function(t,e){var n="".concat(t).concat(e.id,", ");return n}),"");return"[".concat(t.id,"] ").concat(e.slice(0,-2))}))}))},Z.prototype.setCell=function(t,e,n){e>this.matrix.length-1||n>this.matrix[0].length-1||(this.removeCell(e,n),this.matrix[e][n]=t)},Z.prototype.removeCell=function(t,e){var n,i=null===(n=this.matrix[t])||void 0===n?void 0:n[e];if(null!=i)return i.unSelect(),i.removeFromCanvas(),this.deletedCells.push({object:i,row:t,col:e}),this.matrix[t][e]=null,i},Z.prototype.removeCellById=function(t){var e=this.allCells().find((function(e){return(null===e||void 0===e?void 0:e.id)===t})),n=e.row,i=e.col;this.removeCell(n,i)},Z.prototype.getCell=function(t,e){if(this.matrix[t])return this.matrix[t][e]},Z.prototype.getCellById=function(t){return this.allCells().find((function(e){return(null===e||void 0===e?void 0:e.id)===t}))},Z.prototype.getWidth=function(){return this.matrix[0].length},Z.prototype.getHeight=function(){return this.matrix.length},Z.prototype.getCellsOfColumn=function(t){var e=this.getTransposedMatrix();return e[t]},Z.prototype.getCellsOfRow=function(t){return this.matrix[t]},Z.prototype.createColumn=function(t){this.matrix.map((function(e){e.splice(t,0,null)}))},Z.prototype.createRow=function(t){this.matrix.splice(t,0,this.matrix[0].map((function(t){return null})))},Z.prototype.deleteColumn=function(t){var e=this;this.matrix.map((function(n,i){e.removeCell(i,t),n.splice(t,1)}))},Z.prototype.deleteRow=function(t){var e=this;this.matrix[t].map((function(n,i){e.removeCell(t,i)})),this.matrix.splice(t,1)},Z.prototype.noVerticalSplit=function(t,e){var n=e.reduce((function(t,e){return[].concat(Object(d["a"])(t),[e.getTopVertices().reduce((function(t,e){return[].concat(Object(d["a"])(t),[[e.left,e.top]])}),[]),e.getBottomVertices().reduce((function(t,e){return[].concat(Object(d["a"])(t),[[e.left,e.top]])}),[])])}),[]);return log(n),n.some((function(e){return log(!Object(x["c"])(e,t)),log(e),log(t),!Object(x["c"])(e,t)}))},Z.prototype.noHorizontalSplit=function(t,e){var n=e.reduce((function(t,e){return[].concat(Object(d["a"])(t),[e.getLeftVertices().reduce((function(t,e){return[].concat(Object(d["a"])(t),[[e.left,e.top]])}),[]),e.getRightVertices().reduce((function(t,e){return[].concat(Object(d["a"])(t),[[e.left,e.top]])}),[])])}),[]);return n.some((function(e){return!Object(x["c"])(e,t)}))},Z.prototype.splitForbidden=function(t,e){console.log(e),console.log(t);var n=e.map((function(e){var n=k(e,t).map((function(t){return t.vertices}));if(3!=n.length)return!0;var i=3===n[0].length&&4===n[1].length&&1===n[2].length,r=2===n[0].length&&4===n[1].length&&2===n[2].length;return!i&&!r}));return n.some((function(t){return t}))},Z.prototype.removeForbidden=function(t,e){if(t<=0)return!0;var n=e?this.matrix[0].length:this.matrix.length;return n<=t},Z.prototype.areVerticalNeighbors=function(t,e){var n=this.getPosition(t),i=this.getPosition(e),r=n.row===i.row+1||n.row===i.row-1,o=n.col===i.col;return r&&o},Z.prototype.areHorizontalNeighbors=function(t,e){var n=this.getPosition(t),i=this.getPosition(e),r=n.col===i.col+1||n.col===i.col-1,o=n.row===i.row;return r&&o},Z.prototype.getSharedVertexIds=function(t,e){return t.vertices.filter((function(t){return e.vertices.includes(t)})).map((function(t){return t.id}))},Z.prototype.updateCellProperties=function(){var t=this;this.allCells().some((function(t){return null==t}))&&console.log("Error: invalid Table (missing cell definition)"),this.allCells().map((function(t){t.setType(J.TYPE.REGULAR)})),this.matrix.map((function(e,n){e.map((function(e,i){if(e.row=n,e.col=i,1!=e.rowSpan||1!=e.colSpan){if(t.incorrectValues(e))return e.rowSpan=1,void(e.colSpan=1);var r=t.getSpanVertices(n,i,e.rowSpan,e.colSpan);e.setSpanVertices(r),e.setType(J.TYPE.PARENT),t.getSpanChilds(n,i,e.rowSpan,e.colSpan).map((function(t){var n;t.setType(J.TYPE.CHILD),(n=e.baselines).push.apply(n,Object(d["a"])(t.baselines)),e.text=e.text+t.text,t.baselines=[],t.text="",t.unSelect(),t.removeFromCanvas()}))}}))}))},Z.prototype.getSpanVertices=function(t,e,n,i){var r=this,o=Array.from({length:n},(function(t,e){return e})),s=Array.from({length:i},(function(t,e){return e})),a=[];return o.map((function(n){a.push.apply(a,Object(d["a"])(r.getCell(t+n,e).getLeftVertices()))})),s.map((function(n){a.push.apply(a,Object(d["a"])(r.getCell(t+o.length-1,e+n).getBottomVertices()))})),o.reverse().map((function(n){a.push.apply(a,Object(d["a"])(r.getCell(t+n,e+s.length-1).getRightVertices()))})),s.reverse().map((function(n){a.push.apply(a,Object(d["a"])(r.getCell(t,e+n).getTopVertices()))})),Object(d["a"])(new Set(a))},Z.prototype.getSpanChilds=function(t,e,n,i){var r=this,o=Array.from({length:n},(function(t,e){return e})),s=Array.from({length:i},(function(t,e){return e})),a=[];return o.map((function(n){s.map((function(i){(n>0||i>0)&&a.push(r.getCell(t+n,e+i))}))})),a},Z.prototype.incorrectValues=function(t){var e=this,n=Array.from({length:t.rowSpan},(function(t,e){return e})),i=Array.from({length:t.colSpan},(function(t,e){return e})),r=this.getPosition(t),o=r.row,s=r.col,a=n.some((function(t){return i.some((function(n){var i=e.getCell(o+t,s+n);return null==i||i.isSpanParent()||i.isSpanChild()}))}));return a},Z.prototype.getPosition=function(t){var e={};return this.matrix.find((function(n,i){return n.find((function(n,r){return e.row=i,e.col=r,n===t}))})),e},Z.prototype.allCells=function(){return this.matrix.flat()},Z.prototype.allVertices=function(){return Object(d["a"])(this.allCells().reduce((function(t,e){return new Set([].concat(Object(d["a"])(t),Object(d["a"])(e.vertices)))}),new Set))},Z.prototype.getTransposedMatrix=function(){var t=this;return this.matrix[0].map((function(e,n){return t.matrix.map((function(t){return t[n]}))}))},Z.prototype.rowExists=function(t){return!!this.matrix[t]},Z.prototype.colExists=function(t){return!!this.matrix[0][t]},Z.prototype.getVerticalCircles=function(){var t=[],e=[];return this.getTransposedMatrix().map((function(n,i,r){e.push(n.reduce((function(e,n){var i=n.getLeftVertices().filter((function(e){return!t.includes(e)}));return t.push.apply(t,Object(d["a"])(i)),[].concat(Object(d["a"])(e),Object(d["a"])(i))}),[])),i>=r.length-1&&e.push(n.reduce((function(e,n){var i=n.getRightVertices().filter((function(e){return!t.includes(e)}));return t.push.apply(t,Object(d["a"])(i)),[].concat(Object(d["a"])(e),Object(d["a"])(i))}),[]))})),e},Z.prototype.getHorizontalCircles=function(){var t=[],e=[];return this.matrix.map((function(n,i,r){e.push(n.reduce((function(e,n){var i=n.getTopVertices().filter((function(e){return!t.includes(e)}));return t.push.apply(t,Object(d["a"])(i)),[].concat(Object(d["a"])(e),Object(d["a"])(i))}),[])),i>=r.length-1&&e.push(n.reduce((function(e,n){var i=n.getBottomVertices().filter((function(e){return!t.includes(e)}));return t.push.apply(t,Object(d["a"])(i)),[].concat(Object(d["a"])(e),Object(d["a"])(i))}),[]))})),e},Z.prototype.getCellParent=function(t,e){return this.allCells().find((function(n){var i=t>=n.row&&t<n.row+n.rowSpan&&e>=n.col&&e<n.col+n.colSpan;return i}))},Z.prototype.getNeighbor=function(t,e,n){var i,r=this.getCellParent(t,e);switch(n){case"right":i=this.getCell(t,e+1);break;case"left":i=this.getCell(t,e-1);break;case"top":i=this.getCell(t-1,e);break;case"bottom":i=this.getCell(t+1,e);break}if(null!=i){var o=this.getCellParent(i.row,i.col);return r===o?this.getNeighbor(i.row,i.col,n):i}},Z.prototype.mergeParents=function(t,e){var n=Math.min(t.row,e.row),i=Math.min(t.col,e.col),r=Math.max(t.row+t.rowSpan-1,e.row+e.rowSpan-1),o=Math.max(t.col+t.colSpan-1,e.col+e.colSpan-1),s=this.getCell(n,i),a=r-n+1,c=o-i+1;return{newParent:s,newRowSpan:a,newColSpan:c}},Z.prototype.getAllParents=function(){return this.allCells().filter((function(t){return t.isSpanParent()}))},Z.prototype.getCellsOfVertex=function(t){return this.allCells().filter((function(e){return e.vertices.some((function(e){return e.id===t}))}))};var K=Z;function Q(t,e){var n=this;if(H.call(this,t),this.id=y.instance().requestId("t"),this.state=H.STATE.EDIT,this.prev=!0,this.hoverLine=null,this.hoveredVertex=null,this.mousePosition={},this.selected=!1,this.idHandler=y.instance(),this.canvas=t,this.myFabric=w.instance(),this.markedCell=null,this.background={},this.vertices=[],this.horizontalLines=[],this.verticalLines=[],this.cellMatrix=new K(0,0),e){this.attributes=e.attributes,this.elements=e.elements,this.id=y.instance().requestId(e.attributes.id),this.text=e.elements.text;var i=e.elements.cells.map((function(t){return n.createCell(t)}));if(!this.validateCells(i))return void this.setTableInvalid(i);i=i.reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(n.requestChop(e)))}),[]);var r=i.reduce((function(t,e){return e.row>=t?e.row+1:t}),0),o=i.reduce((function(t,e){return e.col>=t?e.col+1:t}),0);this.cellMatrix=new K(r,o),i.map((function(t){var e=t.elements.coords.map((function(t){return n.getVertexByCoords(t.x,t.y)||n.creatVertex(t.x,t.y)}));t.setVertices(e),n.cellMatrix.setCell(t,t.row,t.col)})),this.cellMatrix.log(),this.update(),this.unSelect()}}Q.prototype=Object.create(H.prototype),Q.prototype.constructor=Q,Q.prototype.getBlueprint=function(t,e){var n=this;return this.attributes&&this.elements||(this.elements={coords:{},textLines:[],text:""}),this.attributes.id=this.id,this.setReadingOrder(t),this.elements.coords=this.getTableCoords(),this.elements.cells=this.allCells().filter((function(t){return!t.isSpanChild()})).map((function(t,i){return t.getBlueprint(i,n.attributes.id,e)})),this.elements.text=this.text,{type:"table",attributes:this.attributes,elements:this.elements}},Q.prototype.getType=function(){return H.TYPE.TABLE},Q.prototype.getLayout=function(){return{type:"Table",id:this.id,children:this.allCells().filter((function(t){return!t.isSpanChild()})).map((function(t){return t.getLayout()})),structureType:this.getStructureType()}},Q.prototype.getTableCoords=function(){var t=this.cellMatrix.getHeight()-1,e=this.cellMatrix.getWidth()-1,n=this.cellMatrix.getCell(0,0).vertices[0],i=this.cellMatrix.getCell(0,e).vertices[3],r=this.cellMatrix.getCell(t,e).vertices[2],o=this.cellMatrix.getCell(t,0).vertices[1];return[n,i,r,o].map((function(t){var e=t.left,n=t.top;return{x:e,y:n}}))},Q.prototype.requestChop=function(t){var e=this,n=t.row,i=t.col,r=t.colSpan,o=this.getCorrectedCoords(t),s=this.getTubes(o,r),a=s.reduce((function(t,r,o){return[].concat(Object(d["a"])(t),Object(d["a"])(e.getCellsOfTube(r,n+o,i)))}),[]),c=a[0].elements.coords;return a[0]=t,a[0].elements.coords=c,a},Q.prototype.validateCells=function(t){var e=[],n=t.reduce((function(t,e){return e.row>t?e.row:t}),0),i=t.reduce((function(t,e){return e.col>t?e.col:t}),0),r=Array.from({length:n+1},(function(t,e){return e})),o=Array.from({length:i+1},(function(t,e){return e})),s=r.reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(o.map((function(t){return[e,t]}))))}),[]),a=t.reduce((function(t,n){var i=n.colSpan,r=n.rowSpan,o=Array.from({length:r},(function(t,e){return e})),s=Array.from({length:i},(function(t,e){return e}));o.map((function(t){s.map((function(i){e.push([n.row+t,n.col+i])}))}));var a=n.elements.coords,c=n.elements.cornerPoints,l=2*r+2*i,u=JSON.stringify([0,r,r+i,2*r+i])===JSON.stringify(c),d=l===a.length;return d&&u||4===l&&a.length>4?t:(z.instance().open("Table Error","Invalid cell found"),!1)}),!0),c=s.every((function(t){return!!e.some((function(e){return Object(p["isEqual"])(t,e)}))||(z.instance().open("Table Error","Missing cell at row: ".concat(t[0]," col: ").concat(t[1])),!1)}));return a&&c},Q.prototype.getCorrectedCoords=function(t){var e=2*t.rowSpan+2*t.colSpan===4;return e&&t.elements.coords.length>4?t.elements.coords.filter((function(e,n){return t.elements.cornerPoints.includes(n)})):t.elements.coords},Q.prototype.getTubes=function(t,e){var n=2*e+2===t.length;if(n)return[t];var i=t.length,r=Object(u["a"])(t,2),o=r[0],s=r[1],a=t.filter((function(t,n){return n>1&&n<=i-e-2})),c=t.filter((function(t,n){return n>i-e-2&&n<=i-e})),l=Object(u["a"])(c,2),p=l[0],h=l[1],f=Object(d["a"])(t.filter((function(t,n){return n>i-e}))),v=s.y-o.y,g=f.map((function(t){var e=t.x,n=t.y;return{x:e,y:n+v}})).reverse(),m=[o,s].concat(Object(d["a"])(g),[p,h],Object(d["a"])(f)),y=[s].concat(Object(d["a"])(a),[p],Object(d["a"])(Object(d["a"])(g).reverse()));return[m].concat(Object(d["a"])(this.getTubes(y,e)))},Q.prototype.getCellsOfTube=function(t,e,n){var i=this,r=[],o=function t(o){var s=o.length/2-1,a=i.createCell();a.col=n+s-1,a.row=e,a.elements={coords:[o[(s+3)%o.length],o[s],o[s+1],o[s+2]]},r=[a].concat(Object(d["a"])(r));var c=Object(d["a"])(o);c.splice(s+1,2),c.length>2&&t(c)};return o(t),r},Q.prototype.init=function(t){var e=this;this.cellMatrix=new K(1,1);var n=this.createCell(),i=t.map((function(t){return e.creatVertex(t.x,t.y)}));n.setVertices(i),this.cellMatrix.setCell(n,0,0),this.cellMatrix.log(),this.update()},Q.prototype.update=function(){var t=this;this.isVisible()?(this.updateVertexSize(),this.updateStructureText(),this.updateReadingOrderText(),this.allCells().map((function(e){e.tableSelected=t.selected})),this.updateMatrix(),this.updateLines(),this.updateCells(),this.selected||this.unSelect()):this.removeFromCanvas()},Q.prototype.allCells=function(){return this.cellMatrix.allCells()},Q.prototype.updateMatrix=function(){this.cellMatrix.updateCellProperties()},Q.prototype.updateLines=function(){var t=this,e=this.cellMatrix.getHorizontalCircles().map((function(e,n){return{id:t.idHandler.requestId("tl"),polygons:P(e).map((function(t){var e=t.polygon;return e})).slice(0,-1),vertices:Object(d["a"])(e),isVertical:!1,index:n}})),n=this.cellMatrix.getVerticalCircles().map((function(e,n){return{id:t.idHandler.requestId("tl"),polygons:P(e).map((function(t){var e=t.polygon;return e})).slice(0,-1),vertices:Object(d["a"])(e),isVertical:!0,index:n}}));this.lines=[].concat(Object(d["a"])(e),Object(d["a"])(n))},Q.prototype.updateCells=function(){this.cellMatrix.allCells().map((function(t){return t.update()}))},Q.prototype.updateCircles=function(t){t.relations.map((function(e,n){var i=fabric.util.multiplyTransformMatrices(t.calcTransformMatrix(),e),r=fabric.util.qrDecompose(i),o=t.vertices[n];o.set({left:r.translateX,top:r.translateY})}))},Q.prototype.getPositionOfLine=function(t){},Q.prototype.getRelations=function(t,e){return e.map((function(e){var n=e.calcTransformMatrix(),i=fabric.util.invertTransform(t.calcTransformMatrix());return fabric.util.multiplyTransformMatrices(i,n)}))},Q.prototype.getGroup=function(){var t=this,e=this.allLines().map((function(e){return t.myFabric.clone(e)})),n=this.getCellBackgrounds().map((function(e){return t.myFabric.clone(e)})),i=[].concat(Object(d["a"])(e),Object(d["a"])(n)),r=new fabric.Group(i,{id:this.id,hasControls:!0,cornerStyle:"circle",padding:0,cornerSize:12,cornerColor:"transparent",transparentCorners:!0,cornerStrokeColor:"yellow",strokeUniform:!0}).setControlsVisibility({mtr:!1}),o=this.allVertices().map((function(t){var e=t.calcTransformMatrix(),n=fabric.util.invertTransform(r.calcTransformMatrix());return fabric.util.multiplyTransformMatrices(n,e)}));return r.relations=o,r},Q.prototype.getLargeGroup=function(){var t=this,e=this.allLines().map((function(e){return t.myFabric.clone(e)})),n=this.getCellBackgrounds().map((function(e){return t.myFabric.clone(e)})),i=this.getBaselines().map((function(t){return t.getGroup()})),r=[].concat(Object(d["a"])(e),Object(d["a"])(n),Object(d["a"])(i)),o=new fabric.Group(r,{id:this.id,hasControls:!0,cornerStyle:"circle",padding:0,cornerSize:12,cornerColor:"transparent",transparentCorners:!0,cornerStrokeColor:"yellow",strokeUniform:!0}).setControlsVisibility({mtr:!1});return o},Q.prototype.getCellBackgrounds=function(){return this.cellMatrix.allCells().map((function(t){return t.background}))},Q.prototype.moveAllPointsWithVector=function(t){var e=t.x,n=t.y;this.allVertices().map((function(t){t.set({left:t.left+e,top:t.top+n}),t.setCoords()})),this.update()},Q.prototype.removeFromCanvas=function(){var t,e;(t=this.canvas).remove.apply(t,Object(d["a"])(this.allLines())),(e=this.canvas).remove.apply(e,Object(d["a"])(this.allVertices())),this.allCells().map((function(t){return t.removeFromCanvas()})),this.canvas.remove(this.structureText),this.canvas.remove(this.readingOrderText),this.canvas.remove(this.previewRect),this.canvas.remove(this.hoverLine)},Q.prototype.removeChildsFromCanvas=function(){this.allCells().map((function(t){return t.baselines.map((function(t){return t.removeFromCanvas()}))}))},Q.prototype.select=function(){this.selected=!0,this.update()},Q.prototype.unSelect=function(){this.selected=!1,this.selectNewCell(null),this.canvas.remove(this.previewRect),this.canvas.remove(this.hoverLine),this.hoverLine=null,this.allCells().map((function(t){t.showFrameOnly(),t.tableSelected=!1}))},Q.prototype.getFrame=function(){var t=this.verticalLines[0],e=this.horizontalLines[this.horizontalLines.length-1],n=this.verticalLines[this.verticalLines.length-1],i=this.horizontalLines[0];return[t,e,n,i]},Q.prototype.allLines=function(){return[].concat(Object(d["a"])(this.horizontalLines),Object(d["a"])(this.verticalLines))},Q.prototype.getArea=function(){var t=Object(x["i"])(this.allVertices().map((function(t){return[t.left,t.top]})));return t},Q.prototype.getBaselines=function(){var t=this.allCells().reduce((function(t,e){return e?[].concat(Object(d["a"])(t),Object(d["a"])(e.baselines)):t}),[]);return t},Q.prototype.removeLine=function(t){var e=this;this.canvas.remove(this.hoverLine),this.hoverLine=null;var n=this.lines.find((function(e){return e.id===t})),i=n.index,r=n.isVertical;if(!this.cellMatrix.removeForbidden(i,r)){var o=i-1,s=i,a=[],c=[],l=function(t,n,i,r){return[{type:g.REMOVE_CELL,shape_id:e.id,table:e,cell:t[0],row:t[0].row,col:t[0].col},{type:g.REMOVE_CELL,shape_id:e.id,table:e,cell:t[1],row:t[1].row,col:t[1].col},{type:g.ADD_CELL,shape_id:e.id,table:e,cell:n,row:i,col:r}]};if(r){var u=this.cellMatrix.getCellsOfColumn(o),p=this.cellMatrix.getCellsOfColumn(s);a=u.map((function(t,e){return[t,p[e]]})),a.map((function(t,n){var i=e.mergeCells(t);c.push.apply(c,Object(d["a"])(l(t,i,n,o)))})),c.push({type:g.REMOVE_TABLE_COLUM,shape_id:this.id,col_index:s})}else{var h=this.cellMatrix.getCellsOfRow(o),f=this.cellMatrix.getCellsOfRow(s);a=h.map((function(t,e){return[t,f[e]]})),a.map((function(t,n){var i=e.mergeCells(t);c.push.apply(c,Object(d["a"])(l(t,i,o,n)))})),c.push({type:g.REMOVE_TABLE_ROW,shape_id:this.id,row_index:s})}var v={type:g.MULTI_ACTION,shape_id:this.id,actions:c};this.actionHandler.addAction(v),this.actionHandler.doAction(v),this.cellMatrix.log(),this.update()}},Q.prototype.creatVertex=function(t,e,n){var i=this,r=this.myFabric.getTableCircle(t,e,n);return r.on("mousedown",(function(){i.saveTempCoords(r)})),r.on("moved",(function(){i.update(),i.actionHandler.addAction({type:g.MOVE_POINT,shape_id:i.id,point_id:r.id,old_coords:i.tempCoords[0],new_coords:{left:r.left,top:r.top}}),i.tempCoords=null})),this.vertices.push(r),r},Q.prototype.updateCellFrames=function(){this.allCells().map((function(t){return t.updateFrame()}))},Q.prototype.getVertex=function(t){return this.vertices.find((function(e){return e.id===t}))},Q.prototype.getVertexByCoords=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.vertices.find((function(i){return Math.abs(i.left-t)<=n&&Math.abs(i.top-e)<=n}))},Q.prototype.saveTempCoords=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.tempCoords=e.map((function(t){var e=t.top,n=t.left;return{top:e,left:n}}))},Q.prototype.addVerticalLine=function(t,e){var n=this,i=this.getCellFromPointer(t),r=this.cellMatrix.getPosition(i),o=r.col,s=this.cellMatrix.getCellsOfColumn(o);if(log("there"),!this.cellMatrix.noVerticalSplit(e,s)&&(log("between"),!this.cellMatrix.splitForbidden(e,s))){log("below");var a=s.map((function(t){return n.splitCellVertical(t,e)})),c=[];c.push({type:g.ADD_TABLE_COLUM,shape_id:this.id,col_index:o+1}),a.map((function(t,e){var i=Object(u["a"])(t,2),r=i[0],s=i[1],a=n.cellMatrix.getCell(e,o);c.push({type:g.REMOVE_CELL,shape_id:n.id,table:n,cell:a,row:e,col:o},{type:g.ADD_CELL,shape_id:n.id,table:n,cell:r,row:e,col:o},{type:g.ADD_CELL,shape_id:n.id,table:n,cell:s,row:e,col:o+1})}));var l={type:g.MULTI_ACTION,shape_id:this.id,actions:c};this.actionHandler.addAction(l),this.actionHandler.doAction(l),this.update(),this.cellMatrix.log()}},Q.prototype.addHorizontalLine=function(t,e){var n=this,i=this.getCellFromPointer(t),r=this.cellMatrix.getPosition(i),o=r.row,s=this.cellMatrix.getCellsOfRow(o);if(!this.cellMatrix.noHorizontalSplit(e,s)&&!this.cellMatrix.splitForbidden(e,s)){var a=s.map((function(t){return n.splitCellHorizontal(t,e)})),c=[];c.push({type:g.ADD_TABLE_ROW,shape_id:this.id,row_index:o+1}),a.map((function(t,e){var i=Object(u["a"])(t,2),r=i[0],s=i[1],a=n.cellMatrix.getCell(o,e);c.push({type:g.REMOVE_CELL,shape_id:n.id,table:n,cell:a,row:o,col:e},{type:g.ADD_CELL,shape_id:n.id,table:n,cell:r,row:o,col:e},{type:g.ADD_CELL,shape_id:n.id,table:n,cell:s,row:o+1,col:e})}));var l={type:g.MULTI_ACTION,shape_id:this.id,actions:c};this.actionHandler.addAction(l),this.actionHandler.doAction(l),this.update()}},Q.prototype.splitCellVertical=function(t,e){var n=this,i=k(t,e).map((function(t){return t.vertices})),r=Object(u["a"])(i,3),o=r[0],s=r[1],a=r[2];o.push.apply(o,Object(d["a"])(a));var c=s.pop();s=[c].concat(Object(d["a"])(s));var l=this.createCell(),p=this.createCell(),h=o.map((function(t){return n.getVertexByCoords(t.x,t.y,1)||n.creatVertex(t.x,t.y,t.id)})),f=s.map((function(t){return n.getVertexByCoords(t.x,t.y,1)||n.creatVertex(t.x,t.y,t.id)}));return l.setVertices(h),l.baselines=Object(d["a"])(t.baselines),l.text=t.text,l.rowSpan=t.rowSpan,l.colSpan=t.colSpan,p.setVertices(f),[l,p]},Q.prototype.splitCellHorizontal=function(t,e){var n=this,i=k(t,e).map((function(t){return t.vertices})),r=Object(u["a"])(i,3),o=r[0],s=r[1],a=r[2];o.push.apply(o,Object(d["a"])(a));var c=this.createCell(),l=this.createCell(),p=o.map((function(t){return n.getVertexByCoords(t.x,t.y,1)||n.creatVertex(t.x,t.y,t.id)})),h=s.map((function(t){return n.getVertexByCoords(t.x,t.y,1)||n.creatVertex(t.x,t.y,t.id)}));return c.setVertices(p),c.baselines=Object(d["a"])(t.baselines),c.text=t.text,c.rowSpan=t.rowSpan,c.colSpan=t.colSpan,l.setVertices(h),[c,l]},Q.prototype.mergeRow=function(t){var e=this,n=this.getCellFromPointer(t),i=this.cellMatrix.getPosition(n),r=i.row,o=this.cellMatrix.getCellsOfRow(r),s=o[0],a=[];o.map((function(t){if(t.isSpanChild()){var n=e.cellMatrix.getCellParent(t.row,t.col);a.push(e.getCellSpanAction(n,1,1)),n.rowSpan=1,n.colSpan=1}}));var c=this.cellMatrix.getWidth();a.push(this.getCellSpanAction(s,c,1)),s.rowSpan=1,s.colSpan=c,this.actionHandler.addAction({type:g.MULTI_ACTION,actions:a}),this.update(),this.cellMatrix.log()},Q.prototype.mergeColumn=function(t){var e=this,n=this.getCellFromPointer(t),i=this.cellMatrix.getPosition(n),r=i.col,o=this.cellMatrix.getCellsOfColumn(r),s=o[0],a=[];o.map((function(t){if(t.isSpanChild()){var n=e.cellMatrix.getCellParent(t.row,t.col);a.push(e.getCellSpanAction(n,1,1)),n.rowSpan=1,n.colSpan=1}}));var c=this.cellMatrix.getHeight();a.push(this.getCellSpanAction(s,c,1)),s.rowSpan=c,s.colSpan=1,this.actionHandler.addAction({type:g.MULTI_ACTION,actions:a}),this.update(),this.cellMatrix.log()},Q.prototype.dissolveCells=function(t){var e=this.getParentFromPointer(t);this.actionHandler.addAction(this.getCellSpanAction(e,1,1)),e.rowSpan=1,e.colSpan=1,this.update()},Q.prototype.mergeRightCell=function(t){var e=this.getCellFromPointer(t),n=this.cellMatrix.getNeighbor(e.row,e.col,"right");n&&this.mergeNeighbors(e,n)},Q.prototype.mergeLeftCell=function(t){var e=this.getCellFromPointer(t),n=this.cellMatrix.getNeighbor(e.row,e.col,"left");n&&this.mergeNeighbors(e,n)},Q.prototype.mergeTopCell=function(t){var e=this.getCellFromPointer(t),n=this.cellMatrix.getNeighbor(e.row,e.col,"top");n&&this.mergeNeighbors(e,n)},Q.prototype.mergeBottomCell=function(t){var e=this.getCellFromPointer(t),n=this.cellMatrix.getNeighbor(e.row,e.col,"bottom");n&&this.mergeNeighbors(e,n)},Q.prototype.mergeNeighbors=function(t,e){if(null!=t&&null!=e){var n=this.cellMatrix.getCellParent(t.row,t.col),i=this.cellMatrix.getCellParent(e.row,e.col),r=this.cellMatrix.mergeParents(n,i),o=r.newParent,s=r.newRowSpan,a=r.newColSpan;this.actionHandler.addAction({type:g.MULTI_ACTION,actions:[this.getCellSpanAction(n,1,1),this.getCellSpanAction(i,1,1),this.getCellSpanAction(o,s,a)]}),t.rowSpan=1,t.colSpan=1,e.rowSpan=1,e.colSpan=1,o.rowSpan=s,o.colSpan=a,this.update()}},Q.prototype.getCellSpanAction=function(t,e,n){return{type:g.CHANGE_CELL_SPAN,shape_id:this.id,cell_id:t.id,old_row_span:t.rowSpan,old_col_span:t.colSpan,new_row_span:e||t.rowSpan,new_col_span:n||t.colSpan}},Q.prototype.mergeCells=function(t){var e=this,n=t.sort((function(t,n){var i=e.cellMatrix.getPosition(t),r=e.cellMatrix.getPosition(n);return i.row-r.row+i.col-r.col})),i=function(t,n){var i,r=e.cellMatrix.getSharedVertexIds(t,n),o=function(t){return t.filter((function(t){return!r.includes(t.id)}))},s=function(t){return Object(d["a"])(new Set(t))};if(e.cellMatrix.areHorizontalNeighbors(t,n)){var a=[].concat(Object(d["a"])(t.getLeftVertices()),Object(d["a"])(t.getBottomVertices()),Object(d["a"])(n.getBottomVertices()),Object(d["a"])(n.getRightVertices().reverse()),Object(d["a"])(n.getTopVertices().reverse()),Object(d["a"])(t.getTopVertices().reverse()));i=s(o(a))}if(e.cellMatrix.areVerticalNeighbors(t,n)){var c=[].concat(Object(d["a"])(t.getLeftVertices()),Object(d["a"])(n.getLeftVertices()),Object(d["a"])(n.getBottomVertices()),Object(d["a"])(n.getRightVertices().reverse()),Object(d["a"])(t.getRightVertices().reverse()),Object(d["a"])(t.getTopVertices().reverse()));i=s(o(c))}var l=e.createCell();return l.setVertices(i),l.baselines=[].concat(Object(d["a"])(t.baselines),Object(d["a"])(n.baselines)),l.text=t.text+n.text,l};return i(n[0],n[1])},Q.prototype.getCellFromPointer=function(t){return this.cellMatrix.allCells().find((function(e){return Object(x["e"])([t.x,t.y],e.getCellPolygon())}))},Q.prototype.getParentFromPointer=function(t){return this.cellMatrix.allCells().find((function(e){return Object(x["e"])([t.x,t.y],e.getArea())}))},Q.prototype.allVertices=function(){return this.cellMatrix.allVertices()},Q.prototype.setState=function(t){this.activeVertex&&this.activeVertex.unSelect(),this.vertices.length,this.state=t},Q.prototype.positionCloseToVertex=function(t){return this.allVertices().some((function(e){return V(e.left,e.top,t.x,t.y)<5}))},Q.prototype.updateHoveredLine=function(t){var e,n=this,i=function(){n.hoverLine&&(n.canvas.remove(n.hoverLine),n.canvas.requestRenderAll(),n.hoverLine=null)},r=function(t){n.hoverLine=n.myFabric.getHoverLine(t.vertices,t.id,t.isVertical),n.hoverLine.relations=n.getRelations(n.hoverLine,n.hoverLine.vertices),n.hoverLine.on("mousedown",(function(){n.hoverLine.isDragging=!0,n.saveTempCoords.apply(n,Object(d["a"])(n.hoverLine.vertices))})),n.hoverLine.on("moved",(function(){n.updateCircles(n.hoverLine),n.update(),n.actionHandler.addAction({type:g.MULTI_ACTION,actions:n.hoverLine.vertices.map((function(t,e){return{type:g.MOVE_POINT,shape_id:n.id,point_id:t.id,old_coords:n.tempCoords[e],new_coords:{left:t.left,top:t.top}}}))})})),n.hoverLine.on("mouseup",(function(){n.hoverLine.isDragging=!1})),n.canvas.add(n.hoverLine)};if(null===(e=this.hoverLine)||void 0===e||!e.isDragging)if(this.positionCloseToVertex(t))i();else{var o=this.findLine(t);if(o){var s;if(o.id===(null===(s=this.hoverLine)||void 0===s?void 0:s.id))return;return i(),void r(o)}i()}},Q.prototype.updateVertexSizes=function(t){if("circle"===(null===t||void 0===t?void 0:t.type)){var e;if((null===(e=this.hoveredVertex)||void 0===e?void 0:e.id)===t.id)return;t.set({radius:1.5*t.defaultRadius}),this.hoveredVertex=t,this.canvas.requestRenderAll()}else this.hoveredVertex&&(this.hoveredVertex.set({radius:this.hoveredVertex.defaultRadius}),this.hoveredVertex=null,this.canvas.requestRenderAll())},Q.prototype.showPreviewRect=function(t,e){this.canvas.remove(this.previewRect),this.previewRect=this.myFabric.getPreviewRect(this.initCoord.x,this.initCoord.y,t,e).set("fill","orange"),this.canvas.add(this.previewRect)},Q.prototype.handleMouseMoveEvent=function(t){if(this.state===H.STATE.FIRST_DRAW&&this.initCoord){var e=this.canvas.getPointer(t.e);this.showPreviewRect(e.x,e.y)}if(this.state===H.STATE.EDIT){var n=this.canvas.getPointer(t.e);this.mousePosition=n,this.updateHoveredLine(n)}},Q.prototype.createDragVertex=function(t){var e=this.findLine(t);if(e){var n=this.myFabric.getDragCircle(t.x,t.y);this.canvas.add(n),this.dragVertex=n;var i=e.calcTransformMatrix(),r=fabric.util.invertTransform(n.calcTransformMatrix());this.lineRelation=fabric.util.multiplyTransformMatrices(r,i)}},Q.prototype.handleClickEvent=function(t,e){},Q.prototype.selectNewCell=function(t){var e;(null===(e=this.markedCell)||void 0===e?void 0:e.id)!==(null===t||void 0===t?void 0:t.id)&&(this.markedCell&&(this.markedCell.unSelect(),this.markedCell=null),t&&(t.select(),this.markedCell=t))},Q.prototype.getSelectedCells=function(){return this.allCells().filter((function(t){return t.selected}))},Q.prototype.updateCellSelection=function(){},Q.prototype.createCell=function(t){var e=new J(this.canvas,t);return e},Q.prototype.findLine=function(t){return this.lines.find((function(e){return e.polygons.some((function(e){return Object(x["e"])([t.x,t.y],e)}))}))},Q.prototype.setTableInvalid=function(t){t.map((function(t){return t.baselines.map((function(t){return t.removeFromCanvas()}))})),this.cellMatrix=new K(0,0),this.invalid=!0,this.update=function(){this.canvas.contains(this.frameInvalid)||this.canvas.add(this.frameInvalid)},this.handleClickEvent=function(){},this.handleMouseMoveEvent=function(){},this.getBaselines=function(){return[]},this.select=function(){this.canvas.contains(this.backgroundInvalid)||this.canvas.add(this.backgroundInvalid),this.canvas.contains(this.signInvalid)||this.canvas.add(this.signInvalid)},this.unSelect=function(){this.canvas.remove(this.backgroundInvalid),this.canvas.remove(this.signInvalid)},this.getBlueprint=function(){return{type:"table",attributes:this.attributes,elements:this.elements}},this.removeFromCanvas=function(){this.canvas.remove(this.backgroundInvalid),this.canvas.remove(this.signInvalid),this.canvas.remove(this.frameInvalid)},this.getArea=function(){return this.elements.coords.map((function(t){var e=t.x,n=t.y;return[e,n]}))},this.backgroundInvalid=this.myFabric.getInvalidTableBackground(this.elements.coords),this.frameInvalid=this.myFabric.getInvalidTableFrame(this.elements.coords),this.signInvalid=this.myFabric.getInvalidTableSign(this.elements.coords),this.canvas.add(this.backgroundInvalid),this.canvas.add(this.frameInvalid),this.unSelect()},Q.prototype.movePoint=function(t,e){var n=this.allVertices().find((function(e){return e.id===t}));n?(n.set({left:e.left,top:e.top}),n.setCoords(),this.cellMatrix.log(),this.update()):console.log("Vertex with id+ "+t+" could not be found")};var tt=Q,et=n("c51a"),nt=n("fd71"),it=(n("ac1f"),n("1276"),n("a15b"),n("a6a7")),rt=n.n(it),ot=n("6494"),st=function(t){var e=new ot["cssjs"],n=e.parseCSS(t),i={};return n.map((function(t){switch(t.selector){case"readingOrder":i.readingOrder=t.rules[0].value;break;case"structur":case"structure":i.structureType=t.rules[0].value;break;case"relationType":i.relationType=t.rules[0].value;break;case"relationName":i.relationName=t.rules[0].value;break;default:"tags"in i||(i.tags=[]),i.tags.push(t)}})),i},at=function(t){var e="";return"readingOrder"in t&&(e+=" readingOrder {index:".concat(t.readingOrder,";}")),"structureType"in t&&(e+=" structure {type:".concat(t.structureType,";}")),"relationType"in t&&(e+=" relationType {value:".concat(t.relationType,";}")),"relationName"in t&&(e+=" relationName {value:".concat(t.relationName,";}")),"tags"in t&&t.tags.map((function(t){var n=t.rules.reduce((function(t,e){var n=e.directive,i=e.value;return t+"".concat(n,":").concat(i,";")}),"");e+=" ".concat(t.selector," {").concat(n,"}")})),e=e.substring(1),e},ct=function(t,e){var n=function(t){t=t.sort((function(t,e){return t.attributes.custom.readingOrder-e.attributes.custom.readingOrder}));var e=function(t){return t.sort((function(t,e){return t.attributes.custom.readingOrder-e.attributes.custom.readingOrder}))};return t.map((function(t){t.elements.textLines?t.elements.textLines=e(t.elements.textLines):t.elements.cells.map((function(t){t.elements.textLines=e(t.elements.textLines)}))})),t},i=function(t){var e=function(t){var e=0;return t.map((function(n,i){var r=(i+1)%t.length;e+=t[i].x*t[r].y,e-=t[r].x*t[i].y})),e>0},n=function(t,e){var n=e.findIndex((function(e){return e===t}));return e[(n+1)%e.length]},i=function t(e,i,r,o){return r===o?[].concat(Object(d["a"])(e),[r]):t([].concat(Object(d["a"])(e),[r]),i,n(r,i),o)},r=function(t){var e=Object(d["a"])(t).sort((function(t,e){return t.x-e.x})),n=Object(u["a"])(e,2),i=n[0],r=n[1];return i.x===r.x&&i.y<r.y?r:i},o=function(t){var e=Object(d["a"])(t).sort((function(t,e){return e.x-t.x})),n=Object(u["a"])(e,2),i=n[0],r=n[1];return i.x===r.x&&i.y<r.y?r:i},s=e(t),a=s?Object(d["a"])(t).reverse():Object(d["a"])(t),c=2,l=i([],a,r(a),o(a));return l=rt()(l,c),l},r=function(t){log(t);var e=g(t.attributes),n={relations:[]};return t.elements.map((function(t){switch(t.name){case"Relation":n.relations.push(o(t));break}})),{attributes:e,elements:n}},o=function(t){var e=g(t.attributes),n={ids:[]};return t.elements.map((function(t){switch(t.name){case"RegionRef":n.ids.push(s(t));break}})),{attributes:e,elements:n}},s=function(t){return t.attributes.regionRef},a=function(t){var e=g(t.attributes),n={coords:[],textLines:[],text:""};return t.elements.map((function(t){switch(t.name){case"Coords":n.coords=m(t);break;case"TextLine":n.textLines.push(f(t));break;case"TextEquiv":n.text=T(t);break}})),{attributes:e,elements:n}},l=function(t){var e=g(t.attributes),n={coords:[],cells:[],text:""};return t.elements.map((function(t){switch(t.name){case"Coords":n.coords=m(t);break;case"TableCell":n.cells.push(p(t));break;case"TextEquiv":n.text=T(t);break}})),{attributes:e,elements:n}},p=function(t){var e=g(t.attributes),n={coords:[],textLines:[],cornerPoints:[]};return t.elements.map((function(t){switch(t.name){case"Coords":n.coords=m(t);break;case"TextLine":n.textLines.push(f(t));break;case"CornerPts":n.cornerPoints=h(t);break}})),{attributes:e,elements:n}},h=function(t){return t.elements[0].text.split(" ").map((function(t){return parseInt(t)}))},f=function(t){var e=g(t.attributes),n={polyCoords:[],baselineCoords:[],words:[],text:""};return t.elements.map((function(t){switch(t.name){case"Coords":n.polyCoords=m(t);break;case"Baseline":n.baselineCoords=y(t);break;case"Word":n.words.push(v(t));break;case"TextEquiv":n.text=T(t);break}})),0===n.baselineCoords.length&&(n.baselineCoords=i(n.polyCoords)),{attributes:e,elements:n}},v=function(t){var e=g(t.attributes),n={coords:[],text:""};return t.elements.map((function(t){switch(t.name){case"Coords":n.coords=m(t);break;case"TextEquiv":n.text=T(t);break}})),{attributes:e,elements:n}},g=function(t){return Object(c["a"])(Object(c["a"])({},t),null!==t&&void 0!==t&&t.custom?{custom:st(t.custom)}:{})},m=function(t){return dt(ht(t.attributes.points),e)},y=function(t){return dt(ht(t.attributes.points),e)},T=function(t){return t.elements.length>0&&t.elements[0].elements.length>0?t.elements[0].elements[0].text:""},b=ut(t).elements;log(b);var x,S=b.filter((function(t){return"TextRegion"===t.name||"TableRegion"===t.name})),E=b.find((function(t){return"Relations"===t.name}));null!=E&&(x=r(E));var O=S.map((function(t){switch(t.name){case"TextRegion":return a(t);case"TableRegion":return l(t)}})),C=n(O);return{regionBlueprints:C,relationsBlueprint:x}},lt=function(t,e,n,i){var r=JSON.parse(JSON.stringify(t)),o=ut(r).elements.filter((function(t){return"TextRegion"!=t.name&&"TableRegion"!=t.name&&"Relations"!=t.name})),s=function(t){var e=g(t.attributes),n=[];return t.elements.relations.map((function(t){n.push(a(t))})),{attributes:e,elements:n,name:"Relations",type:"element"}},a=function(t){var e=g(t.attributes),n=[];return t.elements.ids.map((function(t){n.push(l(t))})),{attributes:e,elements:n,name:"Relation",type:"element"}},l=function(t){return{attributes:{regionRef:t},elements:[],name:"RegionRef",type:"element"}},u=function(t){var e=g(t.attributes),n=[];return n.push(m(t.elements.coords)),t.elements.textLines.map((function(t){n.push(f(t))})),n.push(b(t.elements.text)),{attributes:e,elements:n,name:"TextRegion",type:"element"}},p=function(t){var e=g(t.attributes),n=[];return n.push(m(t.elements.coords)),t.elements.cells.map((function(t){n.push(h(t))})),n.push(b(t.elements.text)),{attributes:e,elements:n,name:"TableRegion",type:"element"}},h=function(t){var e=g(t.attributes),n=[];return n.push(m(t.elements.coords)),t.elements.textLines.map((function(t){n.push(f(t))})),n.push(T(t.elements.cornerPoints)),{attributes:e,elements:n,name:"TableCell",type:"element"}},f=function(t){var e=g(t.attributes),n=[];return n.push(m(t.elements.polyCoords)),n.push(y(t.elements.baselineCoords)),t.elements.words.map((function(t){n.push(v(t))})),n.push(b(t.elements.text)),{attributes:e,elements:n,name:"TextLine",type:"element"}},v=function(t){var e=g(t.attributes),n=[];return n.push(m(t.elements.coords)),n.push(b(t.elements.text)),{attributes:e,elements:n,name:"Word",type:"element"}},g=function(t){log(t);var e=Object(c["a"])({},t);return"custom"in t&&(e.custom=at(t.custom)),e},m=function(t){return{attributes:{points:ft(pt(t,i))},elements:[],name:"Coords",type:"element"}},y=function(t){return{attributes:{points:ft(pt(t,i))},elements:[],name:"Baseline",type:"element"}},T=function(t){return{elements:[{type:"text",text:t.join(" ")}],name:"CornerPts",type:"element"}},b=function(t){return{elements:[{elements:t.length<=0?[]:[{type:"text",text:t}],name:"Unicode",type:"element"}],name:"TextEquiv",type:"element"}},x=e.map((function(t){return"text"===t.type?u(t):p(t)})),S=s(n),E=[].concat(Object(d["a"])(o),[S],Object(d["a"])(x));return ut(r).elements=E,r},ut=function(t){var e=t.elements.find((function(t){return"PcGts"===t.name}));if(null!=e){var n=e.elements.find((function(t){return"Page"===t.name}));if(null!=e)return n;warn("Error: not Page tag in pageXml")}else warn("Error: not PcGts tag in pageXml")},dt=function(t,e){var n=function(t){return Math.round(1e6*t)/1e6},i=t.map((function(t){return{x:n(t.x*e),y:n(t.y*e)}}));return i},pt=function(t,e){var n=function(t){return Math.round(t)},i=t.map((function(t){return{x:n(t.x/e),y:n(t.y/e)}}));return i},ht=function(t){var e=t.split(" "),n=e.map((function(t){var e=t.split(",");return{x:e[0],y:e[1]}}));return n},ft=function(t){var e=t.map((function(t){return"".concat(t.x,",").concat(t.y)})).join(" ");return e};n("aa78");function vt(t){this.id=y.instance().requestId("rel"),this.color=gt(),this.attributes={type:vt.TYPE.LINK},this.elements={ids:[]},t&&(this.attributes=t.attributes,this.elements.ids=t.elements.ids)}vt.TYPE=Object.freeze({LINK:"link",JOIN:"join",SAME_AS:"same as",FOLLOWED_BY:"followed by"}),vt.prototype.getBlueprint=function(){return{attributes:this.attributes,elements:this.elements}},vt.prototype.setIds=function(t){this.elements.ids=Object(d["a"])(t)},vt.prototype.getIds=function(){return Object(d["a"])(this.elements.ids)},vt.prototype.setType=function(t){"custom"in this.attributes||(this.attributes.custom={}),this.attributes.custom.relationType=t};var gt=function(){for(var t="0123456789ABCDEF",e="#",n=0;n<6;n++)e+=t[Math.floor(16*Math.random())];return e},mt=vt;function yt(){var t={reset:function(){t.state=Lt.STATE.ADD_RELATION,t.isEmpty=!0,t.draftArrows=[],t.activeArrow=null,t.activeInit=[],t.ids=[],t.type=mt.TYPE.LINK}};return t.reset(),[t]}var Tt=function(t,e){switch(t){case g.ADD_RELATION:var n=e.relation;return{type:t,relation:n};case g.REMOVE_RELATION:var i=e.relation;return{type:t,relation:i};case g.ADD_SHAPE:var r=e.relation;return{type:t,relation:r};case g.REMOVE_SHAPE:var o=e.shape,s=e.parent;return Object(c["a"])(Object(c["a"])({type:t,shape:o},s&&{parent_id:s.id}),{},{index:bt(o,s)})}},bt=function(t,e){switch(t.getType()){case H.TYPE.WORD:return e.words.findIndex((function(e){return e.id===t.id}));case H.TYPE.BASELINE:return e.baselines.findIndex((function(e){return e.id===t.id}));case H.TYPE.TABLE:case H.TYPE.REGION:return e.regions.findIndex((function(e){return e.id===t.id}))}};function xt(t,e,n,i){var r=this;this.vueFunctions=i,this.scaleFactor=n,this.throttleCounter=0,this.moveCounter=0,this.pageJSON=Object(et["xml2js"])(e,{compact:!1,trim:!1,alwaysArray:!0,alwaysChildren:!0}),this.canvas=t,this.baselines=function(){return this.regions.reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(e.getBaselines()))}),[])},this.shapes=function(){var t=[];return this.regions.map((function(e){t=t.concat(e).concat(e.baselines)})),t},this.regions=[];var o=[];o.filterByShapeId=function(t){return o.filter((function(e){return e.getIds().some((function(e){return e===t}))}))},o.get=function(t){return o.find((function(e){return e.id===t}))},this.relations=o,this.relationGraveyard=[],this.relationArrow=null,this.allRealtionArrows=[],this.statePropertyWrappers=yt();var s=[];s.isEmpty=function(){return 0===s.length},s.isSingle=function(){return 1===s.length},s.isWord=function(){return s.isSingle()&&s[0]instanceof F},s.isBaseline=function(){return s.isSingle()&&s[0]instanceof q},s.isRegion=function(){return s.isTextRegion()||s.isTable()},s.isTextRegion=function(){return s.isSingle()&&s[0]instanceof G},s.isTable=function(){return s.isSingle()&&s[0]instanceof tt},s.areMultiple=function(){return!s.isEmpty()&&!s.isSingle()},s.haveState=function(t){return!s.isEmpty()&&s.every((function(e){return e.state===t}))},s.areBaselines=function(){return!s.isEmpty()&&s.every((function(t){return t instanceof q}))},s.areTextRegions=function(){return!s.isEmpty()&&s.every((function(t){return t instanceof G}))},s.areTables=function(){return!s.isEmpty()&&s.every((function(t){return t instanceof tt}))},s.areRegions=function(){return s.areTextRegions()||s.areTables()},s.areTableAndCell=function(){var t=s.filter((function(t){return t instanceof tt}));if(1!=t.length)return!1;var e=s.filter((function(t){return t instanceof J}));return 1==e.length},s.areSiblings=function(){if(s.isEmpty()||s.isSingle())return!1;if(s.areBaselines()){var t=s[0],e=r.getBaselineParent(t.id).id;return s.every((function(t){return e===r.getBaselineParent(t.id).id}))}return!!s.areTextRegions()},s.add=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){!1===s.includes(t)&&(t.select(),s.push(t))})),s},s.remove=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.map((function(t){s.includes(t)&&(t.unSelect(),s.splice(s.indexOf(t),1))})),s},s.removeAll=function(){return s.map((function(t){return t.unSelect()})),s.length=0,s},s.setState=function(t){s.map((function(e){return e.setState(t)}))},s.withoutCells=function(){return s.filter((function(t){return!(t instanceof J)}))},s.getTable=function(){return s.find((function(t){return t instanceof tt}))},s.getCell=function(){return s.find((function(t){return t instanceof J}))},this.activeShapes=s,this.draft=null,this.readingOrder={},this.mouseEventHandlers={},this.containerEventHandlers={},this.keyEventHandlers={},this.deletedShapes=[],this.state=null,this.shifted=!1,this.controlPressed=!1,this.rPressed=!1,this.lastHovered=null,this.lastMousePosition={x:0,y:0},this.canvasDiagonal=Math.sqrt(Math.pow(this.vueFunctions.getCanvasHeight(),2)+Math.pow(this.canvas.width,2)),this.prevLine=null,this.markedParent=null,this.mouseEventHandlers.mouseDown=Ct.bind(this),this.mouseEventHandlers.dblClick=St.bind(this),this.mouseEventHandlers.mouseMove=Et.bind(this),this.mouseEventHandlers.mouseOut=Ot.bind(this),this.containerEventHandlers.mouseUp=At.bind(this),this.keyEventHandlers.keyDown=wt.bind(this),this.keyEventHandlers.keyUp=_t.bind(this),this.canvas.on("mouse:down",this.mouseEventHandlers.mouseDown),this.canvas.on("mouse:dblclick",this.mouseEventHandlers.dblClick),this.canvas.on("mouse:move",this.mouseEventHandlers.mouseMove),this.canvas.on("mouse:out",this.mouseEventHandlers.mouseOut),document.getElementById("osd").addEventListener("click",this.containerEventHandlers.mouseUp),document.addEventListener("keydown",this.keyEventHandlers.keyDown),document.addEventListener("keyup",this.keyEventHandlers.keyUp),this.setState(xt.STATE.EDIT),this.actionHandler=f.instance(),this.actionHandler.reset(this.vueFunctions.setEdited,this),this.settings=C.instance(),this.settings.on("update",(function(){return r.settingsUpdate()})),this.$t=this.vueFunctions.$t,this.myFabric=w.instance(),this.myFabric.init(n,this.vueFunctions.getTileSourceWidth()),z.instance().setOpenFn(this.vueFunctions.openModal)}function St(){this.activeShapes.haveState(H.STATE.ADD_VERTEX)&&this.activeShapes.isSingle()&&(this.activeShapes[0].removeLastAddedVertex(),this.activeShapes.setState(H.STATE.EDIT)),this.state===xt.STATE.ADD_RELATION&&this.finishRelation(),null!=this.draft&&(this.draft instanceof q&&(this.draft.vertices.length<=2?this.draft.removeFromCanvas():(this.draft.removeLastAddedVertex(),this.finishBaseline(this.draft))),this.draft=null)}function Et(t){var e;if(this.moveCounter=(this.moveCounter+1)%10,this.lastMousePosition=this.canvas.getPointer(t.e),this.state===xt.STATE.VERTICAL_SPLIT||this.state===xt.STATE.HORIZONTAL_SPLIT||this.state===xt.STATE.CUSTOM_SPLIT)return this.prevLine.set({left:this.lastMousePosition.x,top:this.lastMousePosition.y}),void this.canvas.requestRenderAll();if(this.state!==xt.STATE.ASSIGN_NEW_PARENT)if(this.state!==xt.STATE.DUPLICATE){if(this.state===xt.STATE.ADD_RELATION)return this.updateRelationArrow(this.lastMousePosition),void this.updateVertexSizes(t.target);if(this.state===xt.STATE.MULTI_SELECT&&null!=this.selectionRect&&(this.selectionRect.update(this.lastMousePosition.x,this.lastMousePosition.y),this.canvas.requestRenderAll(),0===this.moveCounter)){var n=this.selectionRect.getArea(),i=this.allShapesAndCellsAndWords().reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(e.isVisible()&&(Object(x["k"])(n,e.getArea())||Object(x["j"])(e.getArea(),n))?[e]:[]))}),[]),r=this.activeShapes.map((function(t){return t.id})),o=i.map((function(t){return t.id})),s=o.filter((function(t){return!r.includes(t)})),a=r.filter((function(t){return!o.includes(t)}));s.length>0&&this.actionHandler.select({type:m.ADD,ids:s}),a.length>0&&this.actionHandler.select({type:m.REMOVE,ids:a})}this.updateVertexSizes(t.target),this.activeShapes.map((function(e){return e.handleMouseMoveEvent(t)})),null===(e=this.draft)||void 0===e||e.handleMouseMoveEvent(t)}else this.updateDuplicate(this.lastMousePosition);else this.previewNewAssign(this.canvas.getPointer(t.e))}function Ot(t){this.activeShapes.map((function(e){return e.handleMouseOut(t)}))}function Ct(t){var e=this;this.canvasDrag=!1,this.lastDownEvent=t;var n=this.canvas.getPointer(t.e);switch(this.state){case xt.STATE.MULTI_SELECT:this.createSelectionRect(n),this.vueFunctions.setDrag(!1);break;case xt.STATE.ADD_RELATION:var i,r=this.getStateProperties(xt.STATE.ADD_RELATION);if(null==(null===(i=t.target)||void 0===i?void 0:i.id))break;if(r.ids.includes(t.target.id))break;if(r.isEmpty){var o;this.initRelationCreation(null===t||void 0===t||null===(o=t.target)||void 0===o?void 0:o.id)}else{r.draftArrows.push(r.activeArrow);var s=this.getShape(t.target.id);r.activeInit=[s.dock.left,s.dock.top],r.activeArrow=this.myFabric.getRelationArrow(r.activeInit,[this.lastMousePosition.x,this.lastMousePosition.y]),r.draftArrows.map((function(t){e.canvas.contains(t)||e.canvas.add(t)})),r.ids.push(s.id)}case xt.STATE.ASSIGN_NEW_PARENT:if(null==this.markedParent)break;var a=this.getBaselineParent(this.activeShapes[0].id),c=this.markedParent,l=Object(d["a"])(a.baselines),u=Object(d["a"])(c.baselines),p=function(t,e){return{type:g.CHANGE_PARENT,shape_count:1,old_parent_id:a.id,new_parent_id:c.id,old_index:t,new_index:e}},h=function(t,e){var n=e.vertices[0].top,i=t.map((function(t){return t.vertices[0].top})).sort((function(t,e){return t-e})),r=i.findIndex((function(t){return t>n}));return-1===r?i.length:r},f=this.activeShapes.map((function(t){var e=l.indexOf(t);l.splice(e,1);var n=h(u,t);return u.splice(n,0,t),p(e,n)})),v={type:g.MULTI_ACTION,actions:f};this.actionHandler.doAction(v),this.actionHandler.addAction(v);var m=this.myFabric.getNewAssignCircle(this.newAssignStartPos[0],this.newAssignStartPos[1]);this.canvas.add(m),m.animate({left:n.x,top:n.y},{onChange:this.canvas.renderAll.bind(this.canvas),duration:100,onComplete:function(){return e.canvas.remove(m)}}),this.canvas.remove(this.prevLine),this.setState(xt.STATE.EDIT);break}if(3===t.button)if(this.state===xt.STATE.EDIT){var y,T=this.findShape(n);this.activeShapes.map((function(t){return t.id})).includes(null===T||void 0===T?void 0:T.id)||this.selectSingleShape(t,n),this.updateContextMenu(null!==(y=t.target)&&void 0!==y&&y.id?t.target:null,n)}else this.resetContextMenu();this.activeShapes.map((function(n){return n.handleClickEvent(t,e.controlPressed)}))}function At(t){var e,n=this;protocolLog("%cclicked: ".concat(t.x,",").concat(t.y),"color: pink");var i=this.lastDownEvent;if(this.vueFunctions.setDrag(!0),!this.canvasDrag){var r=this.lastMousePosition,o=this.findShape(r);switch(this.state){case xt.STATE.MULTI_SELECT:var s=this.selectionRect.updated;if(s)break;if(null==o)break;if(this.activeShapes.includes(o)){if(this.actionHandler.select({type:m.REMOVE,ids:[o.id]}),o instanceof J){var a=this.getTableOfCell(o.id);a.allCells().every((function(t){return!n.activeShapes.includes(t)}))&&this.actionHandler.select({type:m.REMOVE,ids:[a.id]})}}else if(this.actionHandler.select({type:m.ADD,ids:[o.id]}),o instanceof J){var c=this.getTableOfCell(o.id);this.activeShapes.includes(c)||this.actionHandler.select({type:m.ADD,ids:[c.id]})}break;case xt.STATE.EDIT:this.selectSingleShape(i,r);break;case xt.STATE.ADD_REGIONS:if(null==this.draft){var u=new G(this.canvas);this.draft=u,u.setState(H.STATE.FIRST_DRAW),u.initCoord={x:r.x,y:r.y}}else{var p=M(r,this.draft.initCoord);p.map((function(t){var e=n.draft.getVertex(t.x,t.y);n.draft.addPoint(e,n.draft.vertices.length)})),this.draft.setState(H.STATE.EDIT);var h=this.expectedRegionIndex(this.draft),f={type:g.ADD_SHAPE,shape:this.draft,index:h};this.actionHandler.doAction(f),this.actionHandler.addAction(f),this.draft.unSelect(),this.draft=null}break;case xt.STATE.ADD_TABLES:if(null==this.draft){var v=new tt(this.canvas);this.draft=v,v.setState(H.STATE.FIRST_DRAW),v.initCoord={x:r.x,y:r.y}}else{var y=M(r,this.draft.initCoord),T=y.reverse(),b=Object(l["a"])(T),x=b[0],S=b.slice(1);y=[].concat(Object(d["a"])(S),[x]),this.draft.init(y),this.draft.setState(H.STATE.EDIT);var E=this.expectedRegionIndex(this.draft),O={type:g.ADD_SHAPE,shape:this.draft,index:E};this.actionHandler.doAction(O),this.actionHandler.addAction(O),this.draft.unSelect(),this.draft=null}break;case xt.STATE.ADD_BASELINES:if(null===this.draft){var C=new q(this.canvas);this.draft=C,C.setState(H.STATE.FIRST_DRAW)}break;case xt.STATE.VERTICAL_SPLIT:case xt.STATE.HORIZONTAL_SPLIT:case xt.STATE.CUSTOM_SPLIT:var A=[],w=j([this.lastMousePosition.x,this.lastMousePosition.y],this.prevLine.angle,2*this.canvasDiagonal);if(this.activeShapes.areBaselines()||this.activeShapes.areTextRegions()){var _={type:g.MULTI_ACTION,actions:[]},R=this.activeShapes.withoutCells().reduce((function(t,e){var i=n.splitShape(e,w);if(i){var r=n.getSplitAction(e,i);return _.actions.push(r),t.concat(i)}return t.concat([e])}),[]);this.actionHandler.select({type:m.CLEAR}),this.actionHandler.doAction(_),this.actionHandler.addAction(_),R.map((function(t){D(t,w)>0&&A.push(t.id)})),this.actionHandler.select({type:m.ADD,ids:A});break}if(this.activeShapes.areTableAndCell()){if(this.state===xt.STATE.VERTICAL_SPLIT){log("here"),this.activeShapes.getTable().addVerticalLine(r,w);break}if(this.state===xt.STATE.HORIZONTAL_SPLIT){this.activeShapes.getTable().addHorizontalLine(r,w);break}if(this.state===xt.STATE.CUSTOM_SPLIT){this.activeShapes.getTable().addVerticalLine(r,w)||this.activeShapes.getTable().addHorizontalLine(r,w);break}}break;case xt.STATE.DUPLICATE:var L=this.lastMousePosition.x-this.prevDuplicate.initPosition.x,I=this.lastMousePosition.y-this.prevDuplicate.initPosition.y,P=this.getIndex(),k=JSON.parse(JSON.stringify(this.activeShapes[0].getBlueprint(P))),N=new q(this.canvas,k);log(L),N.vertices.map((function(t){t.left=t.left+L,t.top=t.top+I}));var V=this.getBaselineParent(this.activeShapes[0].id);if(null!=V){log(V);var B=V.expectedIndex(N),U={type:g.ADD_SHAPE,index:B,shape:N,parent_id:V.id};this.actionHandler.doAction(U),this.actionHandler.addAction(U)}break}this.canvas.remove(this.selectionRect),this.selectionRect=null,null===(e=this.draft)||void 0===e||e.handleMouseUpEvent(this.lastMousePosition,this.controlPressed)}}function wt(t){var e=this;switch(protocolLog("%cKey down: ".concat(t.key),"color: green"),t.key){case"Delete":case"Backspace":var n=this.getRemoveAction(this.activeShapes);this.actionHandler.select({type:m.CLEAR}),this.actionHandler.addAction(n),this.actionHandler.doAction(n);break;case"Escape":this.activeShapes.setState(H.STATE.EDIT),this.setState(xt.STATE.EDIT);break;case"Enter":if(t.preventDefault(),this.state===xt.STATE.ADD_RELATION&&this.finishRelation(),null==this.draft)break;this.draft.vertices.length<=1?this.draft.removeFromCanvas():this.finishBaseline(this.draft),this.draft=null;break;case"z":this.controlPressed&&(this.setState(xt.STATE.EDIT),this.actionHandler.undo());break;case"y":this.controlPressed&&(this.setState(xt.STATE.EDIT),this.actionHandler.redo());break;case"s":this.controlPressed&&(t.preventDefault(),this.vueFunctions.save());break;case"v":if(this.controlPressed){this.readFromClipboard();break}this.state!=xt.STATE.VERTICAL_SPLIT&&this.setState(xt.STATE.VERTICAL_SPLIT);break;case"h":this.state!=xt.STATE.HORIZONTAL_SPLIT&&this.setState(xt.STATE.HORIZONTAL_SPLIT);break;case"a":this.activeShapes.haveState(H.STATE.EDIT)&&(this.activeShapes.map((function(t){t.lastMousePosition=e.lastMousePosition})),this.activeShapes.setState(H.STATE.ADD_VERTEX)),this.controlPressed&&(t.preventDefault(),this.regions.length>0&&(this.actionHandler.select({type:m.CLEAR}),this.actionHandler.select({type:m.ADD,ids:this.allShapesAndCells().map((function(t){return t.id}))})));break;case"c":if(this.controlPressed){this.writeToClipboard(this.activeShapes);break}this.state!=xt.STATE.CUSTOM_SPLIT&&this.setState(xt.STATE.CUSTOM_SPLIT);break;case"x":if(this.controlPressed){this.writeToClipboard(this.activeShapes).then((function(){var t=e.getRemoveAction(e.activeShapes);e.actionHandler.select({type:m.CLEAR}),e.actionHandler.addAction(t),e.actionHandler.doAction(t)}));break}break;case"l":this.controlPressed&&(t.preventDefault(),this.selectLinesOfRegion());break;case"Shift":this.shifted||(this.shifted=!0,this.setState(xt.STATE.GROUP_SELECTION));break;case"Meta":case"Control":this.controlPressed||(this.controlPressed=!0,this.state===xt.STATE.EDIT&&this.setState(xt.STATE.MULTI_SELECT));break;case"l":var i=[];this.regions.map((function(t){var n=e.mergeSmallLines(t);n&&i.push(n)})),i.length>0&&this.actionHandler.addAction({type:g.MULTI_ACTION,actions:i});break;case"m":this.merge();break;case"Tab":if(t.preventDefault(),!1===this.activeShapes.isSingle())return;var r;if(this.activeShapes.isBaseline()){var o=this.activeShapes[0],s=this.getBaselineParent(o.id),a=s.baselines.indexOf(o),c=(a+1)%s.baselines.length;r=s.baselines[c].id}if(this.activeShapes.isRegion()){var l=this.activeShapes[0],u=this.regions.indexOf(l),d=(u+1)%this.regions.length;r=this.regions[d].id}this.actionHandler.select({type:m.CLEAR}),this.actionHandler.select({type:m.ADD,ids:[r]});break;case"ArrowLeft":if(this.state===xt.STATE.CUSTOM_SPLIT){if(null==this.prevLine)return;var p=this.prevLine.angle;p--,-1===p&&(p=359),this.prevLine.set({angle:p}),this.canvas.requestRenderAll()}break;case"ArrowRight":if(this.state===xt.STATE.CUSTOM_SPLIT){if(null==this.prevLine)return;var h=this.prevLine.angle;this.settings.get("splitLineAngle"),h=(h+1)%360,this.prevLine.set({angle:h}),this.canvas.requestRenderAll()}break}}function _t(t){switch(protocolLog("%cKey up: ".concat(t.key),"color: green"),t.preventDefault(),t.key){case"ArrowLeft":case"ArrowRight":if(this.state===xt.STATE.CUSTOM_SPLIT){if(null==this.prevLine)break;this.settings.set({splitLineAngle:this.prevLine.angle})}break;case"Shift":this.shifted=!1,this.setState(xt.STATE.EDIT);break;case"Meta":case"Control":this.controlPressed=!1,this.state===xt.STATE.MULTI_SELECT&&this.setState(xt.STATE.EDIT);break;case"a":this.activeShapes.setState(H.STATE.EDIT);break;case"v":this.setState(xt.STATE.EDIT);break;case"c":this.setState(xt.STATE.EDIT);break;case"h":this.setState(xt.STATE.EDIT);break}}function Rt(t,e){return t.imgUrl&&(t.imgUrl=t.imgUrl.replaceAll("&","&amp;")),t}xt.BUTTON=Object.freeze({POINTER:1,ADD_BASELINES:2,ADD_REGIONS:3,ADD_TABLES:4,UNDO:5,REDO:6,NONE:7,ADD_RELATION:8}),xt.STATE=Object.freeze({REMOVE_SHAPE:1,EDIT:2,ADD_BASELINES:3,ADD_REGIONS:4,ADD_TABLES:5,VERTICAL_SPLIT:6,HORIZONTAL_SPLIT:7,CUSTOM_SPLIT:8,ASSIGN_NEW_PARENT:9,GROUP_SELECTION:10,MULTI_SELECT:11,DUPLICATE:12,CREATE_RELATION:13,ADD_RELATION:14}),xt.CURSOR=Object.freeze({SELECTION:1,TEXTLINE:2,TEXTREGION:3,TABLE:4}),xt.SHAPE_TYPE=Object.freeze({REGION:"region",TABLE:"table",BASELINE:"baseline",CELL:"cell"}),xt.prototype.setState=function(t){var e,n,i=this,r=function(e){return i.state===e&&e!=t},o=function(e){return i.state!=e&&e===t};if(r(xt.STATE.EDIT),r(xt.STATE.ADD_RELATION)){var s,a=this.getStateProperties(xt.STATE.ADD_RELATION);(s=this.canvas).remove.apply(s,[a.activeArrow].concat(Object(d["a"])(a.draftArrows))),a.reset(),this.removeDocks()}(r(xt.STATE.ADD_BASELINES)||r(xt.STATE.ADD_REGIONS)||r(xt.STATE.ADD_TABLES))&&this.draft&&(this.draft.removeFromCanvas(),this.draft=null),r(xt.STATE.CUSTOM_SPLIT)&&null!=this.prevLine&&this.settings.set({splitLineAngle:this.prevLine.angle}),(r(xt.STATE.VERTICAL_SPLIT)||r(xt.STATE.HORIZONTAL_SPLIT)||r(xt.STATE.CUSTOM_SPLIT)||r(xt.STATE.ASSIGN_NEW_PARENT))&&(this.canvas.remove(this.prevLine),this.prevLine=null),r(xt.STATE.GROUP_SELECTION)&&this.unGroupSelect(),r(xt.STATE.MULTI_SELECT)&&(this.canvas.remove(this.selectionRect),this.selectionRect=null),r(xt.STATE.DUPLICATE)&&(this.canvas.remove(this.prevDuplicate),this.prevDuplicate=null),o(xt.STATE.EDIT)&&(this.canvas.defaultCursor=this.getCursorUrl(xt.CURSOR.SELECTION),this.canvas.hoverCursor=this.getCursorUrl(xt.CURSOR.SELECTION),this.lastHovered&&(this.lastHovered.showNormal(),this.lastHovered=null)),o(xt.STATE.ADD_RELATION)&&(this.settings.set({showRelations:!0}),this.updateRelationArrows(),this.showDocks(),this.dockPositions=this.getDockPositions()),o(xt.STATE.ADD_BASELINES)&&(e=this.getCursorUrl(xt.CURSOR.TEXTLINE),this.settings.set({showBaselines:!0})),o(xt.STATE.ADD_REGIONS)&&(e=this.getCursorUrl(xt.CURSOR.TEXTREGION),this.settings.set({showRegions:!0})),o(xt.STATE.ADD_TABLES)&&(e=this.getCursorUrl(xt.CURSOR.TABLE),this.settings.set({showRegions:!0})),(o(xt.STATE.ADD_BASELINES)||o(xt.STATE.ADD_REGIONS)||o(xt.STATE.ADD_TABLES))&&(this.canvas.defaultCursor=e,this.canvas.hoverCursor=e),o(xt.STATE.VERTICAL_SPLIT)&&(n=90),o(xt.STATE.HORIZONTAL_SPLIT)&&(n=0),o(xt.STATE.CUSTOM_SPLIT)&&(n=this.settings.get("splitLineAngle")),(o(xt.STATE.VERTICAL_SPLIT)||o(xt.STATE.HORIZONTAL_SPLIT)||o(xt.STATE.CUSTOM_SPLIT))&&(this.prevLine=this.myFabric.getSplitLine(this.canvasDiagonal,this.lastMousePosition,n),this.canvas.add(this.prevLine)),o(xt.STATE.ASSIGN_NEW_PARENT)&&(this.newAssignStartPos=[this.lastMousePosition.x,this.lastMousePosition.y],this.previewNewAssign(this.lastMousePosition)),o(xt.STATE.GROUP_SELECTION)&&this.groupSelect(),o(xt.STATE.DUPLICATE)&&this.previewDuplicate(this.lastMousePosition),this.vueFunctions.setEditorState(t),this.state=t},xt.prototype.performSelection=function(t){var e,n,i=this;switch(t.type){case m.ADD:(e=this.activeShapes).add.apply(e,Object(d["a"])(t.ids.map((function(t){return i.getShape(t)}))));break;case m.REMOVE:(n=this.activeShapes).remove.apply(n,Object(d["a"])(t.ids.map((function(t){return i.getShape(t)}))));break;case m.CLEAR:this.activeShapes.removeAll();break}},xt.prototype.performAction=function(t){var e,n=this;if(null!=t)switch(t.type){case g.ADD_RELATION:this.addRelation(t.relation),this.updateRelationArrows();break;case g.REMOVE_RELATION:this.removeRelation(t.relation),this.updateRelationArrows();break;case g.REMOVE_SHAPE:this.removeShape(t.shape.id),this.updateReadingOrder();break;case g.ADD_SHAPE:t.shape instanceof F&&this.addWord(t.shape,t.index,t.parent_id),t.shape instanceof q&&this.addBaseline(t.shape,t.index,t.parent_id),t.shape instanceof G&&this.addRegion(t.shape,t.index),t.shape instanceof tt&&this.addTable(t.shape,t.index),this.updateReadingOrder();break;case g.CHANGE_READING_ORDER:var i=this.getShape(t.shape_id);if((i instanceof G||i instanceof tt)&&L(this.regions,t.old_index,t.new_index),i instanceof q){var r=this.getBaselineParent(i.id);L(r.baselines,t.old_index,t.new_index)}this.updateReadingOrder();break;case g.POSITION_MOVE:var o=this.getShape(t.shape_id);if(o instanceof G||o instanceof tt){var s=this.regions.indexOf(o);L(this.regions,s,s+t.distance)}if(o instanceof q){var a=this.getBaselineParent(o.id),c=a.baselines.indexOf(o);L(a.baselines,c,c+t.distance)}this.updateReadingOrder();break;case g.CHANGE_PARENT:var l=this.getShape(t.old_parent_id),u=this.getShape(t.new_parent_id),p=l.baselines.splice(t.old_index,t.shape_count);(e=u.baselines).splice.apply(e,[t.new_index,0].concat(Object(d["a"])(p))),this.updateReadingOrder();break;case g.ADD_POINT:case g.REMOVE_POINT:case g.MOVE_POINT:case g.MOVE_SHAPE:case g.MOVE_SHAPE_WITH_VECTOR:case g.ADD_TABLE_COLUM:case g.REMOVE_TABLE_COLUM:case g.ADD_TABLE_ROW:case g.REMOVE_TABLE_ROW:case g.ADD_CELL:case g.REMOVE_CELL:case g.CHANGE_CELL_SPAN:case g.SET_STRUCTUR_TYPE:var h=this.getShape(t.shape_id);null!=h?h.performAction(t):warn("action shape id not found");break;case g.MULTI_ACTION:t.actions.map((function(t){n.performAction(t)})),t.shape_id&&this.getShape(t.shape_id).update();break}},xt.prototype.selectLinesOfRegion=function(){var t=this.activeShapes.filter((function(t){return t instanceof G})),e=this.activeShapes.filter((function(t){return t instanceof tt})),n=[].concat(Object(d["a"])(t.reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(e.baselines))}),[])),Object(d["a"])(e.reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(e.getBaselines()))}),[])));log(n),this.actionHandler.select({type:m.ADD,ids:n.map((function(t){return t.id}))})},xt.prototype.groupSelect=function(){var t=this,e=function(t,e){return e.map((function(e){var n=e.calcTransformMatrix(),i=fabric.util.invertTransform(t.calcTransformMatrix());return fabric.util.multiplyTransformMatrices(i,n)}))};this.activeShapes.setState(H.STATE.GROUP_SELECTION);var n=this.activeShapes.withoutCells().map((function(t){return t.removeFromCanvas(),t.getGroup().set({opacity:.8})}));this.group=new fabric.Group(n,{id:-1,cornerStyle:"circle",padding:0,cornerSize:12,cornerColor:"white",transparentCorners:!0,cornerStrokeColor:"black"}),this.group.childRelations=this.activeShapes.withoutCells().map((function(n){return{id:n.id,vertexRelations:e(t.group,n.vertices),oldCoords:n.vertices.map((function(t){return{left:t.left,top:t.top}}))}})),this.group.oldMatrix=this.group.calcTransformMatrix(),this.canvas.add(this.group),this.canvas.setActiveObject(this.group)},xt.prototype.unGroupSelect=function(){var t=this;this.activeShapes.setState(H.STATE.EDIT);var e=this.group.childRelations.map((function(e){var n=e.id,i=e.vertexRelations,r=e.oldCoords,o=i.map((function(e){var n=fabric.util.multiplyTransformMatrices(t.group.calcTransformMatrix(),e),i=fabric.util.qrDecompose(n);return{left:i.translateX,top:i.translateY}}));return{type:g.MOVE_SHAPE,shape_id:n,old_coords:r,new_coords:o}})),n=JSON.stringify(this.group.oldMatrix),i=JSON.stringify(this.group.calcTransformMatrix());if(n!==i){var r={type:g.MULTI_ACTION,actions:e};this.actionHandler.doAction(r),this.actionHandler.addAction(r)}this.canvas.remove(this.group),this.activeShapes.map((function(t){return t.update()})),this.canvas.discardActiveObject()},xt.prototype.allCells=function(){return this.tableRegions().reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(e.allCells()))}),[])},xt.prototype.getCell=function(t){return this.allCells().find((function(e){return e.id===t}))},xt.prototype.getTableOfCell=function(t){return this.tableRegions().find((function(e){return e.allCells().some((function(e){return e.id===t}))}),[])},xt.prototype.isCell=function(t){return this.allCells().some((function(e){return e.id===t}))},xt.prototype.isTable=function(t){return this.getShape(t)instanceof tt},xt.prototype.findParentByPolygon=function(t){var e=this.getTextRegionsAndCells().find((function(e){var n=e.getArea(),i=t.some((function(t){return Object(x["e"])([t.x,t.y],n)}));return i}));return e},xt.prototype.findBaseline=function(t){},xt.prototype.findShape=function(t){if(this.settings.get("showWords")){var e=this.words().find((function(e){var n=e.getArea(),i=[t.x,t.y];return Object(x["e"])(i,n)}));if(e)return e}if(this.settings.get("showBaselines")){var n=this.baselines().find((function(e){var n=e.getArea(),i=[t.x,t.y];return Object(x["e"])(i,n)}));if(n)return n}if(this.settings.get("showRegions")){var i=this.getTextRegionsAndCells().find((function(e){var n=e.getArea(),i=[t.x,t.y];return Object(x["e"])(i,n)}));if(i)return i}},xt.prototype.getSelectionParter=function(t,e){},xt.prototype.settingsUpdate=function(){this.allShapesAndCellsAndWords().map((function(t){return t.update()})),this.updateRelationArrows()},xt.prototype.buttonClick=function(t){t===xt.BUTTON.UNDO&&(this.setState(xt.STATE.EDIT),this.actionHandler.undo()),t===xt.BUTTON.REDO&&(this.setState(xt.STATE.EDIT),this.actionHandler.redo()),t===xt.BUTTON.ADD_BASELINES&&(this.actionHandler.select({type:m.CLEAR}),this.setState(xt.STATE.ADD_BASELINES)),t===xt.BUTTON.ADD_REGIONS&&(this.actionHandler.select({type:m.CLEAR}),this.setState(xt.STATE.ADD_REGIONS)),t===xt.BUTTON.ADD_TABLES&&(this.actionHandler.select({type:m.CLEAR}),this.setState(xt.STATE.ADD_TABLES)),t===xt.BUTTON.ADD_RELATION&&(this.actionHandler.select({type:m.CLEAR}),this.setState(xt.STATE.ADD_RELATION)),t!==xt.BUTTON.POINTER&&null!==t||(this.activeShapes.setState(H.STATE.EDIT),this.setState(xt.STATE.EDIT))},xt.prototype.render=function(){var t=this,e=ct(this.pageJSON,this.scaleFactor),n=e.regionBlueprints,i=e.relationsBlueprint;log(n),log(i),null!=i&&i.elements.relations.map((function(e){return t.relations.push(new mt(e))})),this.regions=n.map((function(e){return e.elements.textLines?new G(t.canvas,e):new tt(t.canvas,e)})),this.updateReadingOrder(),this.updateRelationArrows()},xt.prototype.createPageXML=function(){this.actionHandler.select({type:m.CLEAR}),this.updateReadingOrder();var t=this.regions.map((function(t,e){return t.getBlueprint(e)})),e={attributes:{},elements:{relations:this.relations.map((function(t){return t.getBlueprint()}))}},n=lt(this.pageJSON,t,e,this.scaleFactor),i=!0,r=Object(et["js2xml"])(n,{compact:!1,ignoreComment:!0,spaces:4,attributesFn:Rt,attributeValueFn:function(t){return"string"===typeof t&&(t.includes("null")||t.includes("NaN")||t.includes("undefined"))&&(i=!1),t}});if(i)return r;console.error("parsing error: null, NaN or undefined was found")},xt.prototype.getLayout=function(){return this.regions.map((function(t){return t.getLayout()}))},xt.prototype.getRemoveAction=function(t){var e=this,n=t.filter((function(t){return t instanceof F})),i=t.filter((function(t){return t instanceof q})),r=t.filter((function(t){return t instanceof G||t instanceof tt})),o=Array.from(t.reduce((function(t,n){return new Set([].concat(Object(d["a"])(t),Object(d["a"])(e.relations.filterByShapeId(n.id))))}),new Set)),s=[].concat(Object(d["a"])(o.map((function(t){return Tt(g.REMOVE_RELATION,{relation:t})}))),Object(d["a"])(n.map((function(t){var n=e.getWordParent(t.id);return Tt(g.REMOVE_SHAPE,{shape:t,parent:n})}))),Object(d["a"])(i.map((function(t){var n=e.getBaselineParent(t.id);return Tt(g.REMOVE_SHAPE,{shape:t,parent:n})}))),Object(d["a"])(r.map((function(t){return Tt(g.REMOVE_SHAPE,{shape:t,parent:e})}))));return{type:g.MULTI_ACTION,actions:s}},xt.prototype.pointRemoveAllowed=function(t){var e=this.allShapes().find((function(e){var n;return null===(n=e.vertices)||void 0===n?void 0:n.some((function(e){return e.id===t}))}));return e instanceof G&&e.vertices.length>3||e instanceof q&&e.vertices.length>2},xt.prototype.removePointWithAction=function(t){var e=this.allShapes().find((function(e){var n;return null===(n=e.vertices)||void 0===n?void 0:n.some((function(e){return e.id===t}))})),n=e.vertices.findIndex((function(e){return e.id===t}));e.removePoint(t),e.modified=!0,this.actionHandler.addAction({type:g.REMOVE_POINT,shape_id:e.id,point_id:t,point_index:n})},xt.prototype.markNewParent=function(t){var e;(null===(e=this.markedParent)||void 0===e?void 0:e.id)!==(null===t||void 0===t?void 0:t.id)&&(this.markedParent&&(this.markedParent.unMark(),this.markedParent=null),t&&(t.mark(),this.markedParent=t))},xt.prototype.removeCanvasListeners=function(){this.canvas.off("mouse:down",this.mouseEventHandlers.mouseDown),this.canvas.off("mouse:dblclick",this.mouseEventHandlers.dblClick),this.canvas.off("mouse:move",this.mouseEventHandlers.mouseMove),this.canvas.off("mouse:out",this.mouseEventHandlers.mouseOut)},xt.prototype.removeKeyListeners=function(){document.removeEventListener("keydown",this.keyEventHandlers.keyDown),document.removeEventListener("keyup",this.keyEventHandlers.keyUp)},xt.prototype.finishRelation=function(){var t,e=this.getStateProperties(xt.STATE.ADD_RELATION),n=new mt;n.setIds(e.ids),n.setType(e.type);var i={type:g.ADD_RELATION,relation:n};this.actionHandler.doAction(i),this.actionHandler.addAction(i),(t=this.canvas).remove.apply(t,[e.activeArrow].concat(Object(d["a"])(e.draftArrows))),e.reset()},xt.prototype.finishBaseline=function(t){t.setState(H.STATE.EDIT);var e=this.findParentByPolygon(t.getPolygonCoords());if(e){var n=e.expectedIndex(t),i={type:g.ADD_SHAPE,index:n,shape:t,parent_id:e.id};this.actionHandler.doAction(i),this.actionHandler.addAction(i)}else{var r=new G(this.canvas);r.adjustToBaseline(t.getPolygonCoords()),r.addBaseline(t,0);var o=this.expectedRegionIndex(r),s={type:g.ADD_SHAPE,index:o,shape:r};this.actionHandler.doAction(s),this.actionHandler.addAction(s)}},xt.prototype.expectedRegionIndex=function(t){var e=t.vertices[0].top,n=this.regions.map((function(t){return t.vertices[0].top})).sort((function(t,e){return t-e})),i=n.findIndex((function(t){return t>e}));return-1===i?n.length:i},xt.prototype.splitTextLine=function(t,e){var n=this,i=k(t,e);if(!(i.length<=1)){var r=i.map((function(e){var i=new q(n.canvas);return i.vertices=e.vertices.map((function(t){return i.getVertex(t.x,t.y,t.id)})),i.words=t.words,i.text=t.text,i}));return r}},xt.prototype.splitTextRegion=function(t,e){var n=this,i=k(t,e);if(!(i.length<=1||i.length>3)){var r=i.pop(),o=i.map((function(e,i){var o=new G(n.canvas);return o.vertices=e.vertices.map((function(t){return o.getVertex(t.x,t.y,t.id)})),o.words=t.words,o.text=t.text,0===i&&(o.vertices=o.vertices.concat(r.vertices.map((function(t){return o.getVertex(t.x,t.y,t.id)})))),o})),s=t.baselines.reduce((function(t,i){var r=n.splitShape(i,e);return r?t.concat(r):t.concat([i])}),[]),a=[{region:o[0],sideIndex:D(o[0],e)},{region:o[1],sideIndex:D(o[1],e)}];return s.map((function(t){var n=D(t,e);a.find((function(t){return t.sideIndex===n})).region.baselines.push(t)})),a.map((function(t){return t.region}))}},xt.prototype.splitShape=function(t,e){return t instanceof q?this.splitTextLine(t,e):t instanceof G?this.splitTextRegion(t,e):void 0},xt.prototype.getMergeAction=function(t,e){var n,i,r;return t[0].getType()===H.TYPE.BASELINE&&(r=this.getBaselineParent(t[0].id),log(r),i=r.baselines.indexOf(t[0])),t[0].getType()===H.TYPE.REGION&&(i=this.regions.indexOf(t[0])),{type:g.MULTI_ACTION,actions:[].concat(Object(d["a"])(this.getRemoveAction(t).actions),[{type:g.ADD_SHAPE,shape:e,index:i,parent_id:null===(n=r)||void 0===n?void 0:n.id}])}},xt.prototype.getSplitAction=function(t,e){var n,i;return t instanceof q&&(n=this.getBaselineParent(t.id),i=n.baselines.indexOf(t)),t instanceof G&&(i=this.regions.indexOf(t)),{type:g.MULTI_ACTION,actions:[].concat(Object(d["a"])(this.getRemoveAction([t]).actions),Object(d["a"])(e.map((function(t,e){var r;return{type:g.ADD_SHAPE,shape:t,index:i+e,parent_id:null===(r=n)||void 0===r?void 0:r.id}}))))}},xt.prototype.getStateProperties=function(t){return this.statePropertyWrappers.find((function(e){return e.state===t}))},xt.prototype.getRegion=function(t){var e;return this.regions.map((function(n){n.id===t&&(e=n)})),e},xt.prototype.getBaselineParent=function(t){return this.getTextRegionsAndCells().find((function(e){return e.baselines.find((function(e){return e.id===t}))}))},xt.prototype.getWordParent=function(t){return this.baselines().find((function(e){return e.words.find((function(e){return e.id===t}))}))},xt.prototype.getTextRegionsAndCells=function(){return[].concat(Object(d["a"])(this.textRegions()),Object(d["a"])(this.allCells()))},xt.prototype.getShape=function(t){return this.allShapesAndCellsAndWords().find((function(e){return e.id===t}))},xt.prototype.words=function(){return this.baselines().reduce((function(t,e){return[].concat(Object(d["a"])(t),Object(d["a"])(e.words))}),[])},xt.prototype.allShapes=function(){return this.regions.reduce((function(t,e){return e.baselines?[].concat(Object(d["a"])(t),[e],Object(d["a"])(e.baselines)):[].concat(Object(d["a"])(t),[e],Object(d["a"])(e.getBaselines()))}),[])},xt.prototype.allShapesAndCells=function(){return[].concat(Object(d["a"])(this.allShapes()),Object(d["a"])(this.allCells()))},xt.prototype.allShapesAndCellsAndWords=function(){return[].concat(Object(d["a"])(this.allShapesAndCells()),Object(d["a"])(this.words()))},xt.prototype.addRegion=function(t,e){var n;this.regions.splice(e,0,t),null===(n=t.baselines)||void 0===n||n.map((function(t){t.update()})),t.update()},xt.prototype.addTable=function(t,e){this.regions.splice(e,0,t),t.update()},xt.prototype.addBaseline=function(t,e,n){var i=this.getRegion(n)||this.getCell(n);i.addBaseline(t,e),t.words.map((function(t){return t.update()})),t.update()},xt.prototype.addWord=function(t,e,n){var i=this.getShape(n);i.addWord(t,e),t.update()},xt.prototype.addShape=function(t,e,n){t instanceof q&&this.addBaseline(t,e,n),t instanceof G&&this.addRegion(t,e)},xt.prototype.removeShape=function(t){var e=this.regions.findIndex((function(e){return e.id===t}));if(e>=0){var n=this.regions.splice(e,1),i=Object(u["a"])(n,1),r=i[0];return r.unSelect(),log("called here"),r.removeFromCanvas(),void r.removeChildsFromCanvas()}var o=this.getBaselineParent(t);if(null!=o&&(e=o.baselines.findIndex((function(e){return e.id===t})),e>=0)){var s=o.baselines.splice(e,1),a=Object(u["a"])(s,1),c=a[0];return c.unSelect(),c.removeFromCanvas(),void c.removeChildsFromCanvas()}if(o=this.getWordParent(t),null!=o&&(e=o.words.findIndex((function(e){return e.id===t})),e>=0)){var l=o.words.splice(e,1),d=Object(u["a"])(l,1),p=d[0];return p.unSelect(),void p.removeFromCanvas()}},xt.prototype.mergeSmallLines=function(t){},xt.prototype.merge=function(){if(!1!==this.activeShapes.areSiblings()){var t;this.activeShapes.areBaselines()&&(t=this.mergeTextLines(Object(d["a"])(this.activeShapes))),this.activeShapes.areTextRegions()&&(t=this.mergeTextRegions(Object(d["a"])(this.activeShapes)));var e=this.getMergeAction(Object(d["a"])(this.activeShapes),t);log(t),this.actionHandler.select({type:m.CLEAR}),this.actionHandler.doAction(e),this.actionHandler.addAction(e),this.actionHandler.select({type:m.ADD,ids:[t.id]})}},xt.prototype.mergeTextLines=function(t){var e=this,n=function t(n){if(1===n.length)return n[0];var i=new q(e.canvas),r=N(n),o=Object(u["a"])(r,2),s=o[0],a=o[1];return i.vertices=s.vertices.map((function(t){return i.getVertex(t.left,t.top,t.id)})).concat(a.vertices.map((function(t){return i.getVertex(t.left,t.top,t.id)}))),i.words=s.words.concat(a.words),i.text="".concat(s.text," ").concat(a.text),t([i].concat(n.filter((function(t){return t.id!=s.id&&t.id!=a.id}))))},i=n(t);return i},xt.prototype.mergeTextRegions=function(t){var e=new G(this.canvas),n=t.reduce((function(t,e){return t.concat(e.vertices.map((function(t){return[t.left,t.top]})))}),[]),i=t.reduce((function(t,e){return t.concat(e.baselines)}),[]),r=Object(x["i"])(n),o=r.map((function(t){return e.getVertex(t[0],t[1])}));return e.baselines=i,e.addMultiplePoints(o),e},xt.prototype.getCursorUrl=function(t){switch(t){case xt.CURSOR.SELECTION:return'url("'.concat(this.vueFunctions.getRouterBase(),'images/Selection-Tool.png") 5 3, default');case xt.CURSOR.TEXTLINE:return'url("'.concat(this.vueFunctions.getRouterBase(),'images/Pen-Tool.png") 2 2, default');case xt.CURSOR.TEXTREGION:return'url("'.concat(this.vueFunctions.getRouterBase(),'images/Region-Tool.png") 13 13, default');case xt.CURSOR.TABLE:return'url("'.concat(this.vueFunctions.getRouterBase(),'images/Table-Tool.png") 15 15, default')}},xt.prototype.updateDuplicate=function(t){this.activeShapes.isBaseline()&&this.prevDuplicate&&(this.canvas.contains(this.prevDuplicate)||this.canvas.add(this.prevDuplicate),this.prevDuplicate.set({left:t.x,top:t.y}),this.canvas.requestRenderAll())},xt.prototype.updateRelationArrow=function(t){var e=this.getStateProperties(xt.STATE.ADD_RELATION);this.canvas.remove(e.activeArrow),e.activeArrow=this.myFabric.getRelationArrow(e.activeInit,[t.x,t.y]),this.canvas.add(e.activeArrow)},xt.prototype.previewDuplicate=function(){this.activeShapes.isBaseline()&&(this.prevDuplicate=this.myFabric.clone(this.activeShapes[0].polygon),this.prevDuplicate.set({evented:!1,initPosition:{x:this.prevDuplicate.left,y:this.prevDuplicate.top}}))},xt.prototype.previewNewAssign=function(t){this.canvas.remove(this.prevLine),this.prevLine=this.myFabric.getNewAssignLine(this.newAssignStartPos,[t.x,t.y]);var e=this.findParentByPolygon([t]);this.markNewParent(e),this.canvas.add(this.prevLine)},xt.prototype.createSelectionRect=function(t){this.selectionRect=this.myFabric.getSelectionRect(t.x,t.y),this.canvas.add(this.selectionRect)},xt.prototype.addRelation=function(t){this.relations.push(t),log(Object(d["a"])(this.relations))},xt.prototype.removeRelation=function(t){var e=t.id,n=this.relations.findIndex((function(t){return t.id===e}));this.relations.splice(n,1)},xt.prototype.updateRelationIds=function(t,e){var n=this.relations.find((function(e){return e.id===t}));null==n?warn("relation could not be found"):n.setIds(Object(d["a"])(e))},xt.prototype.showDocks=function(){var t=this;this.allShapesAndCells().map((function(e){e.showDock(t.getType(e))}))},xt.prototype.getDockPositions=function(){return this.allShapesAndCells().map((function(t){if(null!=t.dock)return{x:t.dock.left,y:t.dock.top}}))},xt.prototype.removeDocks=function(){this.allShapesAndCells().map((function(t){t.removeDock()}))},xt.prototype.initRelationCreation=function(t,e){var n=this.getStateProperties(xt.STATE.ADD_RELATION),i=this.getShape(t);n.activeInit=[i.dock.left,i.dock.top],n.activeArrow=this.myFabric.getRelationArrow(n.activeInit,[this.lastMousePosition.x,this.lastMousePosition.y]),n.isEmpty=!1,null!=e&&(n.type=e),this.canvas.add(n.activeArrow),n.ids.push(i.id)},xt.prototype.textRegions=function(){return this.regions.filter((function(t){return t instanceof G}))},xt.prototype.tableRegions=function(){return this.regions.filter((function(t){return t instanceof tt}))},xt.prototype.updateRelationArrows=function(){var t,e,n=this;((t=this.canvas).remove.apply(t,Object(d["a"])(this.allRealtionArrows)),this.allRealtionArrows=[],this.settings.get("showRelations"))&&(this.allRealtionArrows=this.relations.reduce((function(t,e){var i=[];return log(e.getIds()),e.getIds().reduce((function(t,r){var o=n.getShape(t),s=n.getShape(r);return null==o||null==s?(warn("Relation has wrong shape ids"),r):(i.push(n.myFabric.getRelationArrow(o.getMidPoint(),s.getMidPoint(),e.color)),r)})),[].concat(Object(d["a"])(t),i)}),[]),(e=this.canvas).add.apply(e,Object(d["a"])(this.allRealtionArrows)))},xt.prototype.updateReadingOrder=function(){this.regions.map((function(t,e){t.setReadingOrder(e),t.baselines&&t.baselines.map((function(t,e){t.setReadingOrder(e)})),t.allCells&&t.allCells().map((function(t){t.baselines.map((function(t,e){t.setReadingOrder(e)}))}))})),this.allShapesAndCells().map((function(t){return t.update()}))},xt.prototype.resetContextMenu=function(){nt["ctxmenu"].update("#box",[])},xt.prototype.updateContextMenu=function(t,e){var n,i=this;nt["ctxmenu"].update("#layout-panel",[]);var r=function(t,e,n,r){return{text:'<div style="display: inline-block;\n      background-color:'.concat(n,';\n      border-radius:20px;\n      width: 20px;\n      height: 20px;\n      margin-bottom: -3px;\n      margin-right: 12px;\n      margin-left: -3px;"></div>').concat(r?"<strong>".concat(e,"</strong>"):e," "),action:function(){var n;if(1===t.length){var r=Object(u["a"])(t,1),o=r[0],s=o.id,a=o.oldType;n={type:g.SET_STRUCTUR_TYPE,shape_id:s,old_type:a,new_type:e}}else n={type:g.MULTI_ACTION,actions:t.map((function(t){var n=t.id,i=t.oldType;return{type:g.SET_STRUCTUR_TYPE,shape_id:n,old_type:i,new_type:e}}))};i.actionHandler.doAction(n),i.actionHandler.addAction(n)}}},o=function(t){var e=Object(d["a"])(i.settings.structureTypes);if(e.push({name:"none",color:"#FFFFFF"}),t.areTableAndCell()){var n,o,s=t.find((function(t){return t instanceof J})),a=null===s||void 0===s||null===(n=s.attributes)||void 0===n||null===(o=n.custom)||void 0===o?void 0:o.structureType,c=e.findIndex((function(t){return t.name===a}));return{text:i.$t("Assign structure type"),subMenu:e.map((function(t,e){var n=t.name,i=t.color;return r([{id:s.id,oldType:a}],n,i,c===e)}))}}if(t.areMultiple()){var l=t.map((function(t){return{id:t.id,oldType:t.attributes.custom.structureType}})),u=l.map((function(t){var n=t.oldType;return e.findIndex((function(t){return t.name===n}))}));return{text:i.$t("Assign structure type"),subMenu:e.map((function(t,e){var n=t.name,i=t.color;return r(l,n,i,u.includes(e))}))}}var p=t[0].attributes.custom.structureType,h=e.findIndex((function(t){return t.name===p}));return{text:i.$t("Assign structure type"),subMenu:e.map((function(e,n){var i=e.name,o=e.color;return r([{id:t[0].id,oldType:p}],i,o,h===n)}))}},s=function(t){return{text:i.$t("Delete"),action:function(){var e=i.getRemoveAction(t);i.actionHandler.select({type:m.CLEAR}),i.actionHandler.addAction(e),i.actionHandler.doAction(e)}}},a=function(t,e){var n=t.find((function(t){return t instanceof tt}));return[{text:i.$t("Dissolve cells"),action:function(){n.dissolveCells(e)}},{text:i.$t("Merge row"),action:function(){n.mergeRow(e)}},{text:i.$t("Merge column"),action:function(){n.mergeColumn(e)}},{text:i.$t("<div class='ctx-menu-icon ' id='arrowRight-icon'></div>Merge right"),action:function(){n.mergeRightCell(e)}},{text:i.$t("<div class='ctx-menu-icon ' id='arrowLeft-icon'></div>Merge left"),action:function(){n.mergeLeftCell(e)}},{text:i.$t("<div class='ctx-menu-icon ' id='arrowUp-icon'></div>Merge above"),action:function(){n.mergeTopCell(e)}},{text:i.$t("<div class='ctx-menu-icon ' id='arrowDown-icon'></div>Merge below"),action:function(){n.mergeBottomCell(e)}}]},c=function(){return{text:i.$t("Merge Shapes"),action:function(){i.merge()}}},l=function(){return{text:i.$t("Vertical split"),action:function(){i.setState(xt.STATE.VERTICAL_SPLIT)}}},p=function(){return{text:i.$t("Horizontal split"),action:function(){i.setState(xt.STATE.HORIZONTAL_SPLIT)}}},h=function(){return{text:i.$t("Custom split"),action:function(){i.setState(xt.STATE.CUSTOM_SPLIT)}}},f=function(t){return{text:i.$t("Delete Point"),action:function(){i.pointRemoveAllowed(t.id)&&i.removePointWithAction(t.id)}}},v=function(t,e){return{text:i.$t("Remove Divider"),action:function(){t.removeLine(e.id)}}},y=function(){return{text:i.$t("Assign to new region"),action:function(){i.setState(xt.STATE.ASSIGN_NEW_PARENT)}}},T=function(){return{text:i.$t("Select All"),action:function(){i.regions.length>0&&(i.actionHandler.select({type:m.CLEAR}),i.actionHandler.select({type:m.ADD,ids:i.allShapesAndCells().map((function(t){return t.id}))}))}}},b=function(t){return{text:i.$t("Duplicate"),action:function(){i.setState(xt.STATE.DUPLICATE)}}},x=function(t){return Object.values(mt.TYPE),{text:i.$t("Add Relation"),subMenu:Object.values(mt.TYPE).map((function(e){return{text:e,action:function(){i.setState(xt.STATE.ADD_RELATION),i.initRelationCreation(t.id,e)}}}))}},S=function(t){return{text:i.$t("Remove Relation"),action:function(){var e=i.relations.filterByShapeId(t.id),n={type:g.MULTI_ACTION,actions:e.map((function(t){return{type:g.REMOVE_RELATION,relation:t}}))};i.actionHandler.doAction(n),i.actionHandler.addAction(n)}}},E=[];if(this.activeShapes.isEmpty()&&(E=[T()]),this.activeShapes.areMultiple()&&(E=[o(this.activeShapes),s(this.activeShapes),l(),p(),h()],this.activeShapes.areSiblings()&&(E.push(c()),this.activeShapes.areBaselines()&&E.push(y()))),this.activeShapes.areTableAndCell()||this.activeShapes.isSingle()){var O;if(E=[o(this.activeShapes),s(this.activeShapes),l(),p(),h()],this.activeShapes.areTableAndCell())E.push(x(this.activeShapes.getCell())),E.push(S(this.activeShapes.getCell())),(O=E).push.apply(O,Object(d["a"])(a(this.activeShapes,e)));else E.push(x(this.activeShapes[0])),E.push(S(this.activeShapes[0]));this.activeShapes.isBaseline()&&(E.push(y()),E.push(b())),this.activeShapes.isWord()&&(E=[o(this.activeShapes),s(this.activeShapes)])}if(t instanceof fabric.Polyline&&this.activeShapes.areTableAndCell()){var C=this.activeShapes.find((function(t){return t instanceof tt}));E=[v(C,t)]}t instanceof fabric.Circle&&(E=[f(t)]),null!==(n=this.activeShapes[0])&&void 0!==n&&n.invalid&&nt["ctxmenu"].update("#box",[]),nt["ctxmenu"].update("#box",E)},xt.prototype.getType=function(t){return t instanceof G?xt.SHAPE_TYPE.REGION:t instanceof tt?xt.SHAPE_TYPE.TABLE:t instanceof q?xt.SHAPE_TYPE.BASELINE:t instanceof J?xt.SHAPE_TYPE.CELL:void 0},xt.prototype.getIndex=function(t){if(t instanceof G||t instanceof tt)return this.regions.indexOf(t);if(t instanceof q){var e=this.getBaselineParent(t.id);return e.baselines.indexOf(t)}},xt.prototype.writeToClipboard=function(t){var e=this,n=function t(e){var n,o;null!=(null===(n=e.elements)||void 0===n?void 0:n.textLines)&&(e.elements.textLines=e.elements.textLines.filter((function(t){return!!r.includes(t.attributes.id)&&(i=i.filter((function(e){return e.id!=t.attributes.id})),!0)}))),null!=(null===(o=e.elements)||void 0===o?void 0:o.cells)&&e.elements.cells.map((function(e){return t(e)}))},i=t.filter((function(t){return t instanceof q})),r=i.map((function(t){return t.id})),o=t.filter((function(t){return t instanceof G||t instanceof tt})),s=o.map((function(t){log(t);var i=e.getIndex(t),r=t.getBlueprint(i,!0);return n(r),{type:e.getType(t),blueprint:r}})),a=i.map((function(t){var n=e.getIndex(t),i=e.getBaselineParent(t.id).id;return{type:e.getType(t),blueprint:t.getBlueprint(n,null,!0),parentId:i}})),c=[].concat(Object(d["a"])(s),Object(d["a"])(a));return log(c),navigator.clipboard.writeText(JSON.stringify(c))},xt.prototype.readFromClipboard=function(){var t=this,e=function(t){try{var e=JSON.parse(t);if(!("type"in e[0])||!("blueprint"in e[0]))return!1}catch(n){return!1}return!0},n=function(e){return t.allShapes().some((function(t){return e.vertices.every((function(e){return t.vertices.find((function(t){return t.left===e.left&&t.top===e.top}))}))}))},i=function t(e){n(e)&&(e.vertices.map((function(t){t.left=t.left+10,t.top=t.top+10})),e.getBaselines&&e.getBaselines().map((function(e){t(e)})),t(e))};navigator.clipboard.readText().then((function(n){if(e(n)){var r=JSON.parse(n),o=[],s=r.map((function(e){switch(e.blueprint.attributes.id=y.instance().requestId("s"),e.type){case xt.SHAPE_TYPE.REGION:var n=new G(t.canvas,e.blueprint);return i(n),o.push({type:g.ADD_SHAPE,index:e.blueprint.attributes.custom.readingOrder,shape:n}),n;case xt.SHAPE_TYPE.TABLE:var r=new tt(t.canvas,e.blueprint);return i(r),o.push({type:g.ADD_SHAPE,index:e.blueprint.attributes.custom.readingOrder,shape:r}),r;case xt.SHAPE_TYPE.BASELINE:var s=new q(t.canvas,e.blueprint);i(s);var a=t.getShape(e.parentId);if(a instanceof G||a instanceof J)return o.push({type:g.ADD_SHAPE,index:e.blueprint.attributes.custom.readingOrder,shape:s,parent_id:a.id}),s;var c=t.findParentByPolygon(s.getPolygonCoords());if(null!=c)return o.push({type:g.ADD_SHAPE,index:e.blueprint.attributes.custom.readingOrder,shape:s,parent_id:c.id}),s;var l=new G(t.canvas);l.adjustToBaseline(s.getPolygonCoords()),l.addBaseline(s,0);var u=t.expectedRegionIndex(l);return o.push({type:g.ADD_SHAPE,index:u,shape:l}),l}})),a={type:g.MULTI_ACTION,actions:o};t.actionHandler.doAction(a),t.actionHandler.addAction(a),t.actionHandler.select({type:m.CLEAR});var c=s.reduce((function(t,e){return[].concat(Object(d["a"])(t),[e.id],Object(d["a"])(e.getBaselines?e.getBaselines().map((function(t){return t.id})):[]))}),[]);log(c),t.actionHandler.select({type:m.ADD,ids:c})}}))},xt.prototype.selectSingleShape=function(t,e){var n=this.findShape(e);if((this.activeShapes.isEmpty()||this.activeShapes.haveState(H.STATE.EDIT)&&!t.target)&&(this.actionHandler.select({type:m.CLEAR}),null!=n&&(this.actionHandler.select({type:m.ADD,ids:[n.id]}),n instanceof J))){var i=this.getTableOfCell(n.id);this.activeShapes.includes(i)||this.actionHandler.select({type:m.ADD,ids:[i.id]})}},xt.prototype.updateVertexSizes=function(t){var e=this,n=function(){null!=e.hoveredVertex&&(e.hoveredVertex.set({radius:e.hoveredVertex.defaultRadius}),e.hoveredVertex=null)},i=function(n){null!=t&&(n.set({radius:1.5*n.defaultRadius}),e.hoveredVertex=n)};return null==t||"circle"!=t.type?(n(),void this.canvas.requestRenderAll()):null==this.hoveredVertex?(i(t),void this.canvas.requestRenderAll()):this.hoveredVertex.id!=t.id?(n(),i(t),void this.canvas.requestRenderAll()):void 0};var Lt=xt,It=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.types?n("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[n("b-icon",{attrs:{icon:"label-multiple"}}),t._v(" "+t._s(t.$t("Structure Types"))+" ")],1),n("button",{staticClass:"delete",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}})]),n("section",{staticClass:"modal-card-body"},[t._l(t.types,(function(e,i){return n("b-collapse",{key:i,staticClass:"card",attrs:{animation:"slide",open:!1},scopedSlots:t._u([{key:"trigger",fn:function(i){return[n("div",{staticClass:"card-header",attrs:{role:"button"}},[e.name?n("p",{staticClass:"card-header-title"},[t._v(" "+t._s(e.name)+" ")]):n("p",{staticClass:"card-header-title"},[t._v(" "+t._s(e.label)+" ")]),n("a",{staticClass:"card-header-icon"},[n("span",{staticClass:"dot",style:t.backgroundDot(e)}),n("b-icon",{attrs:{icon:i.open?"menu-down":"menu-up"}})],1)])]}}],null,!0)},[n("div",{staticClass:"card-content"},[n("div",{staticClass:"content"},[n("b-field",{attrs:{label:"Name"}},[n("b-input",{attrs:{disabled:"true"===e.default},on:{input:function(e){return t.format(i)}},model:{value:e.name,callback:function(n){t.$set(e,"name","string"===typeof n?n.trim():n)},expression:"type.name"}})],1),n("b-field",{attrs:{label:t.$t("Choose color")}},[t.swatchesExists()?n("v-swatches",{attrs:{"fallback-input-type":"color","show-fallback":"",disabled:"true"===e.default},model:{value:e.color,callback:function(n){t.$set(e,"color",n)},expression:"type.color"}}):t._e()],1),n("b-button",{attrs:{"icon-left":"minus",type:"is-danger",expanded:"",disabled:"true"===e.default},on:{click:function(e){return t.openConfirm(i)}}},[t._v(t._s(t.$t("Remove")))])],1)])])})),n("b-field",[n("b-button",{attrs:{"icon-left":"plus",type:"is-primary",expanded:""},on:{click:t.openAdd}},[t._v(t._s(t.$t("Add new structure type")))])],1),n("b-field",[n("b-button",{attrs:{"icon-left":"content-save-all",type:"is-success",expanded:""},on:{click:t.saveConfig}},[t._v(t._s(t.$t("Save")))])],1)],2)]):t._e()},Pt=[],kt=n("1da1"),Dt=(n("96cf"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card",staticStyle:{width:"auto"}},[n("header",{staticClass:"card-header"},[n("div",{staticClass:"card-header-title"},[t._v(" "+t._s(t.$t("Create new structure type"))+" ")]),n("div",{staticClass:"card-header-icon"},[n("button",{staticClass:"delete is-large",on:{click:function(e){return t.$parent.close()}}})])]),n("div",{staticClass:"card-content"},[n("div",{staticClass:"content"},[n("b-field",{staticStyle:{"margin-top":"20px"},attrs:{label:"Name"}},[n("b-input",{on:{input:function(e){return t.format()}},model:{value:t.type.name,callback:function(e){t.$set(t.type,"name","string"===typeof e?e.trim():e)},expression:"type.name"}})],1),n("b-field",{staticStyle:{"margin-top":"40px","margin-bottom":"30px"},attrs:{label:t.$t("Choose color")}},[t.swatchesExists()?n("v-swatches",{attrs:{"fallback-input-type":"color",swatches:"text-advanced","show-fallback":"","popover-y":"top"},model:{value:t.type.color,callback:function(e){t.$set(t.type,"color",e)},expression:"type.color"}}):t._e()],1),n("p",{staticClass:"control"},[n("b-button",{staticClass:"button is-primary",attrs:{"icon-left":"plus"},on:{click:t.create}},[t._v(t._s(t.$t("Create")))])],1)],1)])])}),Mt=[],Nt=(n("e8bb"),{data:function(){return{type:{name:"newType",color:"#00aaff"}}},props:{currentTypes:{type:Array,required:!0,default:function(){return[]}}},methods:{swatchesExists:function(){return null!=this.$router},create:function(){var t=this;this.currentTypes.some((function(e){return e.name===t.type.name}))?this.openToast(this.$t("This type already exists"),"is-danger"):this.$emit("closeModal",this.type)},format:function(){this.type.name=this.type.name.replaceAll(" ","-")},openToast:function(t,e){this.$buefy.toast.open({duration:4e3,message:t,position:"is-top",type:e})}}}),Vt=Nt,jt=n("2877"),Bt=Object(jt["a"])(Vt,Dt,Mt,!1,null,null,null),Ht=Bt.exports,Ut={props:{initTypes:{type:Array,default:function(){return[]}}},data:function(){return{types:JSON.parse(JSON.stringify(this.initTypes))}},mounted:function(){},methods:{swatchesExists:function(){return null!=this.$router},openConfirm:function(t){var e=this;this.$buefy.dialog.confirm({title:this.$t("Delete structure type"),message:this.$t("Are you sure you want to delete this type definition?"),confirmText:this.$t("Delete structure type"),type:"is-danger",hasIcon:!0,onConfirm:function(){return e.removeTag(t)}})},openAdd:function(){var t=this,e=this.$buefy.modal.open({parent:this,component:Ht,props:{currentTypes:this.types},events:{closeModal:function(n){t.types.push(n),e.close()}}})},backgroundDot:function(t){return"background-color: "+t.color},removeTag:function(t){this.types.splice(t,1)},saveConfig:function(){var t=this;return Object(kt["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$emit("save",t.types);case 1:case"end":return e.stop()}}),e)})))()},format:function(t){this.types[t].name=this.types[t].name.replaceAll(" ","-")},openToast:function(t,e){this.$buefy.toast.open({duration:4e3,message:t,position:"is-top",type:e})}}},Ft=Ut,Wt=(n("8a1f"),Object(jt["a"])(Ft,It,Pt,!1,null,"7b3dceef",null)),qt=Wt.exports,$t=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[n("b-icon",{style:{"margin-right":"10px"},attrs:{icon:"cogs"}}),t._v(" "+t._s(t.$t("Settings"))+" ")],1),n("button",{staticClass:"delete",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}})]),n("section",{staticClass:"modal-card-body"},[n("b-tabs",{attrs:{type:"is-boxed",position:"is-centered",expanded:""}},[n("b-tab-item",{attrs:{label:t.$t("General"),icon:"tune"}},[n("div",{staticClass:"tab-content"},[n("ul",[n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("showRegions")}},model:{value:t.handles.showRegions,callback:function(e){t.$set(t.handles,"showRegions",e)},expression:"handles.showRegions"}}),t._v(" "+t._s(t.$t("Show Regions"))+" ")],1),n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("showBaselines")}},model:{value:t.handles.showBaselines,callback:function(e){t.$set(t.handles,"showBaselines",e)},expression:"handles.showBaselines"}}),t._v(" "+t._s(t.$t("Show Baselines"))+" ")],1),n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("showWords")}},model:{value:t.handles.showWords,callback:function(e){t.$set(t.handles,"showWords",e)},expression:"handles.showWords"}}),t._v(" "+t._s(t.$t("Show Words"))+" ")],1),n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("showStructureTypes")}},model:{value:t.handles.showStructureTypes,callback:function(e){t.$set(t.handles,"showStructureTypes",e)},expression:"handles.showStructureTypes"}}),t._v(" "+t._s(t.$t("Show structure types"))+" ")],1),n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("showReadingOrder")}},model:{value:t.handles.showReadingOrder,callback:function(e){t.$set(t.handles,"showReadingOrder",e)},expression:"handles.showReadingOrder"}}),t._v(" "+t._s(t.$t("Show readingorder"))+" ")],1),n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("showRelations")}},model:{value:t.handles.showRelations,callback:function(e){t.$set(t.handles,"showRelations",e)},expression:"handles.showRelations"}}),t._v(" "+t._s(t.$t("Show relations"))+" ")],1),n("li",[n("div",{style:{display:"flex","flex-direction":"horizontal","align-items":"center"}},[n("b-slider",{style:{width:"100px"},attrs:{rounded:"",min:5,max:80},on:{input:function(e){return t.changed("structureTypeSize")}},model:{value:t.handles.structureTypeSize,callback:function(e){t.$set(t.handles,"structureTypeSize",e)},expression:"handles.structureTypeSize"}}),n("span",{style:{"margin-left":"20px"}},[t._v(t._s(t.$t("Change label size")))]),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Reset")}},[n("b-button",{style:{"margin-left":"20px",width:"30px",height:"30px"},attrs:{"icon-left":"rotate-left"},on:{click:function(e){return t.reset("structureTypeSize")}}})],1)],1)],1)]),n("li",[n("div",{style:{display:"flex","flex-direction":"horizontal","align-items":"center"}},[n("b-slider",{style:{width:"100px"},attrs:{rounded:"",min:2,max:10},on:{input:function(e){return t.changed("circleSize")}},model:{value:t.handles.circleSize,callback:function(e){t.$set(t.handles,"circleSize",e)},expression:"handles.circleSize"}}),n("span",{style:{"margin-left":"20px"}},[t._v(t._s(t.$t("Change circle size")))]),n("div",[n("b-tooltip",{attrs:{position:"is-right",label:t.$t("Reset")}},[n("b-button",{style:{"margin-left":"20px",width:"30px",height:"30px"},attrs:{"icon-left":"rotate-left"},on:{click:function(e){return t.reset("circleSize")}}})],1)],1)],1)]),n("li",{staticStyle:{cursor:"pointer"},on:{click:t.openStructureManager}},[n("b-icon",{staticClass:"media-left",attrs:{icon:"label-multiple"}}),t._v(" "+t._s(t.$t("Manage Structure Types"))+" ")],1),n("li",{staticStyle:{cursor:"pointer"},on:{click:t.openShortcutManager}},[n("b-icon",{staticClass:"media-left",attrs:{icon:"keyboard"}}),t._v(" "+t._s(t.$t("Manage keyboard shortcuts"))+" ")],1)])])]),n("b-tab-item",{attrs:{label:t.$t("Layouttree"),icon:"file-tree"}},[n("div",{staticClass:"tab-content"},[n("ul",[n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("treeExpand")}},model:{value:t.handles.treeExpand,callback:function(e){t.$set(t.handles,"treeExpand",e)},expression:"handles.treeExpand"}}),t._v(" "+t._s(t.$t("Always expand"))+" ")],1),n("li",[n("b-switch",{attrs:{size:"is-small"},on:{input:function(e){return t.changed("treeShowTextOnly")}},model:{value:t.handles.treeShowTextOnly,callback:function(e){t.$set(t.handles,"treeShowTextOnly",e)},expression:"handles.treeShowTextOnly"}}),t._v(" "+t._s(t.$t("Only display text"))+" ")],1)])])])],1)],1)])},Gt=[],zt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[n("b-icon",{style:{"margin-right":"10px"},attrs:{icon:"keyboard"}}),t._v(" "+t._s(t.$t("Shortcuts"))+" ")],1),n("button",{staticClass:"delete",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}})]),n("section",{staticClass:"modal-card-body"},[n("div",{staticClass:"description"},[n("ul",t._l(t.shortcuts,(function(e){return n("li",{key:e.string},[n("span",{domProps:{innerHTML:t._s(t.$t(e.string))}})])})),0)])])])},Yt=[],Xt={props:{initTypes:{type:Array,default:function(){return[]}}},data:function(){return{shortcuts:[{string:"Hold <div class='description-icon' id='a-icon' ></div> to add points to the beginning or end of a selected Line"},{string:"Hold V to <strong>split</strong> a shape vertically"},{string:"Hold H to <strong>split</strong> a shape horizontally"},{string:"Hold C to <strong>split</strong> a shape with a custom line (use arrow keys to change the angle)"},{string:"Press <div class='description-icon' id='m-icon' ></div> to merge two selected Lines"},{string:"Press <div class='description-icon' id='esc-icon' > </div> to leave the current mode and enter selection mode"}]}},mounted:function(){},methods:{}},Jt=Xt,Zt=Object(jt["a"])(Jt,zt,Yt,!1,null,"05c4de49",null),Kt=Zt.exports,Qt={props:{structureTypes:{type:Array,default:function(){return[]}}},data:function(){return{handles:{}}},mounted:function(){this.fetchSettings()},methods:{fetchSettings:function(){var t=C.instance();this.handles=Object(c["a"])({},t.getAll())},changed:function(t){C.instance().set(Object(b["a"])({},t,this.handles[t]))},reset:function(t){C.instance().reset(t),this.fetchSettings()},openStructureManager:function(){var t=this;this.$buefy.modal.open({parent:this,component:qt,props:{initTypes:this.structureTypes},events:{save:function(e){t.$emit("save",e)}}})},openShortcutManager:function(){this.$buefy.modal.open({parent:this,component:Kt})}}},te=Qt,ee=(n("e956"),Object(jt["a"])(te,$t,Gt,!1,null,"549c31c2",null)),ne=ee.exports,ie=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card",staticStyle:{width:"auto"}},[n("header",{staticClass:"card-header"},[n("div",{staticClass:"card-header-title is-centered"},[t._v(" "+t._s(t.$t(t.heading))+" ")])]),n("div",{staticClass:"card-content"},[n("div",{staticClass:"content"},[n("p",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.$t(t.text)))])])])])},re=[],oe={props:{heading:{type:String},text:{type:String}},data:function(){return{}},methods:{}},se=oe,ae=Object(jt["a"])(se,ie,re,!1,null,null,null),ce=ae.exports,le=n("ca2f"),ue=(n("f8cd"),n("ca7e")),de=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"layout-panel"}},[n("div",{staticStyle:{height:"30px","overflow-x":"hidden","white-space":"nowrap"}},[t.showTextOnly?t._e():n("span",{staticClass:"inline-span",style:"position:absolute; left: "+(this.margins.id+this.defaultTreeIndent/4)+"px"},[n("strong",[t._v(t._s(t.$t("Id")))])]),t.showTextOnly?t._e():n("span",{staticClass:"inline-span",style:"position:absolute; left: "+(this.margins.readingOrder+this.defaultTreeIndent/4)+"px"},[n("strong",[t._v(t._s(t.$t("Order")))])]),t.showTextOnly?t._e():n("span",{staticClass:"inline-span",style:"position:absolute; left: "+(this.margins.structureType+this.defaultTreeIndent/4)+"px"},[n("strong",[t._v(t._s(t.$t("Structure Type")))])]),n("span",{staticClass:"inline-span",style:"position:absolute; left: "+((this.showTextOnly?this.margins.id:this.margins.text)+this.defaultTreeIndent/4)+"px"},[n("strong",[t._v(t._s(t.$t("Text")))])])]),n("div",{attrs:{id:"scroll-box"},on:{click:t.panelClick}},[n("Tree",{ref:"tree",attrs:{edgeScroll:"",value:t.treeData,ondragstart:t.layoutDragStart,ondragend:t.layoutDragEnd},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.node,r=e.path,o=e.tree;return n("div",{staticClass:"node-container",attrs:{id:"node_"+i.id},on:{click:function(e){return t.layoutClick(i,r)}}},[n("span",[i.children&&i.children.length>0?n("b",{on:{click:function(t){return o.toggleFold(i,r)}}},[t._v(" "+t._s(i.$folded?"+":"-")+" ")]):t._e(),n("span",[n("strong",[t._v(t._s(("Baseline"===i.type?t.$t("Line"):t.$t(i.type))+" "+(i.selected,"")))])])]),t.showTextOnly?t._e():n("span",{staticClass:"column-element",style:t.getIdStyle(r)},[n("p",[t._v(t._s("#"+i.id))])]),t.showTextOnly?t._e():n("span",{staticClass:"column-element",style:t.getReadingOrderStyle(r)},[n("p",[t._v(t._s(r[r.length-1]+1))])]),t.showTextOnly?t._e():n("span",{staticClass:"column-element",style:t.getStructureStyle(i.structureType,r)},[n("p",[t._v(t._s(i.structureType))])]),n("span",{staticClass:"column-element",style:t.getTextStyle(r)},[n("p",[t._v(t._s(i.text))])])])}}])})],1)])},pe=[],he={components:{Tree:ue["c"].mixPlugins([ue["b"],ue["a"]])},props:{initData:{type:Array,default:function(){return[]}},settings:{type:Object,default:function(){return{}}},isOpen:{type:Boolean,default:!1}},data:function(){return{showTextOnly:!1,treeData:[],activeShapeIds:[],controlPressed:!1,margins:{readingOrder:140,structureType:240,text:340,id:90},defaultTreeIndent:20}},watch:{settings:function(t,e){var n=function(n){return(null===e||void 0===e?void 0:e[n])!==(null===t||void 0===t?void 0:t[n])},i=this.$refs.tree;null!=i&&(n("treeExpand")&&(t.treeExpand?i.unfoldAll():i.foldAll()),n("treeShowTextOnly")&&(this.showTextOnly=t.treeShowTextOnly))},initData:function(t){var e=this,n=JSON.parse(JSON.stringify(t)),i=this.$refs.tree;this.extendTree(n),i&&(i.rootNode.$droppable=function(){return"Baseline"!==e.dragType}),this.settings.treeExpand&&Object(ue["d"])(n),setTimeout((function(){return e.scrollContainerByNodeId(e.activeShapeIds[0])}),0),this.treeData=n},activeShapeIds:function(t,e){}},mounted:function(){var t=this;document.addEventListener("keydown",(function(e){switch(e.key){case"Control":t.controlPressed=!0}})),document.addEventListener("keyup",(function(e){switch(e.key){case"Control":t.controlPressed=!1}}))},methods:{settingsUpdate:function(t){},extendTree:function(t){var e=this;Object(ue["e"])(t,(function(t){var n=t.id,i=t.children,r=function(t){return e.activeShapeIds.includes(t)},o=null===i||void 0===i?void 0:i.some((function(t){var e;return r(t.id)||(null===(e=t.children)||void 0===e?void 0:e.some((function(t){return r(t.id)})))}));e.addProperties(t,o,r(n))}))},unFoldNodePath:function(t){var e=this.$refs.tree,n=this.getTreeNodeInfo(t);null!==n&&void 0!==n&&n.parent&&(e.unfold(n.parent),this.unFoldNodePath(n.parent.id))},getTreeNodeInfo:function(t){var e;return this.$refs.tree.walkTreeData((function(n,i,r,o){if(n.id===t)return e={node:n,index:i,parent:r,path:o},!1})),e},getStructureStyle:function(t,e){var n,i=null===(n=C.instance().structureTypes.find((function(e){return e.name===t})))||void 0===n?void 0:n.color,r=(e.length-1)*this.defaultTreeIndent;return"color: ".concat(i,"; left: ").concat(this.margins.structureType-r,"px")},getIdStyle:function(t){var e=(t.length-1)*this.defaultTreeIndent;return"left: ".concat(this.margins.id-e,"px")},getReadingOrderStyle:function(t){var e=(t.length-1)*this.defaultTreeIndent;return"left: ".concat(this.margins.readingOrder-e,"px")},getTextStyle:function(t){var e=(t.length-1)*this.defaultTreeIndent;return"left: ".concat((this.showTextOnly?this.margins.id:this.margins.text)-e,"px")},scrollContainerByNodeId:function(t){var e=document.querySelector("#node_".concat(t));if(null!=e){var n=e.offsetTop,i=document.querySelector("#scroll-box");if(null!=i){var r=i.clientHeight/2,o=n-r;Math.abs(i.scrollTop-o)<r||(i.scrollTop=o)}}},performSelection:function(t){var e=this,n=function(t){if(!1!==e.activeShapeIds.includes(t)){var n=e.getTreeNodeInfo(t);null!==n&&void 0!==n&&n.node&&(n.node.$nodeStyle="",n.node.$nodeBackClass="node-hover",n.node.selected=!1,e.activeShapeIds.splice(e.activeShapeIds.indexOf(t),1))}},i=function(t){if(!e.activeShapeIds.includes(t)){var n=e.getTreeNodeInfo(t);null!==n&&void 0!==n&&n.node&&(n.node.$nodeStyle=n.node.styleSelected,n.node.$nodeBackClass="",n.node.selected=!0,e.activeShapeIds.push(t))}};switch(t.type){case m.REMOVE:var r=t.ids;r.map((function(t){n(t)}));break;case m.ADD:var o=t.ids;o.map((function(t){i(t),e.unFoldNodePath(t)})),this.$nextTick((function(){e.scrollContainerByNodeId(o[0])}));break;case m.CLEAR:var s=Object(d["a"])(this.activeShapeIds);s.map((function(t){return n(t)}));break}},performAction:function(t){var e=this;if(null!=t){var n=this.$refs.tree;switch(t.type){case g.MULTI_ACTION:t.actions.map((function(t){e.performAction(t)}));break;case g.ADD_SHAPE:var i=this.getTreeNodeInfo(t.parent_id);if(t.shape instanceof q){var r=null===i||void 0===i?void 0:i.node;if(null==r)break;var o=t.shape.getLayout();this.extendTree(o),r.children.splice(t.index,0,o),this.unFoldNodePath(t.shape.id);break}if(t.shape instanceof G){var s=t.shape.getLayout();this.extendTree(s),n.rootNode.children.splice(t.index,0,s);break}if(t.shape instanceof tt){var a=t.shape.getLayout();this.extendTree(a),n.rootNode.children.splice(t.index,0,a);break}break;case g.REMOVE_SHAPE:var c=this.getTreeNodeInfo(t.shape.id);if(null==c)break;var l=c.parent;t.shape instanceof q&&l.children.splice(t.index,1),(t.shape instanceof G||t.shape instanceof tt)&&n.rootNode.children.splice(t.index,1);break;case g.CHANGE_READING_ORDER:var u=this.getTreeNodeInfo(t.shape_id);if(null==u)break;var p=u.node,h=u.parent;"Region"!==p.type&&"Table"!==p.type||L(n.rootNode.children,t.old_index,t.new_index),"Baseline"===p.type&&L(h.children,t.old_index,t.new_index);break;case g.CHANGE_PARENT:var f,v=this.getTreeNodeInfo(t.old_parent_id),m=this.getTreeNodeInfo(t.new_parent_id);if(null==v||null==m)break;var y=v.node,T=m.node,b=y.children.splice(t.old_index,t.shape_count);(f=T.children).splice.apply(f,[t.new_index,0].concat(Object(d["a"])(b)));break;case g.REMOVE_CELL:case g.ADD_CELL:var x=this.getTreeNodeInfo(t.shape_id);if(null==x)break;var S=null===x||void 0===x?void 0:x.index,E=t.table.getLayout();this.extendTree(E),n.rootNode.children.splice(S,1,E),this.unFoldNodePath(t.cell.id);break;case g.SET_STRUCTUR_TYPE:var O=this.getTreeNodeInfo(t.shape_id);if(null==O)break;var C=O.node;C.structureType=t.new_type,"none"===t.new_type&&(C.structureType=null);break;case g.POSITION_MOVE:var A=this.getTreeNodeInfo(t.shape_id);if(null==A)break;var w=A.index,_=A.parent||n.rootNode;L(_.children,w,w+t.distance);break}}},addProperties:function(t,e,n){var i=this,r=t.type,o="background-color: ".concat("Baseline"===r?"rgba(0, 0, 255, 0.3)":"Region"===r?"rgba(0, 128, 0, 0.3)":"Table"===r?"rgba(249, 180, 45, 0.3)":"rgba(255,255, 0, 0.3)",";");t.selected=n,t.styleSelected=o,t.$nodeStyle=n?o:"",t.$nodeBackClass=n?"":"node-hover",t.$folded=!e,t.$droppable=function(){return"Baseline"===i.dragType?"Region"===r||"Cell"===r:"Region"!==i.dragType&&"Table"!==i.dragType&&void 0}},selectionAddShape:function(t){var e=this.$refs.tree;f.instance().select({type:m.ADD,ids:[t]});var n=this.getTreeNodeInfo(t),i=n.node,r=n.path;if("Cell"===i.type){var o=e.getNodeByPath(r.slice(0,-1));!1===this.activeShapeIds.includes(o.id)&&f.instance().select({type:m.ADD,ids:[o.id]})}},selectionRemoveShape:function(t){var e=this;this.$refs.tree;f.instance().select({type:m.REMOVE,ids:[t]});var n=this.getTreeNodeInfo(t),i=n.node;n.path;"Table"===i.type&&i.children.map((function(t){e.activeShapeIds.includes(t.id)&&f.instance().select({type:m.REMOVE,ids:[t.id]})}))},layoutDragStart:function(t,e){var n=e.dragNode;return this.dragType=n.type,this.activeShapeIds.includes(n.id)||(f.instance().select({type:m.CLEAR}),this.selectionAddShape(n.id)),"Cell"!==n.type},layoutDragEnd:function(t,e){var n,i=this,r=e.startPath,o=e.targetPath,s=e.dragNode.id,a=function(t){return t.length<=1||Boolean(t.reduce((function(t,e){return!isNaN(t)&&(t+1===e&&e)})))},c=function(t){var e=!1;return t.reduce((function(t,n){log(t);var r=i.getTreeNodeInfo(t).path.slice(0,-1),o=i.getTreeNodeInfo(n).path.slice(0,-1);return JSON.stringify(r)!==JSON.stringify(o)&&(e=!0),n})),e},l=this.activeShapeIds.map((function(t){return i.getTreeNodeInfo(t).index}));l.sort((function(t,e){return t-e}));var u=s,p=r[r.length-1],h=t.getNodeByPath(r.slice(0,-1))||t.rootNode,v=null===h||void 0===h?void 0:h.id,m=o[o.length-1],y=null===(n=t.getNodeByPath(o.slice(0,-1)))||void 0===n?void 0:n.id;v===y&&m>p&&m--;var T=this.getDragAction(v,y,p,m,u);if(this.activeShapeIds.length>1&&!c(this.activeShapeIds)&&a(l)){var b=m-p,x=Object(d["a"])(this.activeShapeIds),S=function(t,e,n){return t.map((function(t){return i.getTreeNodeInfo(t).index})).some((function(t){return t+e>n.children.length-1}))},E=function(t,e){return t.map((function(t){return i.getTreeNodeInfo(t).index})).some((function(t){return t+e<0}))},O=function t(e,n,i){return S(e,n,i)?t(e,n-1,i):E(e,n)?t(e,n+1,i):n};v===y?(b>0?x.sort((function(t,e){return i.getTreeNodeInfo(e).index-i.getTreeNodeInfo(t).index})):x.sort((function(t,e){return i.getTreeNodeInfo(t).index-i.getTreeNodeInfo(e).index})),b=O(x,b,h),T={type:g.MULTI_ACTION,actions:x.map((function(t){return i.getMoveAction(t,b)}))}):(x.sort((function(t,e){return i.getTreeNodeInfo(t).index-i.getTreeNodeInfo(e).index})),T={type:g.CHANGE_PARENT,shape_count:x.length,old_parent_id:v,new_parent_id:y,old_index:this.getTreeNodeInfo(x[0]).index,new_index:m})}return f.instance().doAction(T),f.instance().addAction(T),!1},layoutClick:function(t){if(!this.controlPressed)return f.instance().select({type:m.CLEAR}),void this.selectionAddShape(t.id);this.activeShapeIds.includes(t.id)?this.selectionRemoveShape(t.id):this.selectionAddShape(t.id)},panelClick:function(t){t.target===t.currentTarget&&f.instance().select({type:m.CLEAR})},getDragAction:function(t,e,n,i,r){return t!=e?{type:g.CHANGE_PARENT,shape_count:1,old_parent_id:t,new_parent_id:e,old_index:n,new_index:i}:{type:g.CHANGE_READING_ORDER,shape_id:r,old_index:n,new_index:i}},getMoveAction:function(t,e){return{type:g.POSITION_MOVE,shape_id:t,distance:e}}}},fe=he,ve=(n("a674"),Object(jt["a"])(fe,de,pe,!1,null,null,null)),ge=ve.exports,me=n("60cb"),ye=void 0,Te={data:function(){return{treeOpen:!1,canvas:{},layout:[],overlay:{},editor:{},editorState:null,Editor:Lt,vueFunctions:{},windowWidth:null,canvasHeight:null,leftClickTracker:null,drag:null,dragType:null,treeData:[{text:"node 1"},{text:"node 2",children:[{text:"node 2-1"}]}],settings:{},instructions:[{string:this.$t("New <strong>points</strong> can be added by clicking in the middle of a line and dragging the new point to a new position")},{string:this.$t("Edit Shapes using the <strong>context menu</strong> (right click)")},{string:this.$t("Hold <div class='description-icon' id='shift-icon'></div> to <strong>move</strong> and <strong>scale</strong> shapes")},{string:this.$t("Press <div class='description-icon' id='ctrl-icon'></div> + L to select all lines of a selected region")},{string:this.$t("Hold <div class='description-icon' id='ctrl-icon'></div> or <div class='description-icon' id='cmd-icon'></div> to select <strong>multiple</strong> shapes")},{string:this.$t("Press <div class='description-icon' id='tab-icon' ></div> to select the <strong>next</strong> shape (following the reading order)")}],options:{callback:function(t){ye.$store.dispatch("detail/content/update",{fullScreen:t})}}}},components:{Tree:ue["c"].mixPlugins([ue["b"],ue["a"]]),LayoutTree:ge},computed:Object(c["a"])({},Object(le["a"])("detail/content",["fullScreen"])),watch:{structureTypes:{deep:!0,handler:function(t){C.instance().structureTypes=t}}},props:{pageXml:{key:String},tileSource:{key:Object},structureTypes:{key:Array}},created:function(){var t=this.tileSource.width,e=window.innerWidth;this.scaleFactor=e/t;var n=function(t){return Math.round(1e6*t)/1e6};this.scaleFactor=n(this.scaleFactor),this.windowWidth=window.innerWidth},mounted:function(){var t=this,e=!0,n=!0,i=!0;window.log=e?console.log.bind(window.console):function(){},window.protocolLog=i?console.log.bind(window.console):function(){},window.warn=n?console.warn.bind(window.console):function(){},ye=this;var r=Object(me["OpenSeadragon"])({id:"osd",prefixUrl:"openseadragon/images/",tabIndex:"",tileSources:[{tileSource:this.tileSource}],controlsFadeDelay:6e4,showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,minZoomImageRatio:.5,maxZoomPixelRatio:10,visibilityRatio:0});r.addOnceHandler("open",(function(){t.fitToWidth(),t.$emit("hasLoaded")})),Object(me["initOverlay"])(me["OpenSeadragon"],me["fabric"]);var o=r.fabricjsOverlay({scale:1e3}),s=o.fabricCanvas();s.uniformScaling=!1,s.fireRightClick=!0,s.uniScaleKey="null",s.centeredKey="null",s.selectionKey="null",s.altActionKey="null",s.altSelectionKey="null";var a=this.tileSource.height/this.tileSource.width;this.canvasHeight=s.width*a,r.zoomPerClick=1,r.setControlsEnabled(!1),this.vueFunctions={setEditorState:this.setEditorState,save:this.save,setEdited:this.setEdited,openModal:this.openModal,getRouterBase:this.getRouterBase,getCanvasHeight:this.getCanvasHeight,getTileSourceWidth:function(){return t.tileSource.width},performAction:this.performAction,performSelection:this.performSelection,$t:this.$t.bind(this),setDrag:this.setDrag},C.instance().on("update",(function(e){t.saveSettingsToCookie(e),t.settings=e})),null!=this.structureTypes&&(C.instance().structureTypes=this.structureTypes);var c=this.getSettingsFromCookie();C.instance().set(c),this.viewer=r,window.layouteditor=new Lt(s,this.pageXml,this.scaleFactor,this.vueFunctions),window.layouteditor.render();var l=0;r.addHandler("canvas-drag",(function(){l++%20===0&&(window.layouteditor.canvasDrag||(window.layouteditor.canvasDrag=!0))})),this.fetchLayout()},beforeDestroy:function(){window.layouteditor.removeKeyListeners()},methods:{setDrag:function(t){this.viewer.setMouseNavEnabled(t)},getSettingsFromCookie:function(){var t;if(null!=this.$cookies)return null===(t=this.$cookies.get("transkribus-config"))||void 0===t?void 0:t.layoutSettings},saveSettingsToCookie:function(t){if(null!=this.$cookies){var e=this.$cookies.get("transkribus-config")||{};e.layoutSettings=Object(c["a"])(Object(c["a"])({},null===e||void 0===e?void 0:e.layoutSettings),t),this.$cookies.set("transkribus-config",JSON.stringify(e))}},openSettingsModal:function(){var t=this;this.$buefy.modal.open({parent:this,component:ne,props:{structureTypes:this.structureTypes},events:{save:function(e){t.$emit("publishStructureTypes",e)}}})},performAction:function(t){this.$refs.layoutTree.performAction(t)},performSelection:function(t){this.$refs.layoutTree.performSelection(t)},fetchLayout:function(){this.layout=window.layouteditor.getLayout()},setLeftClickDrag:function(t){},openModal:function(t,e){this.$buefy.modal.open({parent:this,component:ce,props:{heading:t,text:e}})},getRouterBase:function(){var t,e;return(null===(t=this.$router)||void 0===t||null===(e=t.options)||void 0===e?void 0:e.base)||""},getCanvasHeight:function(){return this.canvasHeight},buttonClick:function(t){window.layouteditor.buttonClick(t)},setEditorState:function(t){this.editorState=t},save:function(){var t=window.layouteditor.createPageXML();this.$emit("publishXml",t)},setEdited:function(t){this.$emit("setEdited",t)},restartEditor:function(t){window.layouteditor.canvas.clear(),window.layouteditor.removeCanvasListeners(),window.layouteditor=new Lt(window.layouteditor.canvas,t,this.scaleFactor,this.vueFunctions),window.layouteditor.render()},getButtonStyle:function(t){return(this.editorState===Lt.STATE.EDIT||this.editorState===Lt.STATE.MULTI_SELECT||this.editorState===Lt.STATE.GROUP_SELECTION)&&t===Lt.BUTTON.POINTER||this.editorState===Lt.STATE.ADD_BASELINES&&t===Lt.BUTTON.ADD_BASELINES||this.editorState===Lt.STATE.ADD_REGIONS&&t===Lt.BUTTON.ADD_REGIONS||this.editorState===Lt.STATE.ADD_TABLES&&t===Lt.BUTTON.ADD_TABLES||this.editorState===Lt.STATE.ADD_RELATION&&t===Lt.BUTTON.ADD_RELATION?{"background-color":"\t#C0C0C0"}:{"background-color":"white"}},setHome:function(){this.viewer.viewport.goHome()},fullscreen:function(){this.$fullscreen.toggle()},fitToWidth:function(){var t=this.viewer.viewport.getBounds(),e=t.height/t.width,n=this.viewer.world.getHomeBounds();n.height=n.width*e,this.viewer.viewport.fitBounds(n,!1)},zoomIn:function(){this.viewer.viewport.zoomBy(1.2)},zoomOut:function(){this.viewer.viewport.zoomBy(.8)}}},be=Te,xe=(n("bbe5"),Object(jt["a"])(be,s,a,!1,null,null,null)),Se=xe.exports,Ee='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<PcGts xmlns="http://schema.primaresearch.org/PAGE/gts/pagecontent/2013-07-15"\n    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://schema.primaresearch.org/PAGE/gts/pagecontent/2013-07-15 http://schema.primaresearch.org/PAGE/gts/pagecontent/2013-07-15/pagecontent.xsd">\n    <Metadata>\n        <Creator>prov=READ-COOP:name=PyLaia@TranskribusPlatform:version=0.7.1:model_id=42712:lm=none:date=17_06_2022_10:01 prov=READ-COOP:name=PyLaia@Transkribus:version=0.7.1:model_id=42712:date=17_06_2022_10:01 prov=University of Rostock/Institute of Mathematics/CITlab|PLANET AI GmbH/Tobias Gruening/tobias.gruening@planet-ai.de:name=de.uros.citlab.module.baseline2polygon.B2PSeamMultiOriented:v=2.6.7</Creator>\n        <Created>2016-06-22T11:44:42.893+07:00</Created>\n        <LastChange>2022-06-17T10:01:28.475+02:00</LastChange>\n        <TranskribusMetadata docId="675140" pageId="25929391" pageNr="1" tsid="88363093" status="IN_PROGRESS" userId="88244" imgUrl="https://files.transkribus.eu/Get?id=UYFUAQYSQFSHIZJUHQKFBVHE&amp;fileType=view" xmlUrl="https://files.transkribus.eu/Get?id=XIZXUJMSNUZCQJMQANBEWKPR" imageId="813424"/>\n    </Metadata>\n    <Page imageFilename="25929391.jpg" imageWidth="5188" imageHeight="4088" type="front-cover">\n        <ReadingOrder>\n            <OrderedGroup id="ro_1655452888492" caption="Regions reading order">\n                <RegionRefIndexed index="0" regionRef="r1"/>\n                <RegionRefIndexed index="1" regionRef="r2"/>\n                <RegionRefIndexed index="2" regionRef="r3"/>\n                <RegionRefIndexed index="3" regionRef="r4"/>\n                <RegionRefIndexed index="4" regionRef="r5"/>\n                <RegionRefIndexed index="5" regionRef="r6"/>\n                <RegionRefIndexed index="6" regionRef="r7"/>\n                <RegionRefIndexed index="7" regionRef="r8"/>\n                <RegionRefIndexed index="8" regionRef="r9"/>\n                <RegionRefIndexed index="9" regionRef="r10"/>\n                <RegionRefIndexed index="10" regionRef="r11"/>\n                <RegionRefIndexed index="11" regionRef="r12"/>\n                <RegionRefIndexed index="12" regionRef="r13"/>\n                <RegionRefIndexed index="13" regionRef="r14"/>\n                <RegionRefIndexed index="14" regionRef="r15"/>\n                <RegionRefIndexed index="15" regionRef="r16"/>\n                <RegionRefIndexed index="16" regionRef="r17"/>\n                <RegionRefIndexed index="17" regionRef="r18"/>\n                <RegionRefIndexed index="18" regionRef="r19"/>\n                <RegionRefIndexed index="19" regionRef="r20"/>\n            </OrderedGroup>\n        </ReadingOrder>\n        <TextRegion orientation="0.0" id="r1" custom="readingOrder {index:0;}">\n            <Coords points="314,697 314,995 452,995 452,697"/>\n            <TextLine id="r1l1" custom="readingOrder {index:0;}">\n                <Coords points="326,730 341,729 346,735 360,727 378,737 395,731 432,733 435,662 427,660 409,674 396,670 391,675 382,674 350,698 328,701"/>\n                <Baseline points="334,720 364,722 395,723 426,724"/>\n                <Word id="r1l1w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="348,682 348,742 388,742 388,682"/>\n                    <TextEquiv>\n                        <Unicode>ἵν</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἵν</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r1l2" custom="readingOrder {index:1;}">\n                <Coords points="353,776 363,775 383,790 407,776 424,780 432,787 446,778 456,780 458,729 443,730 425,745 405,738 384,749 373,742 354,739"/>\n                <Baseline points="360,770 389,771 418,771 448,774"/>\n                <Word id="r1l2w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="363,731 363,791 463,791 463,731"/>\n                    <TextEquiv>\n                        <Unicode>κμίκ.</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>κμίκ.</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r1l3" custom="readingOrder {index:2;}">\n                <Coords points="357,828 371,832 381,826 390,833 395,826 401,829 405,825 411,829 425,823 456,825 455,797 439,799 419,792 404,801 395,799 377,806 369,802 356,805"/>\n                <Baseline points="364,824 392,821 420,819 448,820"/>\n                <Word id="r1l3w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="358,780 358,840 454,840 454,780"/>\n                    <TextEquiv>\n                        <Unicode>νη</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>νη</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r1l4" custom="readingOrder {index:3;}">\n                <Coords points="338,892 365,886 380,891 397,886 409,889 425,878 436,887 444,882 460,885 458,844 434,846 406,835 390,847 386,843 364,844 350,857 337,855"/>\n                <Baseline points="344,878 371,880 398,877 425,876 452,878"/>\n                <Word id="r1l4w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="338,836 338,896 461,896 461,836"/>\n                    <TextEquiv>\n                        <Unicode>σιατα.</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>σιατα.</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r1l5" custom="readingOrder {index:4;}">\n                <Coords points="306,945 335,942 373,950 383,940 400,939 406,933 428,943 453,940 454,898 432,898 415,884 383,894 348,877 308,883"/>\n                <Baseline points="314,930 340,928 366,928 393,930 419,932 446,930"/>\n                <Word id="r1l5w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="314,889 314,949 320,949 320,889"/>\n                    <TextEquiv>\n                        <Unicode>·</Unicode>\n                    </TextEquiv>\n                </Word>\n                <Word id="r1l5w2" custom="readingOrder {index:1;}" readingOrderIndex="1">\n                    <Coords points="339,888 339,948 419,948 419,888"/>\n                    <TextEquiv>\n                        <Unicode>καὶ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>· καὶ</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r1l6" custom="readingOrder {index:5;}">\n                <Coords points="339,997 364,1004 391,983 397,987 404,984 420,995 437,996 436,941 410,934 387,948 375,948 351,971 338,971"/>\n                <Baseline points="346,984 374,979 402,981 430,980"/>\n                <Word id="r1l6w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="342,940 342,1000 441,1000 441,940"/>\n                    <TextEquiv>\n                        <Unicode>δἀκη.</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>δἀκη.</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextEquiv>\n                <Unicode/>\n            </TextEquiv>\n        </TextRegion>\n        <TextRegion orientation="0.0" id="r2" custom="readingOrder {index:1;}">\n            <Coords points="508,454 508,726 588,726 588,454"/>\n            <TextLine id="r2l1" custom="readingOrder {index:0;}">\n                <Coords points="520,486 535,484 539,489 549,490 553,486 569,489 578,484 586,494 595,495 599,450 576,447 572,451 562,445 542,456 523,451"/>\n                <Baseline points="528,478 558,483 588,484"/>\n                <Word id="r2l1w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="530,443 530,503 598,503 598,443"/>\n                    <TextEquiv>\n                        <Unicode>οοος</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>οοος</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r2l2" custom="readingOrder {index:1;}">\n                <Coords points="501,549 528,550 537,543 557,553 572,543 595,540 595,514 570,512 554,506 544,514 531,514 527,509 521,515 511,512 501,514"/>\n                <Baseline points="508,534 534,534 561,534 588,534"/>\n                <Word id="r2l2w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="500,494 500,554 605,554 605,494"/>\n                    <TextEquiv>\n                        <Unicode>ἡςκῆς.</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἡςκῆς.</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r2l3" custom="readingOrder {index:2;}">\n                <Coords points="512,711 522,710 537,717 547,713 588,718 588,640 551,637 538,640 533,646 528,644 520,653 512,653"/>\n                <Baseline points="520,704 550,704 580,704"/>\n                <Word id="r2l3w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="531,664 531,724 538,724 538,664"/>\n                    <TextEquiv>\n                        <Unicode>ἴ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἴ</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextEquiv>\n                <Unicode/>\n            </TextEquiv>\n        </TextRegion>\n        <TextRegion orientation="0.0" id="r3" custom="readingOrder {index:2;}">\n            <Coords points="626,423 626,3247 812,3247 812,423"/>\n            <TextLine id="r3l1" custom="readingOrder {index:0;}">\n                <Coords points="660,469 713,480 729,469 750,466 774,473 783,469 791,478 803,475 806,415 789,410 761,420 736,413 720,421 702,410 685,421 662,418"/>\n                <Baseline points="668,454 693,457 719,458 744,458 770,460 796,462"/>\n                <Word id="r3l1w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="729,420 729,480 816,480 816,420"/>\n                    <TextEquiv>\n                        <Unicode>ο·</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ο·</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l2" custom="readingOrder {index:1;}">\n                <Coords points="708,531 729,527 750,540 763,538 763,475 752,473 742,479 729,480 721,488 708,488"/>\n                <Baseline points="716,520 756,520"/>\n                <Word id="r3l2w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="710,480 710,540 755,540 755,480"/>\n                    <TextEquiv>\n                        <Unicode>σος</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>σος</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l3" custom="readingOrder {index:2;}">\n                <Coords points="643,579 678,578 685,584 704,577 753,578 768,590 795,576 818,584 819,541 794,547 784,536 771,542 739,536 718,544 681,538 643,551"/>\n                <Baseline points="650,574 677,571 704,570 731,570 758,572 785,573 812,576"/>\n                <Word id="r3l3w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="643,532 643,592 690,592 690,532"/>\n                    <TextEquiv>\n                        <Unicode>οσ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <Word id="r3l3w2" custom="readingOrder {index:1;}" readingOrderIndex="1">\n                    <Coords points="705,532 705,592 814,592 814,532"/>\n                    <TextEquiv>\n                        <Unicode>σεηωος</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>οσ σεηωος</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l4" custom="readingOrder {index:3;}">\n                <Coords points="686,662 734,661 754,640 769,644 774,639 790,639 786,588 767,590 753,578 730,578 680,596"/>\n                <Baseline points="690,630 720,627 751,625 782,622"/>\n                <Word id="r3l4w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="704,588 704,648 712,648 712,588"/>\n                    <TextEquiv>\n                        <Unicode>ὧ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ὧ</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l5" custom="readingOrder {index:4;}">\n                <Coords points="660,727 694,713 713,729 739,718 759,726 782,710 795,710 795,655 775,659 756,650 727,665 702,662 660,672"/>\n                <Baseline points="668,708 698,708 728,708 758,708 788,708"/>\n                <Word id="r3l5w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="668,668 668,728 779,728 779,668"/>\n                    <TextEquiv>\n                        <Unicode>ἢκκκ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἢκκκ</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l6" custom="readingOrder {index:5;}">\n                <Coords points="637,1347 656,1350 673,1335 692,1335 734,1344 746,1337 769,1350 787,1342 807,1350 807,1296 788,1290 779,1296 758,1277 720,1296 704,1296 692,1286 668,1290 659,1281 637,1292"/>\n                <Baseline points="644,1330 670,1330 696,1330 722,1330 748,1330 774,1330 800,1330"/>\n                <Word id="r3l6w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="654,1290 654,1350 799,1350 799,1290"/>\n                    <TextEquiv>\n                        <Unicode>ἢκκη</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἢκκη</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l7" custom="readingOrder {index:6;}">\n                <Coords points="735,1532 745,1533 750,1538 768,1535 788,1561 807,1562 816,1493 795,1489 788,1483 770,1487 754,1468 744,1467"/>\n                <Baseline points="744,1518 774,1522 804,1526"/>\n                <Word id="r3l7w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="743,1479 743,1539 766,1539 766,1479"/>\n                    <TextEquiv>\n                        <Unicode>-τ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>-τ</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l8" custom="readingOrder {index:7;}">\n                <Coords points="641,1530 649,1530 652,1527 657,1533 663,1531 672,1533 686,1527 695,1527 695,1476 682,1477 678,1482 673,1483 656,1473 649,1477 641,1477"/>\n                <Baseline points="648,1524 688,1524"/>\n                <Word id="r3l8w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="655,1484 655,1544 663,1544 663,1484"/>\n                    <TextEquiv>\n                        <Unicode>ἡ</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἡ</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l9" custom="readingOrder {index:8;}">\n                <Coords points="644,1807 673,1795 731,1795 757,1780 773,1789 820,1785 820,1716 740,1753 698,1730 683,1737 663,1731 644,1736"/>\n                <Baseline points="652,1774 678,1774 705,1776 732,1776 758,1775 785,1774 812,1774"/>\n                <Word id="r3l9w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="726,1734 726,1794 820,1794 820,1734"/>\n                    <TextEquiv>\n                        <Unicode>κν</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>κν</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l10" custom="readingOrder {index:9;}">\n                <Coords points="627,2165 648,2168 675,2154 693,2157 704,2167 746,2159 796,2164 795,2126 782,2125 748,2099 725,2101 711,2114 661,2115 638,2136 627,2136"/>\n                <Baseline points="634,2154 659,2156 685,2156 711,2156 736,2155 762,2154 788,2152"/>\n                <Word id="r3l10w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="645,2115 645,2175 783,2175 783,2115"/>\n                    <TextEquiv>\n                        <Unicode>ἵα</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>ἵα</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l11" custom="readingOrder {index:10;}">\n                <Coords points="619,2844 669,2851 703,2847 719,2852 728,2863 765,2864 768,2807 753,2808 720,2796 702,2803 694,2797 683,2804 661,2795 643,2803 622,2793"/>\n                <Baseline points="626,2844 652,2842 678,2842 705,2845 731,2848 758,2848"/>\n                <Word id="r3l11w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="635,2803 635,2863 754,2863 754,2803"/>\n                    <TextEquiv>\n                        <Unicode>τθα.</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>τθα.</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l12" custom="readingOrder {index:11;}">\n                <Coords points="641,3113 657,3117 686,3098 698,3097 765,3108 795,3102 797,3051 780,3052 765,3038 753,3034 716,3047 645,3045"/>\n                <Baseline points="650,3084 677,3087 705,3089 732,3091 760,3092 788,3090"/>\n                <Word id="r3l12w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="663,3048 663,3108 735,3108 735,3048"/>\n                    <TextEquiv>\n                        <Unicode>α</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>α</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextLine id="r3l13" custom="readingOrder {index:12;}">\n                <Coords points="637,3230 656,3238 684,3226 700,3240 722,3231 735,3237 762,3221 780,3232 800,3230 798,3178 768,3189 753,3179 733,3186 683,3165 653,3179 635,3175"/>\n                <Baseline points="644,3220 673,3217 703,3216 732,3216 762,3215 792,3212"/>\n                <Word id="r3l13w1" custom="readingOrder {index:0;}" readingOrderIndex="0">\n                    <Coords points="647,3177 647,3237 694,3237 694,3177"/>\n                    <TextEquiv>\n                        <Unicode>κα</Unicode>\n                    </TextEquiv>\n                </Word>\n                <TextEquiv>\n                    <Unicode>κα</Unicode>\n                </TextEquiv>\n            </TextLine>\n            <TextEquiv>\n                <Unicode/>\n            </TextEquiv>\n        </TextRegion>\n    </Page>\n</PcGts>',Oe=Ee,Ce={"@context":"http://iiif.io/api/image/2/context.json","@id":"https://files.transkribus.eu/iiif/2/UYFUAQYSQFSHIZJUHQKFBVHE",protocol:"http://iiif.io/api/image",width:5188,height:4088,sizes:[{width:162,height:128},{width:324,height:256},{width:649,height:511},{width:1297,height:1022},{width:2594,height:2044},{width:5188,height:4088}],tiles:[{width:512,height:512,scaleFactors:[1,2,4,8,16,32]}],profile:["http://iiif.io/api/image/2/level2.json",{formats:["jpg","tif","gif","png"],maxArea:21208544,qualities:["bitonal","default","gray","color"],supports:["regionByPx","sizeByW","sizeByWhListed","cors","regionSquare","sizeByDistortedWh","canonicalLinkHeader","sizeByConfinedWh","sizeByPct","jsonldMediaType","regionByPct","rotationArbitrary","sizeByH","baseUriRedirect","rotationBy90s","profileLinkHeader","sizeByForcedWh","sizeByWh","mirroring"]}]},Ae=Ce,we={name:"App",data:function(){return{pageXml:Oe,tileSource:Ae}},created:function(){var t,e,n,i=null===(t=window.layoutEditorConfig)||void 0===t?void 0:t.xml,r=null===(e=window.layoutEditorConfig)||void 0===e?void 0:e.iiifJson;try{n=JSON.parse(r)}catch(o){console.log("Error: iiifJson in not in JSON format")}i&&(this.pageXml=i),n&&(this.tileSource=n)},components:{LayoutEditor:Se},methods:{save:function(t){window.onLayoutSave&&window.onLayoutSave(t)}}},_e=we,Re=Object(jt["a"])(_e,r,o,!1,null,null,null),Le=Re.exports,Ie=n("289d"),Pe=(n("5abe"),n("a925"));i["a"].use(Pe["a"]);var ke=new Pe["a"]({locale:"en",fallbackLocale:"en",messages:[],silentTranslationWarn:!0});i["a"].use(Ie["a"]),new i["a"]({i18n:ke,render:function(t){return t(Le)}}).$mount("#app")},"5a4f":function(t,e,n){},6:function(t,e){},7:function(t,e){},7686:function(t,e,n){},8:function(t,e){},"8a1f":function(t,e,n){"use strict";n("5a4f")},9:function(t,e){},a674:function(t,e,n){"use strict";n("ce4a")},bbe5:function(t,e,n){"use strict";n("c392")},c392:function(t,e,n){},ce4a:function(t,e,n){},e956:function(t,e,n){"use strict";n("7686")}});
//# sourceMappingURL=app.159aa223.js.map